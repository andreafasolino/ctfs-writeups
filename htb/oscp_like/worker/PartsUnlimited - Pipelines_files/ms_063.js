"use strict";define("VSS/Legacy",["require","exports","react","VSS/Platform/Layout","VSS/Platform/Context"],function(e,t,n,a,o){var s,i;!function(e){s=t.ComponentsLegacyLegacy={},Object.defineProperty(t,"__esModule",{value:!0});class o extends a.VssComponent{constructor(){super(...arguments),this.onDependenciesResolved=(()=>{return this.context.pageContext.getService("ILegacyPlatformService").loadModules(this.props.modules,this.props.dependentContributionIds)})}render(){const e=Object.assign({},this.props,{modules:void 0,dependentContributionIds:void 0,onDependenciesResolved:this.onDependenciesResolved});return this.props.componentType&&(e.wrappedType=this.props.componentType),n.createElement(a.WrappedComponent,e,this.props.children)}}t.ComponentsLegacyLegacy.LegacyComponent=o,a.Components.add("legacy",o)}(),function(e){i=t.LegacyPlatformService={},Object.defineProperty(t,"__esModule",{value:!0});const n="ms.vss-web.legacy-platform-data-provider",a="ms.vss-web.legacy-vss-ui-content",s=[a,n],c=window;let r;o.Services.add("ILegacyPlatformService",{serviceFactory:class extends o.VssService{constructor(){super(...arguments),this._onFpsCompleted=(e=>{if(e.detail.success){const e=this.pageContext.getService("IVssContributionService").getData(n);if(c.__legacyFpsLoading=!1,c.__updatedLegacyData=e,r=this.pageContext,e){const t=c.__vssPageContext;t.webContext.project=e.pageContext.webContext.project,t.webContext.team=e.pageContext.webContext.team,t.diagnostics.activityId=e.pageContext.diagnostics.activityId}else this._legacyContentLoaded=!1,this._legacyDataReset=!0,document.body.removeEventListener("fpsLoading",this._onFpsCompleted),this._legacyDataElement.remove();document.body.dispatchEvent(new CustomEvent("legacyFpsComplete",{detail:e}))}})}_serviceStart(e){super._serviceStart(e);const t=this.pageContext.getService("IVssContributionService").getData(n);t&&t.preloadContent&&this._ensureLegacyContentLoaded(()=>{})}loadModules(e,t){return new Promise((n,a)=>{const o=()=>{e&&e.length?c.requirejs("VSS/VSS").requireModules(e).then(()=>{n()}):n()};this._ensureLegacyContentLoaded(()=>{t&&t.length?c.requirejs(["VSS/Service","VSS/Contributions/Services"],(e,n)=>{e.getService(n.ExtensionService).getContributions(t,!0,!0,!0).then(e=>{e.some(e=>"ms.vss-web.content"===e.type)?this.pageContext.getService("IVssContributionService").getContributionsAsync(t).then(o):o()})}):o()})})}getLegacyPageContext(e){return this.loadModules().then(()=>{let t=c.__vssPageContext;return e&&!t.webContext.team?this.pageContext.getService("IVssContributionService").getDataAsync("ms.vss-tfs-web.team-context-data-provider").then(e=>(e&&(t=Object.assign({},t,{webContext:Object.assign({},t.webContext,{team:Object.assign({},e)})})),t)):c.__vssPageContext})}requireModules(e){return this.loadModules(e).then(()=>e.map(e=>c.requirejs(e)))}_ensureLegacyContentLoaded(e){if(this._legacyContentLoaded||c.__legacyContentLoaded)e();else if(this._legacyContentLoadedCallbacks)this._legacyContentLoadedCallbacks.push(e);else{this._legacyContentLoadedCallbacks=[e],this.pageContext.getService("IVssPerformanceService").addSplitTiming("LegacyPlatformService.LoadStarted");const t=this.pageContext.getService("IVssContributionService"),o=this.pageContext.getService("IVssContentService"),i=t.getData(n);i&&o.isLoaded(a)?this._processLegacyData(i):t.getContributionsAsync(s).then(()=>{const e=t.getData(n);if(e){const n=t.getData("ms.vss-tfs-web.page-data");n&&(n.project&&(e.pageContext.webContext.project={id:n.project.id,name:n.project.name}),n.team&&(e.pageContext.webContext.team={id:n.team.id,name:n.team.name})),this._processLegacyData(e)}})}}_processLegacyData(e){this.pageContext.getService("IVssContentService").loadScripts(e.content).then(()=>{this.pageContext.getService("IVssPerformanceService").addSplitTiming("LegacyPlatformService.ContentLoaded"),this._processLegacyDataWithDOM(e)})}_processLegacyDataWithDOM(e){this._legacyDataElement=document.createElement("div"),this._legacyDataElement.classList.add("legacy-data"),this._legacyDataElement.style.display="none",document.body.appendChild(this._legacyDataElement),this._createLegacyJsonIsland(this._legacyDataElement,"feature-licenses",e.featureLicenseInfo),this._createLegacyJsonIsland(this._legacyDataElement,"vss-contribution-data",e.contributionsPageData),this._createLegacyJsonIsland(this._legacyDataElement,"vss-bundle-data",e.content.filter(e=>!!e.bundle)),c._builtinPlugins=e.builtInPlugins,c._builtInBases=e.builtInPluginBases,c.__vssPageContext?(c.__vssPageContext.webContext.project=e.pageContext.webContext.project,c.__vssPageContext.webContext.team=e.pageContext.webContext.team,c.__vssPageContext.diagnostics.activityId=e.pageContext.diagnostics.activityId):c.__vssPageContext=e.pageContext,c.__cultureInfo=c.__vssPageContext.microsoftAjaxConfig.cultureInfo,c.requirejs.config(c.__vssPageContext.moduleLoaderConfig),c.requirejs.config({map:{"*":{React:"react"}}});const t=this.pageContext.getService("IVssNavigationService"),n=t.getCurrentRoute();c.__vssPageContext.navigation.routeId=n.routeId,c.__vssPageContext.navigation.routeTemplates=n.routeTemplates,r=this.pageContext;const a=e.pageContext.hubsContext;if(!a.selectedHubId){const e=t.getDisplayedNavigation();if(e.length>3){const n=e[2],o=e[3];if(a.selectedHubGroupId=n,a.selectedHubId=o,!a.hubs.some(e=>e.id===o)){const e=t.getNavigation(o);e&&a.hubs.push({groupId:n,id:o,name:e.name,supportsXHRNavigate:!0,uri:e.href})}}}document.body.addEventListener("fpsLoading",()=>{c.__legacyFpsLoading=!0}),this._legacyDataReset&&(c.__updatedLegacyData=e,this._legacyDataReset=!1),document.body.addEventListener("fpsCompleted",this._onFpsCompleted),window.performance&&window.performance.mark&&window.performance.mark("requireStart"),c.requirejs(e.scriptsToRequire,()=>{if(window.performance&&window.performance.mark&&window.performance.mark("requireEnd"),c.requiredModulesLoaded=!0,c.requirejs(["VSS/Events/Page"],e=>{e.getService().fire(e.CommonPageEvents.InitialScriptsLoaded)}),this._legacyContentLoaded=!0,this._legacyContentLoadedCallbacks){for(const e of this._legacyContentLoadedCallbacks)e();delete this._legacyContentLoadedCallbacks}})}_createLegacyJsonIsland(e,t,n){const a=document.createElement("script");a.type="application/json",a.classList.add(t),a.innerText=JSON.stringify(n),e.appendChild(a)}},options:6}),t.LegacyPlatformService.getLWPService=function(e){if(r)return r.getService(e)},t.LegacyPlatformService.getLWPComponentProps=function(){return{pageContext:r}}}(),t.Legacy={},Object.defineProperty(t,"__esModule",{value:!0}),t.Legacy.LegacyComponent=s.LegacyComponent,t.Legacy.getLWPService=i.getLWPService,t.Legacy.getLWPComponentProps=i.getLWPComponentProps},["Components/Legacy/Legacy","LegacyPlatformService","Legacy"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-web.legacy-content"}}));