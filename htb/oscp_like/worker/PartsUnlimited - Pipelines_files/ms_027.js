"use strict";define("DistributedTaskUI/Logs",["require","exports","VSS/Platform/Location","VSS/Core/Util/String","VSS/Platform/Util/Url","VSSUI/Status","react","VSSUI/Link","VSSUI/Spinner","VSSUI/Util","VSSUI/Button","VSSUI/Header","VSSUI/Panel","VSSUI/Toast","VSSUI/TooltipEx","VSSUI/VssIcon","VSS/Legacy/Legacy","VSS/Platform/Feature","VSS/Platform/Layout","DistributedTaskUI/LogReader/Reader","VSSUI/MessageBar","OfficeFabric/FocusZone","VSS/Core/Util/Object","DistributedTask/Client/RestClient/TaskAgent","VSSUI/Menu","VSSUI/Duration","OfficeFabric/Styling","VSSUI/Toggle","VSSUI/PickList","VSS/Core/TimerManagement","OfficeFabric/List","VSSUI/Utilities/Dom","OfficeFabric/Utilities","VSSUI/Components/Splitter/index"],function(e,t,s,o,i,n,a,r,l,c,p,u,g,h,d,m,L,T,f,k,_,b,v,w,S,C,x,y,E,I,P,N,R,D){var V,A,q,F,M,O,U,B,W,j,H,K,z,Q,Z,J,$,G;V=t.Resources={},Object.defineProperty(t,"__esModule",{value:!0}),t.Resources.Succeeded="succeeded",t.Resources.JobFailedStatus="Failed",t.Resources.Pending="pending",t.Resources.Skipped="skipped",t.Resources.JobPartiallySucceededStatus="Partially succeeded",t.Resources.Cancelled="canceled",t.Resources.CopiedLink="Link to line number {0} copied!",t.Resources.CopyLinkFailed="Copying link {0} failed!",t.Resources.PhaseNotStartedText="The job has not yet started.",t.Resources.PhaseCancelledText="Job canceled.",t.Resources.PhaseCancellingText="Canceling the job...",t.Resources.PhaseFailedText="Failure occurred during job execution.",t.Resources.PhaseSkippedText="The job was skipped due to an unsatisfied condition.",t.Resources.MoreErrorsMessage="{0} more errors. Click on expand view in the context menu to view complete logs.",t.Resources.DurationFormatSeconds="{0} seconds",t.Resources.DurationFormatMinutes="{0} minutes",t.Resources.DurationFormatHours="{0} hours",t.Resources.DurationFormatDays="{0} days",t.Resources.Errors="{0} errors",t.Resources.Error="{0} error",t.Resources.Warnings="{0} warnings",t.Resources.Warning="{0} warning",t.Resources.AgentAcquisitionHeaderTitle="Preparing an agent for the job",t.Resources.JobAuthorizedToStart="This job is authorized to start",t.Resources.WaitingForRunningJobsToFinish="Waiting for running jobs to finish",t.Resources.ConcurrencyLimitsInformation="Not expecting to see this here? We have recently enabled parallel job limits.",t.Resources.ConcurrencyLimitsLearnMore="Learn more",t.Resources.ManageConcurrencyLimit="Manage parallel job limits",t.Resources.WaitingForAvailableAgent="Waiting for an available agent",t.Resources.JobsAheadText="jobs are ahead of this one",t.Resources.PrivateAgentReadyForJobText="{0} is ready for the job",t.Resources.AgentInitializingSubText="Initializing the agent...",t.Resources.HostedAgentReadyForJobText="An agent is ready for the job",t.Resources.AgentConnectingSubText="Connecting...",t.Resources.HostedAgentsBusyText="All agents are busy",t.Resources.PrivateAgentsBusyText="All eligible agents are busy",t.Resources.AllAgentsDisabled="All eligible agents are disabled or offline",t.Resources.LoadingAgentInfo="Loading agent information...",t.Resources.HostedQueue="Microsoft-hosted pool",t.Resources.PrivateQueue="Self-hosted pool",t.Resources.AgentRequestQueued="Waiting for the request to be queued",t.Resources.LogsComponentHeaderRegionAriaLabel="Task log header region",t.Resources.PreviousTaskButtonText="Previous task",t.Resources.NextTaskButtonText="Next task",t.Resources.DownloadLogMenuitemLabel="Download the log",t.Resources.LogComponentFollowTailToggleLabel="Follow tail",t.Resources.FollowTailEnabled="Follow tail is enabled",t.Resources.FollowTailDisabled="Follow tail is disabled",t.Resources.TaskLogExpandedViewCloseButtonAriaLabel="Close expanded view",t.Resources.IssuesButtonAriaLabel="View job issues",t.Resources.TaskLogViewLimitExceededMessage="The log is too large to be displayed in the browser. You can download the log and view it offline.",t.Resources.PhaseIssuesHeaderText="Job issues",t.Resources.FetchingAgentInformationText="Fetching agent information",t.Resources.PhaseSummaryStartTimeText="Started: {0}",t.Resources.QueueNameLabel="Pool:",t.Resources.ViewQueueDescription="Click to view the agent pool.",t.Resources.AgentName="Agent: {0}",t.Resources.MorePhaseSummaryOptionsEllipsesButtonAriaLabel="More job summary options",t.Resources.ExpandViewAriaDescription="Press Enter key to open the logs in expanded view",t.Resources.TaskLogExpandViewButtonName="View detailed logs",t.Resources.InProgressTaskLogStepOverviewAriaLabel="{0}, {1}, {2} running for {3}",t.Resources.InProgress="in progress",t.Resources.CompletedTaskLogStepOverviewAriaLabel="{0}, {1}, {2}, ran for {3}",t.Resources.NotStartedTaskLogStepOverviewAriaLabel="{0}, {1}",t.Resources.TaskLogStepOverviewLiveLogDescription="This task has live logs associated with it.",t.Resources.TaskLogStepOverviewErrorLogsDescription="This task has error logs associated with it.",t.Resources.TaskLogStepOptionsDescription="To navigate the options to open the log editor or download log for this task, press the right arrow key, use shift + Tab key to pop out.",t.Resources.LogsComponentContentRegionAriaLabel="Task log content region",t.Resources.FetchingLogLoadingComponentLabel="Fetching logs",t.Resources.PhaseRunOnServerText="Run on server",t.Resources.LoadingLegacyComponent="Loading view",t.Resources.PassPercentage="{0}%",t.Resources.PercentComplete="{0}% completed,",t.Resources.Info="Info",function(e){A=t.LogsViewUtility={},Object.defineProperty(t,"__esModule",{value:!0});const a="logFileLineNumber",r=(e,t,s,o)=>({status:e,iconName:t,className:"state-"+s,statusProps:o});class l{static getTaskStatus(e,t,s){const i=e=>t>0?o.localeFormat(this._getErrorString(t),t):e;switch(e){case 5:return r(V.Succeeded,"Accept","success",n.Statuses.Success);case 6:return r(i(V.JobFailedStatus),"Cancel","failed",n.Statuses.Failed);case 2:let t="";return s&&(t=o.format(V.PassPercentage,s)),r(t,"Play","inProgress",n.Statuses.Running);case 0:case 1:return r(V.Pending,"Clock","pending",n.Statuses.Waiting);case 4:return r(V.Skipped,"Blocked","skipped",n.Statuses.Skipped);case 7:return r(i(V.JobPartiallySucceededStatus),"Warning","partially-success",n.Statuses.Warning);case 3:return r(V.Cancelled,"CircleStopSolid","cancelled",n.Statuses.Canceled);default:return{iconName:"",className:"",status:"",statusProps:n.Statuses.Queued}}}static getWarningStatus(e){return e>0?{iconName:"Warning",className:"state-partially-success",status:o.localeFormat(this._getWarningString(e),e),statusProps:n.Statuses.Warning}:null}static getPhaseStatusFromJobStates(e){switch(e){case 1:return r(V.PhaseNotStartedText,"Clock","pending",n.Statuses.Waiting);case 32:return r(V.PhaseCancelledText,"CircleStopSolid","cancelled",n.Statuses.Canceled);case 64:return r(V.PhaseCancellingText,"CircleStopSolid","cancelled",n.Statuses.Canceled);case 16:return r(V.PhaseFailedText,"Cancel","failed",n.Statuses.Failed);case 128:return r(V.PhaseSkippedText,"Blocked","skipped",n.Statuses.Skipped);default:return null}}static getLogSectionIcon(e){switch(e){case"error":return"bowtie-status-failure";case"warning":return"bowtie-status-warning";default:return""}}static getQueueUrl(e,t){return this._getUrlForRoute(t,"ms.vss-build-web.agent-queues-route",{_a:"agents",queueId:e})}static getConcurrentJobsLimitUrl(e){return this._getUrlForRoute(e,"ms.vss-build-web.build-release-collection-admin-route",{_a:"concurrentJobs"})}static showExpandViewEnabled(e){let t=!1;return e&&(t=!!this.isLiveComponentVisible(e)||!(!this.hasTaskCompleted(e)||!e.logUrl)),t}static isLiveComponentVisible(e){let t=!1;return this.isTaskInProgress(e)&&e.liveLogsData&&(t=!0),t}static hasTaskCompleted(e){let t=!0;const s=e.state;return t=!this.isTaskInProgress(e)&&1!==s&&4!==s&&0!==s}static isTaskInProgress(e){return 2===e.state}static getLogsFromLiveLogData(e){const t=[];if(e&&e.logLines)for(const s of e.logLines)"default"===s.logType?t.push(s.content):t.push((s.logType?"["+s.logType+"]":"")+s.content);return t.join("\n")}static fixTasksRank(e){if(e&&e.length>0){let t=!1;if(e.sort((e,s)=>e.rank!==s.rank?e.rank-s.rank:s.startTime&&e.startTime?(t=!0,e.startTime>s.startTime?1:e.startTime<s.startTime?-1:0):(t=!0,0)),t)for(let t=0;t<e.length;t++)e[t].rank=t+1}}static getLogLinesFromIssues(e,t){const s=[];if(e&&e.length>0){const i=this._getIssuesCountToDisplay(e,t);for(let t=0;t<i;t++){const o=e[t];if(o&&o.message){const e={content:o.message,logType:1===o.issueType?"error":"warning",lineNumber:this._getLogLineNumber(o)};s.push(e)}}if(i<e.length){const t=e.length-i;if(t>0){const e={content:o.format(V.MoreErrorsMessage,t),logType:"error"};s.push(e)}}}return s}static getIssuesWithType(e,t){let s=[];return t&&t.issues&&(s=t.issues.filter(t=>t.issueType===e&&t.message)),s}static fetchLogs(e,t){if(!e.logUrl||!e.fetchLogDelegate){const t=o.localeFormat("{0} {1}",e.name,l.getTaskStatus(e.state,0).status.toLocaleLowerCase());return Promise.resolve(t)}const s=e.logUrl.toLowerCase();let i,n;!this._cachedLogs.hasOwnProperty(s)||t?(i=e.fetchLogDelegate(),this.hasTaskCompleted(e)&&(this._cachedLogs[s]=i)):i=this._cachedLogs[s];const a=new Promise((e,t)=>{n=e});return i.then(e=>{n(e)},e=>{const t=e&&e.message?e.message:e;n(t)}),a}static getTimeDiffFriendlyString(e,t){e=e||new Date,t=t||new Date;const s=Math.abs(e.valueOf()-t.valueOf())/1e3,i=s/60;if(i<2)return o.format(V.DurationFormatSeconds,Math.round(s));const n=i/60;if(n<2)return o.format(V.DurationFormatMinutes,(Math.round(10*i)/10).toLocaleString());const a=n/24;return a<2?o.format(V.DurationFormatHours,(Math.round(10*n)/10).toLocaleString()):o.format(V.DurationFormatDays,Math.round(a))}static splitLogLine(e){let t=[];return e&&(t=e.split(/\r\n|\r|\n/g)),t}static getSortedValidTasks(e){let t=[];return e&&e.length>0&&(t=e.filter(e=>{const t=e.state;return 1!==t&&4!==t&&0!==t}))&&t.length>0&&(t=t.sort((e,t)=>e.rank-t.rank)),t}static getTaskIndexForGivenRank(e,t){let s=-1;if(t&&t.length>0){const o=t.length;for(let i=0;i<o;i++)if(t[i].rank===e){s=i;break}}return s}static getNextTask(e,t){let s=-1;const o=l.getSortedValidTasks(e);if(o&&o.length>0){const e=l.getTaskIndexForGivenRank(t,o);e>=0&&e<o.length-1&&(s=e+1)}return s>=0?o[s]:null}static getPreviousTask(e,t){let s=-1;const o=l.getSortedValidTasks(e);if(o&&o.length>0){const e=l.getTaskIndexForGivenRank(t,o);e>0&&(s=e-1)}return s>=0?o[s]:null}static getIndexOfTaskToBeMovedToView(e,t){let s=0;if(e&&t&&t.length>0)switch(e){case 16:s=this._getIndexOfFirstTaskWithState(t,[3,6]);break;case 8:s=this._getIndexOfFirstTaskWithState(t,[7]);break;case 2:s=this._getIndexofTaskWithLiveLog(t);break;default:s=-1}return s}static downloadLog(e){if(e){const t=window.open(e,"_self");t&&(t.opener=null)}}static _getIndexOfFirstTaskWithState(e,t){let s=0;if(e&&e.length>0){let o=null;e.some(e=>{let s=!1;for(const i of t)if(e.state===i){s=!0,o=e;break}return s}),o&&(s=e.findIndex(e=>!!o&&e.taskId===o.taskId))}return s}static _getIndexofTaskWithLiveLog(e){let t=-1;return e&&e.length>0&&(t=e.findIndex(e=>{const t=e.liveLogsData;return 2===e.state&&t&&t.logLines&&t.logLines.length>0||!1})),t}static _getErrorString(e){return e>1?V.Errors:V.Error}static _getWarningString(e){return e>1?V.Warnings:V.Warning}static _getIssuesCountToDisplay(e,t){if(e&&e.length>0){let s=0,o=0;for(let i=0,n=e.length;i<n;i++){if((o+=this.splitLogLine(e[i].message).length)>t)break;s++}return Math.max(s,1)}return 0}static _getLogLineNumber(e){let t=null;if(e){const s=e.data;s&&s[a]&&(t=parseInt(s[a]),isNaN(t)&&(t=null))}return t}static _getUrlForRoute(e,t,o){if(!e)return"";const n=this._getCurrentRouteValues(e),a={project:n.project};n.team&&(a.team=n.team);const r=new i.Uri(s.routeUrl(e,t,a));for(const e in o)o[e]&&r.addQueryParam(e,o[e]);return r.absoluteUri}static _getCurrentRouteValues(e){return e.getService("IVssNavigationService").getCurrentRoute().routeValues}}l._cachedLogs={},t.LogsViewUtility.LogsViewUtility=l}(),function(e){q=t.AgentAcquisition={},Object.defineProperty(t,"__esModule",{value:!0});const s=A.LogsViewUtility,i=e=>a.createElement("div",{className:c.css("agent-acquisition-preRequisite-section","flex",e.cssClass),"aria-live":"assertive"},a.createElement("div",{className:"agent-acquisition-preRequisite-icon-section"},e.getIconSection&&e.getIconSection()),a.createElement("div",{className:"agent-acquisition-preRequisite-header"},a.createElement("div",{className:"agent-acquisition-preRequisite-title"},e.preRequisiteTitle),e.getPreRequisiteLearnMoreMarkDown&&a.createElement("div",{className:"agent-acquisition-preRequisite-learn-more"},e.getPreRequisiteLearnMoreMarkDown()),(e.preRequisiteSubText||e.preRequisiteLinkName)&&a.createElement("div",{className:"agent-acquisition-preRequisite-subtext-section"},e.preRequisiteSubText&&a.createElement("span",null,e.preRequisiteSubText),e.preRequisiteSubText&&e.preRequisiteLinkName&&a.createElement("div",{className:"agent-acquisition-preRequisite-subtext-separator"},"Â·"),e.preRequisiteLinkName&&a.createElement("div",{className:"agent-acquisition-preRequisite-link"},a.createElement(r.Link,{className:"agent-acquisition-link",href:e.preRequisiteLinkUrl,target:"_blank",rel:"noopener noreferrer"},e.preRequisiteLinkName,a.createElement("span",{className:"agent-acquisition-preRequisite-external-link bowtie-icon bowtie-navigate-external"}))))));t.AgentAcquisition.AgentAcquisition=class extends a.Component{constructor(){super(...arguments),this._getLoadingSpinner=(()=>a.createElement(l.Spinner,{className:"agent-acquisition-spinner",size:"large"})),this._getPositionIconSection=(()=>{const e=this.props.queuePosition||"--";return a.createElement("div",{className:"queue-position-icon"},a.createElement("div",{className:"queue-position-text"},e))}),this._getPreRequisiteAcquiredIconSection=(()=>a.createElement(n.Status,Object.assign({},n.Statuses.Success,{size:"32"})))}render(){const e=this._shouldShowLicenseInfoSection();return a.createElement("div",{className:c.css("agent-acquisition-container",this.props.containerCssClass)},!this.props.hideHeader&&a.createElement("div",{className:"agent-acquisition-header"},V.AgentAcquisitionHeaderTitle),a.createElement("div",{className:"agent-acquisition-prerequisites"},e&&this._getLicenseSection(),!e&&this._getAgentInitializationSection()))}_shouldShowLicenseInfoSection(){return this.props.jobRequest&&!this.props.hideLicenseInfoSection&&!this._isLicenseAcquired()&&!this.props.isAnonymousUser||!1}_getLicenseSection(){let e,t=this._getLoadingSpinner;const o=s.getConcurrentJobsLimitUrl(this.props.pageContext);return this._isLicenseAcquired()?(e=V.JobAuthorizedToStart,t=this._getPreRequisiteAcquiredIconSection):e=V.WaitingForRunningJobsToFinish,a.createElement(i,{preRequisiteLinkName:V.ManageConcurrencyLimit,preRequisiteLinkUrl:o,preRequisiteTitle:e,getPreRequisiteLearnMoreMarkDown:()=>this.props.isHostedPool?null:a.createElement("div",null,V.ConcurrencyLimitsInformation,a.createElement(r.Link,{className:"learn-more",href:"https://aka.ms/concurrency-limits",rel:"noopener noreferrer",target:"_blank"},V.ConcurrencyLimitsLearnMore),a.createElement("span",{className:"bowtie-icon bowtie-navigate-external"})),getIconSection:t,cssClass:this.props.preRequisiteSectionCssClass})}_isLicenseAcquired(){if(this._isAgentAcquired())return!0;if(this.props.licenseInfo){const e=this.props.licenseInfo.usedLicenseCount||0,t=this.props.licenseInfo.totalLicenseCount||0,s=this.props.licenseInfo.usedMinutes||0,o=this.props.licenseInfo.totalMinutes||0;if(t>0)return e<t;if(0===t)return s<o}return!1}_isAgentAcquired(){return this.props.jobRequest&&this.props.jobRequest.reservedAgent&&this.props.jobRequest.reservedAgent.id>0||!1}_getAgentInitializationSection(){return this.props.isAnonymousUser?a.createElement(i,{preRequisiteTitle:V.WaitingForAvailableAgent,getIconSection:this._getLoadingSpinner,cssClass:this.props.preRequisiteSectionCssClass}):this._isValidQueueId()&&this.props.jobRequest?this._getAgentAcquisitionSectionForQueuedRequest():this._getAgentAcquisitionSectionForWaitingForQueuedRequest()}_getAgentAcquisitionSectionForQueuedRequest(){const e=s.getQueueUrl(this.props.queueId,this.props.pageContext),t=this._getAgentAcquisitionTextAndIcon();return a.createElement(i,{getIconSection:t.getAgentIconSection,preRequisiteLinkName:t.linkName,preRequisiteLinkUrl:e,preRequisiteTitle:t.headingText,preRequisiteSubText:t.subText,cssClass:this.props.preRequisiteSectionCssClass})}_getAgentAcquisitionTextAndIcon(){let e,t=V.JobsAheadText,s=this._getLoadingSpinner,i=null;const n=this.props.queuePosition||0,a=this._getEligibleAgentsCount();return this._isAgentAcquired()?(!this.props.isHostedPool&&this.props.agentName?(t=o.localeFormat(V.PrivateAgentReadyForJobText,this.props.agentName),e=V.AgentInitializingSubText):(t=V.HostedAgentReadyForJobText,e=V.AgentConnectingSubText),s=this._getPreRequisiteAcquiredIconSection):a>0&&n>0?(e=this.props.isHostedPool?V.HostedAgentsBusyText:V.PrivateAgentsBusyText,s=this._getPositionIconSection,i=this._getQueueLinkName()):a>0&&0===n?(s=this._getPositionIconSection,i=this._getQueueLinkName()):0===a?(t=V.WaitingForAvailableAgent,e=V.AllAgentsDisabled,i=this._getQueueLinkName()):t=V.LoadingAgentInfo,{headingText:t,subText:e,linkName:i,getAgentIconSection:s}}_getQueueLinkName(){return this.props.isHostedPool?V.HostedQueue:V.PrivateQueue}_getEligibleAgentsCount(){let e=-1;if(this.props.jobRequest){const t=this.props.jobRequest.matchedAgents,s=t&&t.filter(e=>!0===e.enabled&&2===e.status);e=s&&s.length||0}return e}_getAgentAcquisitionSectionForWaitingForQueuedRequest(){return a.createElement(i,{getIconSection:this._getLoadingSpinner,preRequisiteTitle:V.AgentRequestQueued,cssClass:this.props.preRequisiteSectionCssClass})}_isValidQueueId(){return this.props.queueId&&this.props.queueId>0||!1}}}(),function(e){F=t[e]={},Object.defineProperty(t,"__esModule",{value:!0});t[e].LiveLogsParser=class{static formatLogLine(s){const o="******************************************************************************";let i=[];const n=t[e].LiveLogsLineRegEx.exec(s);if(n&&n.length>2){const e=this._getLogType(n[1].toLowerCase()),t=n[2];"section"===e?(i.push({content:o,logType:e}),i.push({content:t,logType:e}),i.push({content:o,logType:e})):i.push({content:t,logType:e})}else i.push({content:s,logType:"default"});return i}static _getLogType(e){switch(e){case"command":return"command";case"debug":return"debug";case"error":return"error";case"warning":return"warning";case"section":return"section";default:return"default"}}},t[e].LiveLogsLineRegEx=/^\#+\[([^|\s\]]+).*?\](.*)/,t[e].StaticLogTokenizer=[{regex:new RegExp("##\\[[E|e]rror[^\\]]*].*"),action:{token:"error-token"}},{regex:new RegExp("##\\[[W|w]arning[^\\]]*].*"),action:{token:"warn-token"}},{regex:new RegExp("(.{27}Z )?##\\[[E|e]rror[^\\]]*].*"),action:{token:"error-token"}},{regex:new RegExp("(.{27}Z )?##\\[[W|w]arning[^\\]]*].*"),action:{token:"warn-token"}},{regex:new RegExp("(.{27}Z )?##\\[[I|i]nfo[^\\]]*].*"),action:{token:"info-token"}},{regex:new RegExp("(.{27}Z )?##\\[[S|s]ection[^\\]]*].*"),action:{token:"section-token"}},{regex:new RegExp("(.{27}Z )?##\\[[C|c]ommand[^\\]]*].*"),action:{token:"command-token"}},{regex:new RegExp("(.{27}Z )?##\\[[D|d]ebug[^\\]]*].*"),action:{token:"debug-token"}},{regex:new RegExp("(.{27}Z )?##\\[[V|v]erbose[^\\]]*].*"),action:{token:"info-token"}},{regex:new RegExp(V.TaskLogViewLimitExceededMessage),action:{token:"error-token"}}],t[e].LiveLogsTokenizer=[{regex:new RegExp("\\[[E|e]rror[^\\]]*].*"),action:{token:"error-token"}},{regex:new RegExp("\\[[W|w]arning[^\\]]*].*"),action:{token:"warn-token"}},{regex:new RegExp("\\[[I|i]nfo[^\\]]*].*"),action:{token:"info-token"}},{regex:new RegExp("\\[[S|s]ection[^\\]]*].*"),action:{token:"section-token"}},{regex:new RegExp("\\[[C|c]ommand[^\\]]*].*"),action:{token:"command-token"}},{regex:new RegExp("\\[[D|d]ebug[^\\]]*].*"),action:{token:"debug-token"}},{regex:new RegExp("\\[[V|v]erbose[^\\]]*].*"),action:{token:"info-token"}}]}("LiveLogsParser"),function(e){M=t[e]={},Object.defineProperty(t,"__esModule",{value:!0});const s="",o="â€Œ";t[e].RegexToIdentify=/\u200C/;const i=/(?:\u001b\[)(?:[\?|#])?(?:(?:[0-9]{1,3})?(?:(?:;[0-9]{0,3})*)?[A-Z|a-z])/;var n;t[e].ansiEscapeCodeRegexString="(?:\\[)(?:[?|#])?(?:(?:[0-9]{1,3})?(?:(?:;[0-9]{0,3})*)?[A-Z|a-z])",function(e){e.Reset="0",e.Bold="22",e.Italic="23",e.Underline="24",e.Fg="39",e.Bg="49"}(n||(n={}));const a={1:"bold",3:"italic",4:"underline"};t[e].bgColors={40:"b",41:"r",42:"g",43:"y",44:"bl",45:"m",46:"c",47:"w"},t[e].fgColors={30:"b",31:"r",32:"g",33:"y",34:"bl",35:"m",36:"c",37:"w",90:"gr"};t[e].AnsiParser=class{parse(e){let t="";return this.getStates(e).forEach(e=>{let s="";if(e.style){let t=e.style.fg,o=e.style.bg;t&&(s+=`ansifg-${t} `),o&&(s+=`ansibg-${o} `),e.style.bold&&(s+="fontWeightHeavy "),e.style.italic&&(s+=" italic"),e.style.underline&&(s+=" underline")}let i="<span";s&&(i+=` class='${s}'`),t+=(i+=">")+this._escape(e.output)+"</span>",t+=o}),t}getStates(o){let r=[];if(!i.test(o))return[{output:o}];let l="",c="",p="",u={},g=!1,h=[];for(let i=0;i<o.length;i++){const d=o[i];g?";"===d?p&&(h.push(p),p=""):"m"===d?(p&&(g=!1,h.push(p),u.style=u.style||{},h.forEach(s=>{const o=u.style;t[e].fgColors[s]?o.fg=t[e].fgColors[s]:t[e].bgColors[s]?o.bg=t[e].bgColors[s]:s===n.Fg?o.fg="":s===n.Bg?o.bg="":a[s]?o[a[s]]=!0:s===n.Bold?o.bold=!1:s===n.Italic?o.italic=!1:s===n.Underline&&(o.underline=!1)}),l="",c="",p=""),h=[]):2===p.length?(p="",g=!1,d!==s&&(l="",c+=d)):p+=d:l?l===s&&"["===d&&(g=!0,c&&(u.output=c,r.push(u),u={},c="")):d===s?l=d:c+=d}return c&&(u.output=c+(l||""),r.push(u)),r}_escape(e){let t="";for(let s=0;s<e.length;s++){const o=e.charAt(s);t+="&"===o?"&amp;":"<"===o?"&lt;":">"===o?"&gt;":'"'===o?"&quot;":"'"===o?"&#x27;":"/"===o?"&#x2F;":o}return t}}}("AnsiParser"),function(e){O=t.ExpandedLogsViewerComponent={},Object.defineProperty(t,"__esModule",{value:!0});const s="vss-code-editor-type",i="vss-content";class r extends a.Component{constructor(){super(...arguments),this._onResizeHandler=(()=>{this._editor&&this._editor.layout()}),this._getDefaultHeaderTitleSection=(e=>{const t=this.props.headerIconProps,s=this.props.headerstatusProps;return a.createElement("div",{className:"logs-expanded-view-header flex",role:"region","aria-label":V.LogsComponentHeaderRegionAriaLabel},a.createElement("div",{className:"logs-view-header-left-section flex"},a.createElement("div",{className:"header-title-container flex"},s&&a.createElement(n.Status,Object.assign({},s,{size:"16",className:"logs-expanded-view-task-status-icon"})),!s&&t&&a.createElement(m.VssIcon,{className:c.css("logs-expanded-view-task-status-icon","log-task-state",t.className),iconName:t.iconName,iconType:t.iconType}),a.createElement("div",{className:"header-title-container-tooltip-host"},a.createElement(d.Tooltip,{overflowOnly:!0,showOnFocus:!0,text:this.props.headerTitle},a.createElement("div",{role:"heading","aria-level":1,tabIndex:0,onKeyDown:this._onkeyDown,className:"header-title ellipsis-overflow"},this.props.headerTitle))))),a.createElement("div",{className:"logs-view-header-right-section"},a.createElement(p.Button,{subtle:!0,ariaLabel:V.TaskLogExpandedViewCloseButtonAriaLabel,className:"logs-expanded-view-close-button",iconProps:{className:"bowtie-icon bowtie-navigate-close logs-expanded-view-close-icon"},onClick:this._onCloseButtonClick,disabled:!1})))}),this._onkeyDown=(e=>{this._editor&&e&&e.shiftKey&&9===e.keyCode&&this._editor.focus()}),this._onCloseButtonClick=(()=>{this.props.onCloseClick&&this.props.onCloseClick()}),this._getLink=(e=>{const t=this.props.linkingOptions;return t?t.getLink(t.data,e):""}),this._readerOnLink=(e=>{if(this.props.pageContext){const t=this._getLink({lineStart:e});let s=!1;window.clipboardData&&(window.clipboardData.setData("text",t),s=!0);const i=e=>{e.clipboardData&&(e.clipboardData.setData("text",t),s=!0,e.preventDefault())};document.addEventListener("copy",i),document.execCommand("copy"),document.removeEventListener("copy",i),this.props.pageContext.getService("IVssLayoutManager").renderCallout(i=>{return a.createElement(_,{content:s?o.format(V.CopiedLink,e):o.format(V.CopyLinkFailed,t)},null)})}}),this._onEditorContentUpdated=(e=>{if(e&&this.props.followTail){const t=e.getModel().getLineCount();e.revealLine(t)}}),this._onEditorCreated=(e=>{if(e){this._editor=e,this._handleContent();const t=this.props.selection;t?t.lineStart&&!t.lineEnd?e.revealLine(t.lineStart):e.setSelection({startLineNumber:t.lineStart,endLineNumber:t.lineEnd,startColumn:t.colStart,endColumn:t.colEnd}):this.props.defaultLineNumber&&this.props.defaultLineNumber>0?e.revealLine(this.props.defaultLineNumber):e.focus(),e.addCommand(2,()=>{if(this._logsViewerElement){const e=this._logsViewerElement.querySelectorAll("[tabindex='0']");if(e){const t=e[0];t&&t.focus()}}}),e.onKeyDown(e=>{e&&9===e.keyCode&&this._onCloseButtonClick()})}}),this._handleContent=(()=>{const e=this._editor;if(e)try{const t=e.viewModel.getPlainTextToCopy;e.viewModel.getPlainTextToCopy=((s,o,i)=>{let n=t.apply(e.viewModel,[s,o,i]);const a=function(e){return e=(e=(e=(e=e||"").replace(/ (class='[a-z- A-Z]+')/g,"")).replace(/<span>/g,"")).replace(/<\/span>/g,"")};let r;return Array.isArray(n)?(r=[],n.forEach(e=>{r.push(a(e))})):r=a(n),r}),setTimeout(()=>{if(!e.model)return;let t=e.model.findMatches(M.ansiEscapeCodeRegexString,!1,!0,void 0,void 0,void 0,9999999);t=t||[];let s=new Set;const o=new M.AnsiParser;t.forEach(e=>{s.add(e.range.startLineNumber)});let n=[];s.forEach(t=>{const s=e.model.getLineContent(t),i=o.parse(s);n.push({text:i,range:{startLineNumber:t,endLineNumber:t,startColumn:1,endColumn:s.length+1}})}),e.model[i]=this.state.content,e.model.applyEdits(n)},0),setTimeout(()=>{if(!e.model)return;let t=e.model.findMatches("\0",!1,!1,void 0,void 0,void 0,9999999);t=t||[],e.model.applyEdits(t.map(e=>({text:" ",range:e.range})))},0)}catch(e){console.error(e)}})}componentWillMount(){window.HTMLRegex=M.RegexToIdentify,this.setState({content:this.props.content,showLineNumber:!!this.props.showLineNumber})}componentWillReceiveProps(e,t){if(e.content){const t=e.hideTimestamp?e.content.replace(/.{27}Z /gm,""):e.content,s=!!e.showLineNumber;if((this.state.content!==t||this.state.showLineNumber!==s)&&(this.setState({content:t,showLineNumber:s}),this.state.content!==t&&this._editor)){const e=this._editor.getModel();if(e){(e[i]||e.getValue())!==t&&(e.setValue(t),this._handleContent())}}}}componentDidMount(){this.props.componentRef&&this.props.componentRef(this),window.addEventListener("resize",this._onResizeHandler)}render(){return this.props.showPanel&&a.createElement(g.CustomPanel,{onDismiss:this._onCloseButtonClick,size:2,contentClassName:"logs-expanded-panel",className:"logs-expanded-view-panel"},a.createElement("div",{className:"logs-expand-view custom-scrollbar flex-column flex-grow",ref:e=>this._logsViewerElement=e},a.createElement(u.CustomHeader,null,this._getHeaderContent()),a.createElement(g.PanelContent,null,this._getLogsSection())))}componentWillUnmount(){window.removeEventListener("resize",this._onResizeHandler),this._editor&&(this._editor.model&&delete this._editor.model[i],this._editor.dispose(),this._editor=null),window.HTMLRegex=void 0}focus(){this._editor&&this._editor.focus()}_getHeaderContent(){return this.props.onRenderHeader?this.props.onRenderHeader(this.props,this._getDefaultHeaderTitleSection):this._getDefaultHeaderTitleSection(this.props)}_getLogsSection(){let e;const t=()=>a.createElement(l.Spinner,{size:"large",label:V.LoadingLegacyComponent});if(this.props.pageContext&&T.isFeatureEnabled(this.props.pageContext,"ms.vss-distributedtask-web.log-reader",!1))e=a.createElement(k.Reader,Object.assign({content:this.state.content,lineToScroll:this.props.selection?this.props.selection.lineStart:void 0},this.props.linkingOptions?{onLineClick:this._readerOnLink}:{},{autoScroll:this.props.followTail,onScrollToLine:this.props.onScrollToLine}));else{const o={name:"text/vsts-dtc-log",tokenizer:r._getLogTokenizer(!!this.props.isLive),ignoreCase:!0,tokenPostfix:""};e=a.createElement(L.LegacyComponent,Object.assign({className:"logs-editor-host",wrappedType:s,modules:["CodeEditor/Components/Editor"],monacoTheme:"vs-dark",editorOptions:this._getEditorOptions(),editorRef:this._onEditorCreated,onContentUpdated:this._onEditorContentUpdated,content:{content:this.state.content,contentType:o},loadingComponent:t,lazyVisualContentChange:!0},this.props.linkingOptions?{getLink:this._getLink}:{}))}return a.createElement("div",{className:"logs-expanded-view-logs-section",role:"region","aria-label":V.LogsComponentContentRegionAriaLabel},this.props.fetchLogInProgress?a.createElement(l.Spinner,{className:"logs-view-spinner",label:V.FetchingLogLoadingComponentLabel,size:"large"}):this.props.pageContext?a.createElement(f.ReactRootComponent,{pageContext:this.props.pageContext},e):e)}_getEditorOptions(){return{readOnly:!0,lineNumbers:this.state.showLineNumber?"on":"off",scrollbar:{horizontalScrollbarSize:16},extraEditorClassName:"logs-view-monaco-editor"}}static _getLogTokenizer(e){return{root:e?F.LiveLogsTokenizer:F.StaticLogTokenizer}}}t.ExpandedLogsViewerComponent.ExpandedLogsViewerComponent=r;class _ extends a.Component{constructor(){super(...arguments),this._toastRef=a.createRef()}render(){return a.createElement(h.Toast,{ref:this._toastRef,message:this.props.content})}componentDidMount(){setTimeout(()=>{this._toastRef&&this._toastRef.current&&this._toastRef.current.fadeOut()},2e3)}}}(),function(e){var s;U=t.LogsTelemetryHelper={},Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.downloadLogsClickSource="downloadLogsClickSource"}(s=t.LogsTelemetryHelper.LogsTelemetryProperties||(t.LogsTelemetryHelper.LogsTelemetryProperties={}));const o="taskStepComponent",i="viewIssuesInPanel",n="phaseIssuesErrorCount",a="phaseIssuesWarningCount";t.LogsTelemetryHelper.LogsTelemetryHelper=class{static publishDownloadLogsTelemetry(e,t){if(!e)return;const i=e.getService("IVssTelemetryService"),n={};n[s.downloadLogsClickSource]=t,i.publishEvent("DT-Logs-Temeletry-Area",o,n)}static publishIssuesPanelTelemetry(e,t,s){if(!e)return;const o=e.getService("IVssTelemetryService"),r={};r[n]=t?t.length:0,r[a]=s?s.length:0,o.publishEvent("DT-Logs-Temeletry-Area",i,r)}}}(),function(e){B=t.IssuesComponent={},Object.defineProperty(t,"__esModule",{value:!0});t.IssuesComponent.IssuesComponent=class extends a.Component{constructor(e){super(e),this._onRenderText=(()=>{const e=this.props.issues;if(!e)return null;let t="";for(const s of e)if(s.message){t=s.message.trim();break}const s=this._getIssuesInfo(),i=s.errors&&s.errors.length,n=s.warnings&&s.warnings.length,r=i>1?V.Errors:V.Error,l=n>1?V.Warnings:V.Warning;return a.createElement("div",{className:"logs-phase-issue-header-container",key:"issue-container-key"},a.createElement("div",{className:"logs-phase-issue-header"},a.createElement("h3",{className:"logs-phase-issue-header-text"},this.props.headerText),a.createElement("div",{className:"logs-phase-issue-header-separator"},"Â·"),a.createElement("h4",{className:"logs-phase-issue-info flex"},i>0&&a.createElement("span",null,o.localeFormat(r,i)),i>0&&n>0&&a.createElement("span",{className:"logs-phase-issue-separator"},"Â·"),n>0&&a.createElement("span",null,o.localeFormat(l,n)))),a.createElement("div",{className:"logs-phase-issue-sub-status flex"},a.createElement("div",{className:"logs-phase-issue-message ellipsis-overflow"},t)))}),this._showExpandedIssuesView=(()=>{this.setState({showPanel:!0}),this._publishTelemetryToViewIssuesInPanel()}),this._onCloseClick=(()=>{this.setState({showPanel:!1})}),this._issuesInfo=null,this.state={showPanel:!1}}render(){const e=this._getIssuesInfo(),t=e.errors&&e.errors.length,s=e.warnings&&e.warnings.length;if(t>0||s>0){const e=t>0?"Error":"Warning";return a.createElement("div",{className:"logs-phase-issue-container"},a.createElement(_.MessageBar,{severity:e,className:"logs-error-message-bar-container"},a.createElement(p.Button,{subtle:!0,className:"logs-error-message-action-button",onClick:this._showExpandedIssuesView,ariaLabel:V.IssuesButtonAriaLabel},this._onRenderText())),this.state.showPanel&&a.createElement(O.ExpandedLogsViewerComponent,{showPanel:this.state.showPanel,headerTitle:this.props.headerText,headerIconProps:{iconName:"StatusErrorFull",className:"state-failed",iconType:0},headerstatusProps:Object.assign({},n.Statuses.Failed),fetchLogInProgress:!1,isLive:!0,followTail:!1,showLineNumber:!1,content:this._getContent(),onCloseClick:this._onCloseClick,pageContext:this.props.pageContext}))}return null}_getIssuesInfo(){if(!this._issuesInfo){const e=this.props.issues||[],t=[],s=[];let i=0,n=0;e.forEach(e=>{e.message&&(1===e.issueType?(i++,t.push(o.localeFormat("##[Error {0}]\r\n{1} \r\n\r\n",i,e.message.trim()))):(n++,s.push(o.localeFormat("##[Warning {0}]\r\n{1} \r\n\r\n",n,e.message.trim()))))}),this._issuesInfo={errors:t,warnings:s}}return this._issuesInfo}_getContent(){let e="";if(this._issuesInfo){const t=this._issuesInfo.errors||[],s=this._issuesInfo.warnings||[];t.forEach(t=>{e+=t}),s.forEach(t=>{e+=t})}return e}_publishTelemetryToViewIssuesInPanel(){this._issuesInfo&&U.LogsTelemetryHelper.publishIssuesPanelTelemetry(this.props.pageContext,this._issuesInfo.errors,this._issuesInfo.warnings)}}}(),function(e){W=t.StepComponent={},Object.defineProperty(t,"__esModule",{value:!0});t.StepComponent.StepComponent=class extends a.Component{constructor(){super(...arguments),this._onClick=(e=>{this.props.onActionClick&&this.props.onActionClick(e)}),this._onRenderText=(()=>{const e=this.props.stepStatuses||(this.props.stepStatus?[this.props.stepStatus]:[]),t=this.props.uniqueKey||v.getId("step-name-key");return a.createElement("div",{className:"left-section-step-name flex",key:t},a.createElement("div",{className:"left-section-step-title ellipsis-overflow"},this.props.title),this.props.hasSepartor&&a.createElement("div",{className:"left-section-step-status-separator"},"Â·"),e.length>0&&e.map((e,t)=>a.createElement("div",{key:t,className:c.css("left-section-step-status","log-task-state",e.className)},e.status)))})}render(){const e=!this.props.isTitleClickable;let t="step-log-component-action-button",s="";e&&(s="disabled-step",t=c.css(t,s));const o=v.getId("step-log-view-description");return a.createElement(b.FocusZone,{direction:b.FocusZoneDirection.horizontal,isCircularNavigation:!1},a.createElement("div",{className:"step-log-view-container","aria-label":this.props.ariaLabel,"aria-describedby":o},a.createElement("div",{id:o,className:"hidden"},this.props.ariaDescription),a.createElement("div",{className:c.css(this.props.cssClass,"step-log-content","flex")},a.createElement("div",{className:"step-log-component-left-section flex"},this.props.statusProps&&a.createElement(n.Status,Object.assign({},this.props.statusProps.statusProps,{className:c.css("left-section-step-status-icon","left-section-step-status",this.props.statusProps.className),size:"16"})),!this.props.statusProps&&this.props.iconProps&&a.createElement(m.VssIcon,{className:c.css(this.props.iconProps.className,"left-section-step-status-icon"),iconName:this.props.iconProps.iconName,iconType:this.props.iconProps.iconType,title:this.props.iconProps.title,style:this.props.iconProps.style}),a.createElement("span",{className:c.css("left-step-tooltip-host",s)},a.createElement(p.Button,{subtle:!0,className:t,disabled:e,onClick:this._onClick,ariaLabel:this.props.buttonAriaDescription,tooltipProps:{showOnFocus:!0,text:this.props.tooltipContent}},this._onRenderText())),this._getInfoButton()),a.createElement("div",{className:"step-log-component-right-section flex"},this.props.rightSection))))}_getInfoButton(){return this.props.infoProps&&this.props.infoProps.tooltipContent&&a.createElement("div",null,a.createElement("span",{key:"step-info-tooltip",className:"dt-tooltip-pre-line"},a.createElement(p.Button,{subtle:!0,className:"step-info-button",iconProps:{iconName:this.props.infoProps.iconName},ariaLabel:this.props.infoProps.iconAriaLabel,tooltipProps:{showOnFocus:!0,text:this.props.infoProps.tooltipContent}})))}}}(),function(e){j=t.PhaseSummaryView={},Object.defineProperty(t,"__esModule",{value:!0});const s=A.LogsViewUtility;class i extends f.VssComponent{constructor(){super(...arguments),this._onDownLoadLogClick=((e,t)=>{this.props.logUrl&&(s.downloadLog(this.props.logUrl),U.LogsTelemetryHelper.publishDownloadLogsTelemetry(this.context.pageContext||this.props.pageContext,"PhaseLogDownload"))})}componentDidMount(){this._fetchQueueDetails()}render(){return a.createElement("div",{className:c.css(this.props.cssClass,"phase-summary-container")},this._getPrimaryDetailsRow(),this._getSecondaryDetailsRow())}componentDidUpdate(e){e.queueId!==this.props.queueId&&this._fetchQueueDetails()}_getPrimaryDetailsRow(){return a.createElement("div",{className:"primary-details-row flex"},this._getPhaseName(),a.createElement("div",{className:"time-details-section flex"},this.props.startTime&&this._getStartTimeSection()))}_getSecondaryDetailsRow(){return a.createElement("div",{className:"secondary-details-row flex"},this._renderSecondaryRowLeftSection(),this._getSecondaryRowRightSection())}_renderSecondaryRowLeftSection(){let e;return e=this.props.onRenderSecondaryDetailsLeftSection?this.props.onRenderSecondaryDetailsLeftSection():this.state&&this.state.fetchQueueInProgress?this._getQueueLoadingComponent():this._getAgentDetailsSection(),a.createElement("div",{className:"secondary-row-left-section"},e)}_getQueueLoadingComponent(){return a.createElement("div",{className:"queue-loading-component flex"},a.createElement("div",{className:"queue-loading-spinner"},a.createElement(l.Spinner,{className:"queue-fetch-spinner",size:"xsmall"})),a.createElement("div",{className:"queue-loading-text"},V.FetchingAgentInformationText))}_getPhaseName(){return a.createElement("div",{className:"phase-name-container"},a.createElement(d.Tooltip,{overflowOnly:!0,text:this.props.name},a.createElement("div",{className:"phase-name ellipsis-overflow",role:"heading","aria-level":2},this.props.name)))}_getStartTimeSection(){return a.createElement("div",{className:"start-time-section"},o.localeFormat(V.PhaseSummaryStartTimeText,this.props.startTime.toLocaleString()))}_getSecondaryRowRightSection(){let e=null;return this.props.onRenderAuxiliaryDetailsRightSection&&(e=this.props.onRenderAuxiliaryDetailsRightSection()),a.createElement("div",{className:"phase-summary-secondary-row-right-section flex"},e,this.props.startTime&&this._getContextualMenu(),this.props.startTime&&this._getDurationComponent())}_getAgentDetailsSection(){return a.createElement("div",{className:"agent-details-section flex"},this.state&&this.state.queueName&&a.createElement("div",{className:"queue-details flex"},a.createElement("div",{className:"queue-name-title"},V.QueueNameLabel),a.createElement(r.Link,{className:"queue-name-link ellipsis-overflow",href:this.state.queueUrl,target:"_blank",rel:"noopener noreferrer","aria-label":this.state.queueName,"aria-describedby":"queue-name-description"},a.createElement("div",{id:"queue-name-description",className:"hidden"},V.ViewQueueDescription),this.state.queueName)),this.props.agentName&&this.state&&this.state.queueName&&this._getSeparator(),this.props.agentName&&a.createElement("div",{className:"agent-details"},a.createElement("div",{className:"agent-name-section"},o.localeFormat(V.AgentName,this.props.agentName))))}_getSeparator(){return a.createElement("div",{className:"phase-summary-separator"},"Â·")}_getContextualMenu(){let e=this._getOverFlowButtons();return 0===e.length?null:a.createElement("div",{className:"phase-summary-ellipses-container"},a.createElement(S.MenuButton,{subtle:!0,hideDropdownIcon:!0,className:"phase-summary-ellipsis-button",iconProps:{iconName:"More"},ariaLabel:V.MorePhaseSummaryOptionsEllipsesButtonAriaLabel,contextualMenuProps:{menuProps:{id:"show-more-options-menu",items:e}}}))}_getOverFlowButtons(){const e=[];if(this.props.logUrl){const t={text:V.DownloadLogMenuitemLabel,id:"download-log",iconProps:{className:"bowtie-icon bowtie-transfer-download"},disabled:!this.props.logUrl,className:"fabric-style-overrides commandBar-hover-override show-logs",onActivate:this._onDownLoadLogClick};e.push(t)}return e}_getDurationComponent(){return a.createElement("div",{className:"phase-summary-clock-container"},a.createElement(C.Duration,{startDate:this.props.startTime,endDate:this.props.finishTime}))}_fetchQueueDetails(){const e=this.context.pageContext||this.props.pageContext;if(e)if(this.props.queueId&&this.props.queueId>0){if(this.setState({fetchQueueInProgress:!0}),!i._getAgentQueueCache[this.props.queueId]){const t=e.getService("IVssNavigationService").getCurrentRoute().routeValues.project||"",s=w.getTaskAgentClient(e);i._getAgentQueueCache[this.props.queueId]=s.getAgentQueue(this.props.queueId,t)}i._getAgentQueueCache[this.props.queueId].then(e=>{if(e){let t=s.getQueueUrl(e.id,this.context.pageContext||this.props.pageContext);this.setState({fetchQueueInProgress:!1,queueName:e.name,queueUrl:t})}else this.setState({fetchQueueInProgress:!1})},e=>{this.setState({fetchQueueInProgress:!1})})}else this.setState({fetchQueueInProgress:!1});else this.setState({fetchQueueInProgress:!1})}}i._getAgentQueueCache={},t.PhaseSummaryView.PhaseSummaryView=i}(),function(e){H=t.ExpandedLogsTaskHeader={},Object.defineProperty(t,"__esModule",{value:!0});const s=A.LogsViewUtility;let o=x.DefaultPalette.white;t.ExpandedLogsTaskHeader.ExpandedLogsTaskHeader=class extends a.Component{constructor(e){super(e),this._onkeyDown=(e=>{this.props.onHeadingTextKeyDown&&this.props.onHeadingTextKeyDown(e)}),this._toggleFollowTail=((e,t)=>{this.setState({followTail:t}),this.props.onFollowTailChange&&this.props.onFollowTailChange(t)}),this._onNextTaskNavigate=(()=>{this.props.onNextTaskButtonClicked&&this.props.onNextTaskButtonClicked()}),this._onPreviousTaskNavigate=(()=>{this.props.onPreviousTaskButtonClicked&&this.props.onPreviousTaskButtonClicked()}),this._onCloseButtonClick=(()=>{this.props.onCloseClick&&this.props.onCloseClick()}),this.state={followTail:!!this.props.isLive};const t=this.props.pageContext?this.props.pageContext.getService("IVssThemeService"):null;t&&(o=`rgba(${t.getThemeValue("palette-neutral-0")}, 1)`)}componentDidUpdate(e){e.isLive!==this.props.isLive&&this.setState({followTail:!!this.props.isLive})}render(){const e=this.props.task,t=s.getIssuesWithType(1,e),o=s.getTaskStatus(e.state,t?t.length:0);return a.createElement("div",{className:"logs-task-expanded-view-header flex",role:"region","aria-label":V.LogsComponentHeaderRegionAriaLabel},a.createElement("div",{className:"logs-view-header-left-section flex"},a.createElement("div",{className:"header-title-container flex"},o.statusProps&&a.createElement(n.Status,Object.assign({},o.statusProps,{size:"16",className:"logs-expanded-view-task-status-icon"})),!o.statusProps&&a.createElement(m.VssIcon,{className:c.css("logs-expanded-view-task-status-icon","log-task-state",o.className),iconName:o.iconName,iconType:0}),a.createElement("div",{className:"header-title-container-tooltip-host"},a.createElement(d.Tooltip,{overflowOnly:!0,showOnFocus:!0,text:e.name},a.createElement("div",{role:"heading","aria-level":1,className:"logs-task-name ellipsis-overflow",tabIndex:0,onKeyDown:this._onkeyDown,"data-is-focusable":!0},e.name))))),a.createElement("div",{className:"logs-view-header-right-section"},this.props.picklistDropdownProps?a.createElement(E.PickListDropdown,Object.assign({className:"logs-header-picklist-title flex"},this.props.picklistDropdownProps)):null,!this.props.picklistDropdownProps&&this._getLogsViewActionSection(),a.createElement("div",{className:"logs-header-separator"}),this._getCloseViewButton()))}_getLogsViewActionSection(){const e=this._isAnyNavigationButtonEnabled(),t=this.props.previousTaskDisplayText?this.props.previousTaskDisplayText:V.PreviousTaskButtonText,s=this.props.nextTaskDisplayText?this.props.nextTaskDisplayText:V.NextTaskButtonText;return a.createElement("div",{className:"logs-view-actions-section flex"},this._getFollowTailToggle(),e&&this._getNavigationButton("Up",t,!this.props.previousTaskButtonEnabled,this._onPreviousTaskNavigate),e&&this._getNavigationButton("Down",s,!this.props.nextTaskButtonEnabled,this._onNextTaskNavigate))}_isAnyNavigationButtonEnabled(){return!!this.props.nextTaskButtonEnabled||!!this.props.previousTaskButtonEnabled}_getNavigationButton(e,t,s,o){return a.createElement("div",{className:"navigate-task-button"},this._getButton(t,e,s,o))}_getFollowTailToggle(){return this.props.isLive?a.createElement("div",{className:"follow-tail-toggle"},a.createElement(y.Toggle,{checked:this.state.followTail,onText:V.LogComponentFollowTailToggleLabel,onAriaLabel:V.FollowTailEnabled,offText:V.LogComponentFollowTailToggleLabel,offAriaLabel:V.FollowTailDisabled,onChange:this._toggleFollowTail})):null}_getButton(e,t,s,o){let i="logs-view-action-button";return s&&(i="logs-view-action-button logs-view-action-button-disabled"),a.createElement(p.Button,{subtle:!0,className:i,iconProps:{className:"logs-view-action-button-icon",iconName:t},ariaLabel:e,disabled:s,onClick:o},e)}_getCloseViewButton(){return a.createElement(p.Button,{subtle:!0,ariaLabel:V.TaskLogExpandedViewCloseButtonAriaLabel,className:"logs-expanded-view-close-button",iconProps:{className:"bowtie-icon bowtie-navigate-close logs-expanded-view-close-icon"},onClick:this._onCloseButtonClick,disabled:!1})}}}(),function(e){K=t.LogLine={},Object.defineProperty(t,"__esModule",{value:!0});const s=A.LogsViewUtility;t.LogLine.LogLine=class extends a.Component{constructor(){super(...arguments),this._onLogLineClick=(e=>{e&&(e.stopPropagation(),e.preventDefault()),this.props.logLine.lineNumber&&this.props.onNavigateToLog&&this.props.onNavigateToLog(this.props.logLine.lineNumber)})}render(){const e=this.props.logLine;return e?e.lineNumber?a.createElement(r.Link,{className:"log-line-link",onClick:this._onLogLineClick,rel:"noopener noreferrer"},this._getLogLineElement(e)):this._getLogLineElement(e):null}_getLogLineElement(e){return a.createElement("div",{className:c.css("log-line-container","flex",this._getLogLineClass(e.logType)),onClick:this._onLogLineClick},this.props.showSectionIcons&&a.createElement("div",{className:c.css("log-content-icon","bowtie-icon",s.getLogSectionIcon(e.logType))}),a.createElement("div",{className:"log-content-container"},this._getLogLines(e)))}_getLogLines(e){const t=e.content;return t?s.splitLogLine(t).map((e,t)=>a.createElement("div",{className:"line-content",key:t},e)):[a.createElement("div",{className:"line-content",key:"empty-line"},"\r\n")]}_getLogLineClass(e){return e||(e="default"),"logs-console-line-"+e}}}(),function(e){z=t.LogsSummaryView={},Object.defineProperty(t,"__esModule",{value:!0});const s=500,o=50,i=18,n=10;t.LogsSummaryView.LogsSummaryView=class extends a.Component{render(){if(this.props.maxLogs&&this.props.maxLogs>s)throw new Error("A maximum of "+s+" lines of logs are allowed.");let e=this.props.logLines;const t=this.props.maxLogs?this.props.maxLogs:o,i=this._getContainerDivStyle(t);return e.length>t&&(e=e.slice(e.length-t,e.length)),a.createElement("div",{className:c.css("dtc-logs-summary",this.props.cssClass),ref:"_parentElement",style:i},e.map((e,t)=>a.createElement(K.LogLine,{onNavigateToLog:this.props.onNavigateToLog,key:t,showSectionIcons:this.props.showSectionIcons,logLine:e})))}componentDidUpdate(){this._parentElement&&(this._parentElement.scrollTop=this._parentElement.scrollHeight)}_getContainerDivStyle(e){const t={lineHeight:i+"px",padding:n+"px"};return this.props.fixedHeight&&(t.height=e*i+n),t}}}(),function(e){Q=t.TaskLogStepComponent={},Object.defineProperty(t,"__esModule",{value:!0});const s=A.LogsViewUtility,i=20,n=5e3;t.TaskLogStepComponent.TaskLogStepComponent=class extends a.Component{constructor(e){super(e),this._fetchLogsFromLogUrl=(()=>{const e=this.props.task;s.isLiveComponentVisible(e)&&e.logUrl&&s.fetchLogs(e,!0).then(e=>{const t=e.slice(e.length-n);this.setState({initialTaskData:F.LiveLogsParser.formatLogLine(t)})})}),this._onNavigateToError=(e=>{this.props.showExpandedLogsView(this.props.task,e)}),this._onMouseOver=(()=>{this._isTaskLogStepSelected||this._setShowDownloadLogButtonState(!0)}),this._onMouseLeave=(()=>{this._isTaskLogStepSelected||this._setShowDownloadLogButtonState(!1)}),this._onBlur=(()=>{this._isTaskLogStepSelected=!1,this._setShowDownloadLogButtonState(!1)}),this._onFocus=(()=>{this._isTaskLogStepSelected=!0,this._setShowDownloadLogButtonState(!0)}),this._onDownLoadLogClick=(e=>{this.props.task&&this.props.task.logUrl&&(A.LogsViewUtility.downloadLog(this.props.task.logUrl),U.LogsTelemetryHelper.publishDownloadLogsTelemetry(this.props.pageContext,"TaskStepDownloadLog"))}),this._onShowLogClick=(e=>{this.props.showExpandedLogsView&&this.props.showExpandedLogsView(this.props.task)}),this.state={shouldShowDownloadLogButton:!1,initialTaskData:[]},this._fetchLogsFromLogUrl=(new I.TimerManagement).throttle(this._fetchLogsFromLogUrl,2e3)}render(){const e=this.props.task;if(e){const t=this._getTaskOverviewAriaLabel(),o=this._getTaskOverviewAriaDescription(),i=s.showExpandViewEnabled(e),n=2!==e.state||!!e.percentComplete,r=s.getIssuesWithType(1,e),l=s.getIssuesWithType(2,e),p=s.getTaskStatus(e.state,r?r.length:0,e.percentComplete),u=s.getWarningStatus(l?l.length:0),g=c.css("left-section-task-status-icon","log-task-state",p.className),h=e.timelineRecordId||e.taskId,d="task-log-step-view-description"+h,m=i?V.TaskLogExpandViewButtonName:"";let L=[{status:p.status,className:p.className}];return u&&L.push({status:u.status,className:u.className}),a.createElement("div",{"data-is-focusable":!0,role:"listitem",className:c.css(this.props.cssClass,"task-log-view-container"),onMouseOver:this._onMouseOver,onBlur:this._onBlur,onFocus:this._onFocus,onMouseLeave:this._onMouseLeave,"aria-label":t,"aria-describedby":d},a.createElement("div",{id:d,className:"hidden"},o),a.createElement(W.StepComponent,Object.assign({uniqueKey:h,buttonAriaDescription:V.ExpandViewAriaDescription,isTitleClickable:i,title:e.name,infoProps:{tooltipContent:e.resultCode,iconName:"Info",iconAriaLabel:V.Info},hasSepartor:n,stepStatuses:L,iconProps:{className:g,iconName:p.iconName,iconType:0,title:p.status}},p.statusProps?{statusProps:{statusProps:p.statusProps}}:{},{onActionClick:this._onShowLogClick,cssClass:"task-log-step-content",tooltipContent:m,rightSection:this._getRightSection()})),s.isLiveComponentVisible(e)&&this._getLiveLogComponent(e),!s.isLiveComponentVisible(e)&&this._getLogsErrorComponent())}return null}componentDidMount(){this._fetchLogsFromLogUrl()}_getTaskOverviewAriaLabel(){const e=this.props.task,t=s.getIssuesWithType(2,e),i=s.getWarningStatus(t?t.length:0);if(e){const t=s.getIssuesWithType(1,e),n=s.getTaskStatus(e.state,t?t.length:0);let a="";return s.isTaskInProgress(e)?(e.percentComplete&&(a=o.format(V.PercentComplete,e.percentComplete)),o.format(V.InProgressTaskLogStepOverviewAriaLabel,e.name,V.InProgress,a,s.getTimeDiffFriendlyString(e.startTime,e.finishTime))):s.hasTaskCompleted(e)?o.format(V.CompletedTaskLogStepOverviewAriaLabel,e.name,n.status,i?i.status:"",s.getTimeDiffFriendlyString(e.startTime,e.finishTime)):o.format(V.NotStartedTaskLogStepOverviewAriaLabel,e.name,n.status)}return""}_getTaskOverviewAriaDescription(){let e=V.TaskLogStepOptionsDescription;const t=this.props.task,o=s.getIssuesWithType(1,this.props.task);return s.isLiveComponentVisible(t)?e+=V.TaskLogStepOverviewLiveLogDescription:o&&o.length>0&&(e+=V.TaskLogStepOverviewErrorLogsDescription),e}_getLiveLogComponent(e){let t=[];return e.liveLogsData?(e.liveLogsData.logLines&&(t=e.liveLogsData.logLines),a.createElement(z.LogsSummaryView,{logLines:this.state.initialTaskData.concat(t),maxLogs:e.liveLogsData.maxLogs,fixedHeight:!0})):null}_getLogsErrorComponent(){const e=s.getIssuesWithType(1,this.props.task);if(e&&e.length>0){const t=s.getLogLinesFromIssues(e,i);return a.createElement(z.LogsSummaryView,{onNavigateToLog:this._onNavigateToError,logLines:t,showSectionIcons:!0})}return null}_setShowDownloadLogButtonState(e){this.setState({shouldShowDownloadLogButton:e})}_getRightSection(){return a.createElement("div",{className:"task-log-step-component-right-section flex"},this._getDownloadZipButton(),this._getDurationComponent())}_getDownloadZipButton(){return this.state&&this.state.shouldShowDownloadLogButton?a.createElement("div",{className:"task-log-step-download-log-container"},a.createElement(p.Button,{subtle:!0,className:"task-component-download-button",iconProps:{iconName:"ZipFolder"},onClick:this._onDownLoadLogClick,disabled:!this.props.task.logUrl,ariaLabel:V.DownloadLogMenuitemLabel,tooltipProps:{text:V.DownloadLogMenuitemLabel}})):null}_getDurationComponent(){const e=this.props.task,t=e.startTime||new Date;return a.createElement("div",{className:"task-log-clock-container"},s.isTaskInProgress(e)||s.hasTaskCompleted(e)?a.createElement(C.Duration,{startDate:t,endDate:e.finishTime}):null)}}}(),function(e){Z=t.TaskListLogsControllerView={},Object.defineProperty(t,"__esModule",{value:!0});const s=A.LogsViewUtility,o="task-log-step-component-container";t.TaskListLogsControllerView.TaskListLogsControllerView=class extends a.Component{constructor(){super(...arguments),this._onRenderItem=((e,t)=>{if(this.props.onRenderTaskLog){const s=this.props.onRenderTaskLog(e,t,this._getTaskLogComponent);if(s)return s}return this._getTaskLogComponent(e,t)}),this._getTaskLogComponent=((e,t)=>{const s=e&&2===e.state&&e.liveLogsData?"task-state-inprogress":"";return a.createElement(Q.TaskLogStepComponent,{key:e.timelineRecordId||e.taskId,task:e,showExpandedLogsView:this._showLogLineExpandedView,pageContext:this.props.pageContext,cssClass:c.css(o,s,`${o}-${(t||0)+1}`)})}),this._getHeader=(()=>{const e=this._getExpandedTask(),t=this._isLiveLog(e);return e?a.createElement(H.ExpandedLogsTaskHeader,{task:e,logUrl:e.logUrl,isLive:t,onCloseClick:this._onCloseClick,nextTaskButtonEnabled:!!s.getNextTask(this.props.tasks,this.state.expandedTaskRank),previousTaskButtonEnabled:!!s.getPreviousTask(this.props.tasks,this.state.expandedTaskRank),onNextTaskButtonClicked:this._onNextTaskClicked,onPreviousTaskButtonClicked:this._onPreviousTaskClicked,onFollowTailChange:this._onFollowTailChange,onHeadingTextKeyDown:this._onHeadingTextKeyDown,pageContext:this.props.pageContext}):null}),this._onHeadingTextKeyDown=(e=>{this._logsViewerElement&&e&&e.shiftKey&&9===e.keyCode&&this._logsViewerElement.focus()}),this._disableAutoScroll=(()=>{!this._isAutoScrollInProgress&&(this._isAutoScrollDisabled=!0)}),this._showLogLineExpandedView=((e,t)=>{this._showLogExpandedView(e,t?{lineStart:t}:void 0)}),this._showLogExpandedView=((e,t)=>{const o=t?t.lineStart:void 0;let i={showPanel:!0,defaultLogLineNumber:o};if(s.isLiveComponentVisible(e))(e.logUrl?s.fetchLogs(e,!0):Promise.resolve("")).then(i=>{const n=i||s.getLogsFromLiveLogData(e.liveLogsData);this.setState({expandedTaskContent:n,fetchLogInProgress:!1,defaultLogLineNumber:o,followTail:!0,selection:t})});else{const n=this._getExpandedTask();n&&e.taskId===n.taskId||(i.fetchLogInProgress=!0),s.fetchLogs(e).then(e=>{this.setState({expandedTaskContent:e,fetchLogInProgress:!1,defaultLogLineNumber:o,selection:t})})}const n=e.rank;i.expandedTaskRank=n,this.setState(i),this.props.onPanelOpen&&this.props.verticalTabItemKey&&this.props.onPanelOpen(this.props.verticalTabItemKey)}),this._onPreviousTaskClicked=(()=>{if(this._onPanelChanged(),this.state){const e=s.getPreviousTask(this.props.tasks,this.state.expandedTaskRank);e&&this._showLogExpandedView(e)}}),this._onNextTaskClicked=(()=>{if(this._onPanelChanged(),this.state){const e=s.getNextTask(this.props.tasks,this.state.expandedTaskRank);e&&this._showLogExpandedView(e)}}),this._onCloseClick=(()=>{this._setInitialState(),this._onPanelChanged()}),this._onFollowTailChange=(e=>{this.setState({followTail:e})}),this._isAutoScrollDisabled=!1,this._isAutoScrollInProgress=!1}componentWillMount(){this._setInitialState(),s.fixTasksRank(this.props.tasks)}componentDidMount(){this._parentElement=this._getScrollParent(this._contentContainer),this._attachScrollEvent(),setTimeout(()=>{this._scrollRequiredItemToView(),this._select()},0)}componentDidUpdate(e,t){this._isAutoScrollDisabled||(this._scrollRequiredItemToView(),this.props.selectTaskOptions!==e.selectTaskOptions&&this._select())}componentWillUnmount(){this._detachScrollEvent()}componentWillUpdate(e,t){e.tasks&&e.tasks.length>0&&s.fixTasksRank(e.tasks)}render(){return this.props.tasks&&this.props.tasks.length>0?this._getTaskListLogsContentInternal():null}_getTaskListLogsContentInternal(){const e=this._getExpandedTask(),t=this._isLiveLog(e);return a.createElement("div",{className:"logs-task-list-container",ref:e=>this._contentContainer=e},a.createElement(b.FocusZone,{className:"task-list-logs",direction:b.FocusZoneDirection.vertical,isInnerZoneKeystroke:e=>39===e.which},a.createElement(P.List,{role:"list",items:[...this.props.tasks],onShouldVirtualize:()=>!1,onRenderCell:this._onRenderItem})),this.state&&this.state.showPanel&&a.createElement(O.ExpandedLogsViewerComponent,Object.assign({componentRef:e=>this._logsViewerElement=e,showPanel:this.state.showPanel,fetchLogInProgress:this.state.fetchLogInProgress,followTail:this.state.followTail,isLive:t,showLineNumber:!t,content:this._getLogContent(),onCloseClick:this._onCloseClick,onRenderHeader:this._getHeader,defaultLineNumber:this.state.defaultLogLineNumber,pageContext:this.props.pageContext},e&&e.linkingOptions?{linkingOptions:e.linkingOptions}:{},{selection:this.state.selection,hideTimestamp:this.props.hideTimestamp,onScrollToLine:this.props.onScrollToLine})))}_attachScrollEvent(){this._parentElement&&this._parentElement.addEventListener("scroll",this._disableAutoScroll)}_detachScrollEvent(){this._parentElement&&this._parentElement.removeEventListener("scroll",this._disableAutoScroll),this._isAutoScrollDisabled=!1}_getScrollParent(e){return e&&N.findScrollableParent(e)}_isLiveLog(e){return!!e&&s.isLiveComponentVisible(e)}_getExpandedTask(){if(this.state){const e=s.getTaskIndexForGivenRank(this.state.expandedTaskRank,this.props.tasks);if(e>=0)return this.props.tasks[e]}return null}_onPanelChanged(){this.props.onPanelChanged&&this.props.onPanelChanged()}_getLogContent(){const e=this._getExpandedTask();if(this.state){let t=e&&e.logUrl?this.state.expandedTaskContent:"";if(this.state.expandedTaskRank>=0&&e&&this._isLiveLog(e)){const o=s.getLogsFromLiveLogData(e.liveLogsData);return t!==o&&(t+=o),t}return this.state&&this.state.expandedTaskContent}}_setInitialState(){this.setState({showPanel:!1,fetchLogInProgress:!1,followTail:!1,expandedTaskName:"",expandedTaskLogUrl:"",expandedTaskContent:"",expandedTaskRank:-1,defaultLogLineNumber:-1,selection:void 0})}_scrollRequiredItemToView(){if(this.props.enableAutoScroll){this._isAutoScrollInProgress=!0;const e=this.props.indexToScrollOnMount;if(this._contentContainer){const t=this._contentContainer.getElementsByClassName(o);if(t&&t.length>e){const s=t[e];s&&window.requestAnimationFrame(()=>{s.scrollIntoView({block:"nearest"}),setTimeout(()=>{this._isAutoScrollInProgress=!1},400)})}}}}_select(){this.props.selectTaskOptions&&this.props.selectTaskOptions.task&&this._showLogExpandedView(this.props.selectTaskOptions.task,this.props.selectTaskOptions.selection)}}}(),function(e){J=t.PhaseLogsDetailsView={},Object.defineProperty(t,"__esModule",{value:!0});const s=A.LogsViewUtility;t.PhaseLogsDetailsView.PhaseLogsDetailsView=class extends f.VssComponent{render(){const e=this.props.item,t=e&&e.jobState?e.jobState:1,o=this._getPhaseSummaryProperties();if(o){if(this.props.item&&1===this.props.item.jobType&&1===t){const e=this.context.pageContext||this.props.pageContext;return a.createElement(q.AgentAcquisition,{queueId:o.queueId,agentName:o.agentName,jobRequest:this.props.jobRequest,licenseInfo:this.props.licenseInfo,queuePosition:this.props.queuePosition,isHostedPool:this.props.isHostedPool,isAnonymousUser:this.props.isAnonymousUser,hideLicenseInfoSection:this.props.hideLicenseInfoSection,pageContext:e})}{let i;const n=this._areThereTasks(),r=this._areThereIssues();i=this.props.indexToScrollOnMount&&this.props.indexToScrollOnMount>=0?this.props.indexToScrollOnMount:e?s.getIndexOfTaskToBeMovedToView(t,e.tasks):-1;const l=this.context.pageContext||this.props.pageContext,p=Object.assign({},this.props);return p.pageContext=l,a.createElement("div",{className:c.css(this._containerClassName,this.props.cssClass,"phase-logs-details-view")},a.createElement(j.PhaseSummaryView,Object.assign({},o)),r&&this._renderIssuesComponent(),!n&&!r&&this._renderPhaseStateStepComponent(t),n&&a.createElement(Z.TaskListLogsControllerView,Object.assign({},p,{indexToScrollOnMount:i})))}}return null}_areThereTasks(){return this.props.tasks&&this.props.tasks.length>0}_areThereIssues(){return this.props.issues&&this.props.issues.length>0||!1}_renderIssuesComponent(){return this.props.issues?a.createElement("div",{className:"logs-issues-list-container"},a.createElement(B.IssuesComponent,{headerText:V.PhaseIssuesHeaderText,issues:this.props.issues,pageContext:this.context.pageContext||this.props.pageContext})):null}_renderPhaseStateStepComponent(e){if(e){const t=this.props.item,o=t&&t.resultCode,i=s.getPhaseStatusFromJobStates(e);if(i)return a.createElement("div",{className:"logs-phase-error-step-component-container","data-is-focusable":!0,role:"status","aria-live":"assertive"},a.createElement(W.StepComponent,Object.assign({isTitleClickable:!1,title:i.status,infoProps:{tooltipContent:o,iconName:"Info",iconAriaLabel:V.Info},iconProps:{className:c.css("logs-phase-error-step-status-icon","log-task-state",i.className),iconName:i.iconName,iconType:0}},i.statusProps?{statusProps:{statusProps:i.statusProps}}:{},{cssClass:"logs-phase-error-step-component-content",ariaLabel:i.status})))}return null}}}(),function(e){t.AgentlessPhaseLogsDetailsView={},Object.defineProperty(t,"__esModule",{value:!0});t.AgentlessPhaseLogsDetailsView.AgentlessPhaseLogsDetailsView=class extends J.PhaseLogsDetailsView{constructor(){super(...arguments),this._onRenderSecondaryDetailsLeftSection=(()=>a.createElement("div",null,V.PhaseRunOnServerText)),this._containerClassName="server-phase-logs-details-view"}_getPhaseSummaryProperties(){const e=this.props.item;return e?{name:e.name,startTime:e.startTime,finishTime:e.finishTime,logUrl:e.logUrl,pageContext:this.props.pageContext,onRenderSecondaryDetailsLeftSection:this._onRenderSecondaryDetailsLeftSection}:null}}}(),function(e){t.AgentPhaseLogsDetailsView={},Object.defineProperty(t,"__esModule",{value:!0});t.AgentPhaseLogsDetailsView.AgentPhaseLogsDetailsView=class extends J.PhaseLogsDetailsView{constructor(){super(...arguments),this._containerClassName="agent-phase-logs-details-view"}_getPhaseSummaryProperties(){const e=this.props.item;return e?{name:e.name,startTime:e.startTime,finishTime:e.finishTime,queueTime:e.queueTime,logUrl:e.logUrl,agentName:e.agentName,queueId:e.queueId,pageContext:this.props.pageContext}:null}}}(),function(e){$=t.VerticalTabDefaultVerticalItemRenderer={},Object.defineProperty(t,"__esModule",{value:!0});t.VerticalTabDefaultVerticalItemRenderer.DefaultVerticalItemRenderer=class extends a.Component{render(){const e=this.props.iconProps,t=this.props.footerTooltipContent||this.props.footerText,s=this.props.statusIconProps;return a.createElement("div",{className:"vertical-tab-item-content flex flex-center"},e&&a.createElement(m.VssIcon,{className:c.css(e.className,"vertical-tab-item-icon","log-task-state"),iconName:e.iconName,iconType:e.iconType,style:e.style}),s&&a.createElement(n.Status,Object.assign({size:"16"},s,{className:c.css("vertical-tab-item-icon","log-task-state","flex-noshrink")})),a.createElement("div",{className:"vertical-tab-item-description"},a.createElement(d.Tooltip,{overflowOnly:!0,text:this.props.title},a.createElement("div",{className:"vertical-tab-item-text ellipsis-overflow"},this.props.title)),this.props.footerText&&a.createElement(d.Tooltip,{overflowOnly:!0,text:t},a.createElement("div",{className:"vertical-tab-item-footer-text ellipsis-overflow"},this.props.footerText))))}}}(),function(e){G=t.VerticalTabVerticalTabItem={},Object.defineProperty(t,"__esModule",{value:!0});t.VerticalTabVerticalTabItem.VerticalTabItem=class extends a.Component{render(){return a.createElement("div",Object.assign({},R.getNativeProps(this.props,R.divProperties)),this.props.children)}}}(),function(e){t.VerticalTabVerticalTabList={},Object.defineProperty(t,"__esModule",{value:!0});const s=640,o=20,i=300,n="vertical-tab-item";t.VerticalTabVerticalTabList.VerticalTabList=class extends a.Component{constructor(e){super(e),this._renderItem=(e=>{const{itemKey:t,ariaProps:s,onRenderItem:o,cssClass:i}=e,r=this._keyToTabIds[t];let l;const p=this.state.selectedKey===t?"is-selected":"",u={"aria-posinset":this._keyToIndexMapping[t]+1,"aria-setsize":this.state.items&&this.state.items.length};return o?(e.ariaProps=Object.assign({},s,u),l=o(e,this._renderItemContent)):l=this._renderItemContent(e),a.createElement("div",Object.assign({"data-is-focusable":!e.isItemNonInteractive,id:r,key:t,className:c.css(n,i,p),onClick:this._onItemClick.bind(this,t,e),onKeyPress:this._onKeyPress.bind(this,t,e),role:"tab","aria-selected":this.state.selectedKey===t},s,u),l)}),this._renderItemContent=(e=>a.createElement($.DefaultVerticalItemRenderer,{iconProps:e.iconProps,statusIconProps:e.statusIconProps,title:e.itemText,footerText:e.itemFooterText,footerTooltipContent:e.itemFooterTooltipContent})),this._verticalTabId=v.getId("VerticalTab"),this._initialWidth=this._getInitialWidth(),this._isItemManuallySelected=!1;const t=this._getItems(this.props);let s;if(this.props.selectedKey)s=this.props.selectedKey;else if(t.length)for(let e=0,o=t.length;e<o;e++)if(!t[e].isItemNonInteractive){s=t[e].itemKey;break}this.state=s?{items:t,selectedKey:s,selectedTabId:this._keyToTabIds[s]}:{items:[]}}componentDidMount(){setTimeout(()=>{this._selectTabItem(this.props.selectedKey||"")},0)}componentDidUpdate(e){e.selectedKey!==this.props.selectedKey&&setTimeout(()=>{this._selectTabItem(this.props.selectedKey||"")},0)}componentWillReceiveProps(e){const t=this._getItems(e);this.setState((s,o)=>{let i;if(this.props.persistManualSelection&&this._isItemManuallySelected||!this._isKeyValid(e.selectedKey)?this._isKeyValid(s.selectedKey)?i=s.selectedKey:t.length&&(i=t[0].itemKey):i=e.selectedKey,i)return{items:t,selectedKey:i,selectedTabId:this._keyToTabIds[i]}})}render(){let e=a.createElement("div",{className:c.css("vertical-tablist-left-pane",this.props.leftClassName)},a.createElement("div",{className:"vertical-tablist-left-section",role:"region","data-is-scrollable":!0,"aria-label":this.props.leftPaneARIARegionRoleLabel,ref:e=>this._verticalTabLeftSection=e},a.createElement(b.FocusZone,{direction:b.FocusZoneDirection.vertical,isInnerZoneKeystroke:e=>39===e.which},a.createElement(P.List,Object.assign({role:"tablist",className:"vertical-tablist-items",items:this.state.items,onRenderCell:this._renderItem},this.props.listProps)))));const t=this._getSelectedTabItemProps(),s=t&&t.isRightPaneFocusable;let o=a.createElement("div",{className:c.css("vertical-tablist-right-pane",this.props.rightClassName)},a.createElement("div",{className:"vertical-tablist-right-section",role:"region","data-is-scrollable":!0,"data-is-focusable":!!s,tabIndex:s?0:-1,"aria-label":this.props.rightPaneARIARegionRoleLabel},a.createElement("div",{className:"vertical-tab-item-panel",role:"tabpanel","aria-labelledby":this.state.selectedTabId},this._getVerticalTabPanelContent())));return a.createElement(D.Splitter,{onRenderNearElement:()=>e,onRenderFarElement:()=>o,fixedElement:0,className:c.css("vertical-tablist-splitter",this.props.cssClass),initialFixedSize:this._initialWidth,maxFixedSize:this.props.leftPaneMaxWidth&&parseInt(this.props.leftPaneMaxWidth,10)||2*this._initialWidth,minFixedSize:this.props.leftPaneMinWidth&&parseInt(this.props.leftPaneMinWidth,10)||this._initialWidth<250?this._initialWidth:250})}_getItems(e){const t=[];return this._keyToIndexMapping={},this._keyToTabIds={},a.Children.map(e.children,(e,s)=>{if(this._isVerticalTabItem(e)){const o=e,i=o.props.itemKey||s.toString();t.push({itemText:o.props.itemText,ariaProps:o.props.ariaProps,itemKey:i,item:o.props.item,iconProps:o.props.iconProps,statusIconProps:o.props.statusIconProps,onRenderItem:o.props.onRenderItem,itemFooterText:o.props.itemFooterText,itemFooterTooltipContent:o.props.itemFooterTooltipContent,isItemNonInteractive:o.props.isItemNonInteractive,cssClass:o.props.cssClass,isRightPaneFocusable:o.props.isRightPaneFocusable}),this._keyToIndexMapping[i]=s,this._keyToTabIds[i]=this._getTabId(i,s)}}),t}_getSelectedTabItemProps(){const e=this._keyToIndexMapping[this.state.selectedKey];return this.state.items[e]}_getVerticalTabPanelContent(){const e=this._keyToIndexMapping[this.state.selectedKey];return a.Children.toArray(this.props.children)[e]}_isVerticalTabItem(e){const t=e;return t&&"object"==typeof t&&(t.type===G.VerticalTabItem||t.props.isVerticalTabItem)}_onItemClick(e,t,s){t.isItemNonInteractive||(s.preventDefault(),this._updateSelectedItem(e,s))}_onKeyPress(e,t,s){13!==s.which||t.isItemNonInteractive||(s.preventDefault(),this._updateSelectedItem(e))}_updateSelectedItem(e,t){if(this.setState({items:this.state.items.slice(),selectedKey:e,selectedTabId:this._keyToTabIds[e]}),this.props.onItemClick&&this._keyToIndexMapping[e]>=0){const s=this._keyToIndexMapping[e],o=a.Children.toArray(this.props.children)[s];this._isVerticalTabItem(o)&&this.props.onItemClick(o,t)}this._isItemManuallySelected=!0}_isKeyValid(e){return void 0!==e&&void 0!==this._keyToIndexMapping[e]}_getTabId(e,t){return this.props.getTabId?this.props.getTabId(e,t):this._verticalTabId+`-Tab${t}`}_getInitialWidth(){let e=i,t=o;this.props.leftPaneInitialWidth&&(this.props.leftPaneInitialWidth.endsWith("%")?t=parseInt(this.props.leftPaneInitialWidth,10):e=parseInt(this.props.leftPaneInitialWidth,10));let n=0;try{n=window.outerWidth}catch(e){console.error("window.outerWidth threw exception "+e)}let a=e||n*(t||o)/100||i;return this.props.leftPaneInitialWidth?a:Math.min(s,a)}_selectTabItem(e){const t=this.state.items;if(t&&t.length>0&&!this._isItemManuallySelected&&this._verticalTabLeftSection){const s=t.findIndex(t=>t.itemKey===e);if(s>=0){const e=this._verticalTabLeftSection.getElementsByClassName(n);if(e&&e.length>s){const t=e[s];t&&window.requestAnimationFrame(()=>{t.scrollIntoView({block:"end",behavior:"smooth"})})}}}}}}()},["Resources","LogsViewUtility","AgentAcquisition","LiveLogsParser","AnsiParser","ExpandedLogsViewerComponent","LogsTelemetryHelper","IssuesComponent","StepComponent","PhaseSummaryView","ExpandedLogsTaskHeader","LogLine","LogsSummaryView","TaskLogStepComponent","TaskListLogsControllerView","PhaseLogsDetailsView","AgentlessPhaseLogsDetailsView","AgentPhaseLogsDetailsView","VerticalTab/DefaultVerticalItemRenderer","VerticalTab/VerticalTabItem","VerticalTab/VerticalTabList"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-distributedtask-web.dt-process-logs"}}));