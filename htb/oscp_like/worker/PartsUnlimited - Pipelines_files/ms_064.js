"use strict";define("VSS/Features/Identities",["require","exports","VSS/Platform/Context","VSS/Platform/RestClientBase","react","VSSUI/IdentityCard"],function(e,t,i,s,r,n){var a;!function(e){a=t.IdentityService={},Object.defineProperty(t,"__esModule",{value:!0});i.RestClients.add("IIdentityPickerHttpClient",{factory:class extends s.RestClientBase{constructor(e){super(e)}async beginGetIdentities(e){return this.beginRequest({apiVersion:"5.0-preview.1",routeTemplate:"_apis/IdentityPicker/Identities",method:"POST",body:e})}async beginGetConnections(e,t){return this.beginRequest({apiVersion:"5.0-preview.1",routeTemplate:"_apis/IdentityPicker/Identities/{objectId}/connections",routeValues:{objectId:e},queryParams:t})}async beginGetIdentityFeatureMru(e,t,i){return this.beginRequest({apiVersion:"5.0-preview.1",routeTemplate:"_apis/IdentityPicker/Identities/{objectId}/mru/{featureId}",routeValues:{objectId:e,featureId:t},queryParams:i})}async beginPatchIdentityFeatureMru(e,t,i){return this.beginRequest({apiVersion:"5.0-preview.1",routeTemplate:"_apis/IdentityPicker/Identities/{objectId}/mru/{featureId}",method:"PATCH",routeValues:{objectId:e,featureId:t},body:i})}async getRootPathPromise(){return this.getRootPath()}},options:{serviceInstanceType:"00025394-6065-48ca-87d9-7f5672854ef7"}}),t.IdentityService.VssIdentityServiceName="ms.vss-features.identity-service";const r=["DisplayName","IsMru","ScopeName","SamAccountName","Active","SubjectDescriptor"].concat(["Department","JobTitle","Mail","MailNickname","PhysicalDeliveryOfficeName","SignInAddress","Surname","Guest","TelephoneNumber","Manager"]).concat(["Description"]);class n extends i.VssService{_serviceStart(e){super._serviceStart(e),this._pageData=this.pageContext.getService("IVssPageService").getData(),this._identityPickerClient=e.getRestClient("IIdentityPickerHttpClient")}_serviceEnd(e){super._serviceEnd(e),delete this._mruCache}async getIdentityMruAsync(){if(!this._mruCache){const e={operationScopes:["ims"],properties:r},t=await this._identityPickerClient.getRootPathPromise(),i=await this._identityPickerClient.beginGetIdentityFeatureMru("me","common",e);this._mruCache=i.mruIdentities.map(e=>this._addAdditionalIdentityInfo(e,t))}return this._mruCache}async searchIdentitiesAsync(e,t,i,s,n,a){const o={query:e,identityTypes:t||["user","group"],operationScopes:i||["ims","source"],queryTypeHint:s,options:n||{MinResults:5,MaxResults:40},properties:r},d=await this._identityPickerClient.getRootPathPromise();return this._identityPickerClient.beginGetIdentities(o).then(t=>{let i=(a?a(t.results[0].identities):t.results[0].identities).map(e=>this._addAdditionalIdentityInfo(e,d));if(this._mruCache){const t=this._mruCache.filter(t=>t.displayName&&t.displayName.toLowerCase().startsWith(e.toLowerCase()));i=i.filter(e=>-1===t.findIndex(t=>t.entityId===e.entityId)),i=t.concat(i)}return i})}async addMruIdentitiesAsync(e){const t=[{operationScopes:["ims","source"],op:"add",value:e.map(e=>e.localId||e.entityId)}];return this._identityPickerClient.beginPatchIdentityFeatureMru("me","common",t).then(e=>e.result)}async removeMruIdentitiesAsync(e){const t=[{operationScopes:["ims","source"],op:"remove",value:e.map(e=>e.localId||e.entityId)}];return this._identityPickerClient.beginPatchIdentityFeatureMru("me","common",t).then(e=>e.result)}async getConnections(e,t){const i="user"===e.entityType.trim().toLowerCase(),s={identityTypes:["user","group"],operationScopes:i?"ad"===e.originDirectory?["source","ims","ad"]:["source"]:["ims","source"],connectionTypes:i?t?["managers","directReports"]:["managers"]:["successors"],depth:i&&t?6:1,properties:r},n=await this._identityPickerClient.getRootPathPromise();return this._identityPickerClient.beginGetConnections(e.entityId,s).then(e=>({managers:e.managers?this._addInfoToIdentities(e.managers,n):[],directReports:e.directReports?this._addInfoToIdentities(e.directReports,n):[],successors:e.successors?this._addInfoToIdentities(e.successors,n):[]}))}_getSignInAddress(e){return!this._pageData.isHosted&&e.samAccountName&&e.samAccountName.trim()?(e.scopeName&&e.scopeName.trim()?e.scopeName+"\\":"")+e.samAccountName:e.signInAddress&&e.signInAddress.trim()?e.signInAddress:e.mail&&e.mail.trim()?e.mail:e.mailNickname&&e.mailNickname.trim()?e.mailNickname:""}_addInfoToIdentities(e,t){return e.map(e=>this._addAdditionalIdentityInfo(e,t))}_addAdditionalIdentityInfo(e,t){return Object.assign({},e,{image:e.subjectDescriptor?`${t}_apis/GraphProfile/MemberAvatars/${e.subjectDescriptor}`:void 0,mail:this._getSignInAddress(e),isHosted:this._pageData.isHosted})}}t.IdentityService.VssIdentityService=n,i.Services.add(t.IdentityService.VssIdentityServiceName,{serviceFactory:n,options:1}),i.Services.add("IIVssIdentityService",{serviceFactory:n,options:1})}(),function(e){t.IdentityDetailsProvider={},Object.defineProperty(t,"__esModule",{value:!0});t.IdentityDetailsProvider.IdentityDetailsProvider=class{constructor(e,t){this.getIdentityImageUrl=(()=>{const{identity:e}=this.member;return e._links&&e._links.avatar&&e._links.avatar.href||e.imageUrl}),this.getDisplayName=(()=>this.member.identity.displayName),this.onRequestConnectionInformation=((e,t)=>this.identityService.getConnections(e,t)),this.getEntityFromUniqueAttribute=(e=>this.identityService.searchIdentitiesAsync(e,["user"],this.pageData.isHosted?["ims","source"]:["ims","source","ad"],"uid").then(e=>e[0])),this.onRenderPersonaCard=((e,t)=>r.createElement(n.IdentityCard,{uniqueAttribute:this.member.identity.uniqueName,target:e,onDismissCallback:t,displayName:this.member.identity.displayName,onRequestConnectionInformation:this.onRequestConnectionInformation,getEntityFromUniqueAttribute:this.getEntityFromUniqueAttribute})),this.identityService=e.getService(a.VssIdentityServiceName),this.pageData=e.getService("IVssPageService").getData(),this.member=t}}}(),function(e){t.IdentityPickerProvider={},Object.defineProperty(t,"__esModule",{value:!0});t.IdentityPickerProvider.PeoplePickerProvider=class{constructor(e,t){this.addIdentitiesToMRU=(e=>this._identityService.addMruIdentitiesAsync(e)),this.getEntityFromUniqueAttribute=(e=>this._identityService.searchIdentitiesAsync(e,["user"],this._pageData.isHosted?["ims","source"]:["ims","source","ad"],"uid").then(e=>e[0])),this.onFilterIdentities=((e,t)=>""===e?[]:this._onSearchPersona(e,t||[])),this.onRequestConnectionInformation=((e,t)=>this._identityService.getConnections(e,t)),this.removeIdentitiesFromMRU=(e=>this._identityService.removeMruIdentitiesAsync(e)),this._onSearchPersona=((e,t)=>{const i=Object.assign({},this._defaultRequestProps,{query:e});return this._identityService.searchIdentitiesAsync(i.query,i.identityTypes,i.operationScopes,i.queryTypeHint,i.options).then(e=>e.filter(e=>!t.some(t=>!!t&&t.entityId===e.entityId)))}),this._identityService=e.getService(a.VssIdentityServiceName),this._defaultRequestProps=t||{},this._pageData=e.getService("IVssPageService").getData()}onEmptyInputFocus(){return this._identityService.getIdentityMruAsync().then(e=>this._defaultRequestProps&&this._defaultRequestProps.identityTypes?e.filter(e=>!this._defaultRequestProps.identityTypes||this._defaultRequestProps.identityTypes.some(t=>t.toLocaleLowerCase()===e.entityType.toLocaleLowerCase())):e)}}}(),function(e){t.PersonaDetailsProvider={},Object.defineProperty(t,"__esModule",{value:!0});t.PersonaDetailsProvider.PersonaDetailsProvider=class{constructor(e){this.onRequestConnectionInformation=((e,t)=>this.identityService.getConnections(e,t)),this.getEntityFromUniqueAttribute=(e=>this.identityService.searchIdentitiesAsync(e,["user","group"],this.pageData.isHosted?["ims","source"]:["ims","source","ad"],"uid").then(e=>e[0])),this.renderIdentityCard=((e,t,i,s)=>{let a={};if(e.entityId)a={identity:e};else{const t=e;a={uniqueAttribute:t.id,displayName:t.displayName,imageUrl:t.imageUrl}}return r.createElement(n.IdentityCard,Object.assign({},a,{target:s,onDismissCallback:i,onRequestConnectionInformation:t.onRequestConnectionInformation,getEntityFromUniqueAttribute:t.getEntityFromUniqueAttribute}))}),this.identityService=e.getService(a.VssIdentityServiceName),this.pageData=e.getService("IVssPageService").getData()}}}(),function(e){t[e]={},Object.defineProperty(t,"__esModule",{value:!0});t[e].IdentitiesClientName="IIdentitiesRestClient",t[e].getIdentitiesClient=function(i,s){return i.getRestClient(t[e].IdentitiesClientName,s)},i.RestClients.add(t[e].IdentitiesClientName,{factory:class extends s.RestClientBase{constructor(e){super(e)}async createOrBindWithClaims(e){return this.beginRequest({apiVersion:"5.0-preview.1",method:"PUT",routeTemplate:"_apis/identities/Claims",body:e})}async getDescriptorById(e,t){const i={isMasterId:t};return this.beginRequest({apiVersion:"5.0-preview.1",routeTemplate:"_apis/identities/descriptors/{id}",routeValues:{id:e},queryParams:i})}async createGroups(e){return this.beginRequest({apiVersion:"5.0",method:"POST",routeTemplate:"_apis/Groups/{groupId}",body:e})}async deleteGroup(e){return this.beginRequest({apiVersion:"5.0",method:"DELETE",routeTemplate:"_apis/Groups/{groupId}",routeValues:{groupId:e}})}async listGroups(e,t,i,s){const r={scopeIds:e,recurse:t,deleted:i,properties:s};return this.beginRequest({apiVersion:"5.0",routeTemplate:"_apis/Groups/{groupId}",queryParams:r})}async getIdentityChanges(e,t,i,s,r){const n={identitySequenceId:e,groupSequenceId:t,organizationIdentitySequenceId:i,pageSize:s,scopeId:r};return this.beginRequest({apiVersion:"5.0",routeTemplate:"_apis/Identities/{identityId}",queryParams:n})}async getUserIdentityIdsByDomainId(e){const t={domainId:e};return this.beginRequest({apiVersion:"5.0",routeTemplate:"_apis/Identities/{identityId}",queryParams:t})}async readIdentities(e,t,i,s,r,n,a,o,d,u){const c={descriptors:e,identityIds:t,subjectDescriptors:i,socialDescriptors:s,searchFilter:r,filterValue:n,queryMembership:a,properties:o,includeRestrictedVisibility:d,options:u};return this.beginRequest({apiVersion:"5.0",routeTemplate:"_apis/Identities/{identityId}",queryParams:c})}async readIdentitiesByScope(e,t,i){const s={scopeId:e,queryMembership:t,properties:i};return this.beginRequest({apiVersion:"5.0",routeTemplate:"_apis/Identities/{identityId}",queryParams:s})}async readIdentity(e,t,i){const s={queryMembership:t,properties:i};return this.beginRequest({apiVersion:"5.0",routeTemplate:"_apis/Identities/{identityId}",routeValues:{identityId:e},queryParams:s})}async updateIdentities(e){return this.beginRequest({apiVersion:"5.0",method:"PUT",routeTemplate:"_apis/Identities/{identityId}",body:e})}async updateIdentity(e,t){return this.beginRequest({apiVersion:"5.0",method:"PUT",routeTemplate:"_apis/Identities/{identityId}",routeValues:{identityId:t},body:e})}async createIdentity(e){return this.beginRequest({apiVersion:"5.0",method:"PUT",routeTemplate:"_apis/identities/Identity",body:e})}async readIdentityBatch(e){return this.beginRequest({apiVersion:"5.0-preview.1",method:"POST",routeTemplate:"_apis/IdentityBatch",body:e})}async getIdentitySnapshot(e){return this.beginRequest({apiVersion:"5.0-preview.1",routeTemplate:"_apis/IdentitySnapshot/{scopeId}",routeValues:{scopeId:e}})}async getMaxSequenceId(){return this.beginRequest({apiVersion:"5.0",routeTemplate:"_apis/identities/MaxSequenceId"})}async getSelf(){return this.beginRequest({apiVersion:"5.0",routeTemplate:"_apis/identities/me"})}async addMember(e,t){return this.beginRequest({apiVersion:"5.0-preview.1",method:"PUT",routeTemplate:"_apis/identities/{containerId}/Members/{memberId}",routeValues:{containerId:e,memberId:t}})}async readMember(e,t,i){const s={queryMembership:i};return this.beginRequest({apiVersion:"5.0-preview.1",routeTemplate:"_apis/identities/{containerId}/Members/{memberId}",routeValues:{containerId:e,memberId:t},queryParams:s})}async readMembers(e,t){const i={queryMembership:t};return this.beginRequest({apiVersion:"5.0-preview.1",routeTemplate:"_apis/identities/{containerId}/Members/{memberId}",routeValues:{containerId:e},queryParams:i})}async removeMember(e,t){return this.beginRequest({apiVersion:"5.0-preview.1",method:"DELETE",routeTemplate:"_apis/identities/{containerId}/Members/{memberId}",routeValues:{containerId:e,memberId:t}})}async readMemberOf(e,t,i){const s={queryMembership:i};return this.beginRequest({apiVersion:"5.0-preview.1",routeTemplate:"_apis/identities/{memberId}/MembersOf/{containerId}",routeValues:{memberId:e,containerId:t},queryParams:s})}async readMembersOf(e,t){const i={queryMembership:t};return this.beginRequest({apiVersion:"5.0-preview.1",routeTemplate:"_apis/identities/{memberId}/MembersOf/{containerId}",routeValues:{memberId:e},queryParams:i})}async createScope(e,t){return this.beginRequest({apiVersion:"5.0-preview.2",method:"PUT",routeTemplate:"_apis/Scopes/{scopeId}",routeValues:{scopeId:t},body:e})}async deleteScope(e){return this.beginRequest({apiVersion:"5.0-preview.2",method:"DELETE",routeTemplate:"_apis/Scopes/{scopeId}",routeValues:{scopeId:e}})}async getScopeById(e){return this.beginRequest({apiVersion:"5.0-preview.2",routeTemplate:"_apis/Scopes/{scopeId}",routeValues:{scopeId:e}})}async getScopeByName(e){const t={scopeName:e};return this.beginRequest({apiVersion:"5.0-preview.2",routeTemplate:"_apis/Scopes/{scopeId}",queryParams:t})}async updateScope(e,t){return this.beginRequest({apiVersion:"5.0-preview.2",method:"PATCH",routeTemplate:"_apis/Scopes/{scopeId}",routeValues:{scopeId:t},customHeaders:{"Content-Type":"application/json-patch+json"},body:e})}async getSignedInToken(){return this.beginRequest({apiVersion:"5.0-preview.1",routeTemplate:"_apis/SignedInToken"})}async getSignoutToken(){return this.beginRequest({apiVersion:"5.0-preview.1",routeTemplate:"_apis/SignoutToken"})}async swapIdentity(e){return this.beginRequest({apiVersion:"5.0-preview.1",method:"POST",routeTemplate:"_apis/identities/Swap",body:e})}async getTenant(e){return this.beginRequest({apiVersion:"5.0-preview.1",routeTemplate:"_apis/identities/tenant/{tenantId}",routeValues:{tenantId:e}})}},options:{resourceAreaId:"8a3d49b8-91f0-46ef-b33d-dda338c25db3"}})}("RestClientIdentities")},["IdentityService","IdentityDetailsProvider","IdentityPickerProvider","PersonaDetailsProvider","RestClient/Identities"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-features.identities-content"}}));