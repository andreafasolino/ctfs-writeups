"use strict";define("Build/BuildResult",["require","exports","Build/Flux/Action","Build/Common/Library/Indicator","Build/Common/Library/Duration","VSSUI/Utilities/Date","VSS/Core/Util/String","react","VSSUI/Ago","VSS/Platform/Context","VSS/Core/Observable","VSS/Platform/FPS","DistributedTaskUI/Logs/LiveLogsParser","Build/Common/Library/SignalRHubProxies","DistributedTask/Common/SignalR/SignalRHubProxies","VSS/Features/SignalR/Hub","Build/Flux/Actions/ContributionData","Build/Common/Library/ErrorHandler","Build/Common/Library/Security","Build/Common/Library/Sources/Build","Build/Common/Library/Stores/Permissions","Build/Flux/Store","VSS/Core/Util/Accessibility","VSS/Platform/Fetch","Build/Flux/Sources/Contribution","VSS/Platform/Layout","VSSUI/Menu","Build/Common/Library/SingletonManager","DistributedTask/Client/RestClient/TaskAgent","DistributedTaskUI/Logs/AgentPhaseLogsDetailsView","DistributedTaskUI/Logs/AgentlessPhaseLogsDetailsView","DistributedTaskUI/Logs/LogsViewUtility","DistributedTaskUI/Logs/IssuesComponent","DistributedTaskUI/Logs/VerticalTab/DefaultVerticalItemRenderer","DistributedTaskUI/Logs/VerticalTab/VerticalTabItem","DistributedTaskUI/Logs/VerticalTab/VerticalTabList","VSSUI/Util","VSSUI/HeaderCommandBar","VSSUI/Status","VSSUI/Spinner","VSS/Legacy/Legacy","VSS/Core/TimerManagement","Build/Common/Artifacts/Timeline","Build/Shared/Components/Histogram/index","Build/Common/Library/Identity","Build/Common/Library/Components/BuildPersona","Build/Client/RestClient/Approval","Build/Shared/Components/Timeline/index","Build/Shared/Components/DetailsSection/index","VSSUI/Button","VSSUI/Icon","VSSUI/Link","VSSUI/MessageCard","VSS/Platform/Components/FPSLink","VSSUI/Duration","VSS/Platform/Identity","VSS/Platform/Util/Url","Build/Common/Artifacts/Store","Build/Common/Library/Array","Build/Common/Library/Components/CommandComponent","Build/Common/Library/Navigation","Build/Common/Library/Legacy/ObservablePivotActionArray","Build/Common/Library/StateHandler","Build/Client/Linking","VSSUI/MessageBar","OfficeFabric/Pickers","VSSUI/TooltipEx","VSS/Features/Frame/ContributedPivotBarItemProvider","VSS/Platform/Feature","VSSUI/Utilities/ItemContribution","VSSUI/Header","VSSUI/Page","VSSUI/Navigation/VssHubViewState","VSSUI/Panel","VSSUI/Utilities/HubViewState","VSSUI/Tabs","VSSUI/VssIcon","Build/SourceProviders/Common"],function(e,t,s,i,a,o,n,r,d,l,u,c,h,p,m,g,b,_,S,v,C,R,f,T,I,L,A,k,y,w,B,E,P,D,x,U,N,H,q,j,F,M,V,O,J,K,W,z,Q,G,Z,$,Y,X,ee,te,se,ie,ae,oe,ne,re,de,le,ue,ce,he,pe,me,ge,be,_e,Se,ve,Ce,Re,fe,Te){var Ie,Le,Ae,ke,ye,we,Be,Ee,Pe,De,xe,Ue,Ne,He,qe,je,Fe,Me,Ve,Oe,Je,Ke,We,ze,Qe,Ge,Ze,$e,Ye,Xe,et,tt,st;Ie=t.Resources={},Object.defineProperty(t,"__esModule",{value:!0}),t.Resources.Abandoned="Abandoned",t.Resources.AddTag="Add a tag",t.Resources.AddTags="Add tags",t.Resources.Ago="Ago",t.Resources.AcquiredBy="Acquired by {0}",t.Resources.AgentWaitingText1="Waiting for one of the matched agents",t.Resources.AgentWaitingText2="satisfying demands",t.Resources.AgentWaitingText3="to acquire the job",t.Resources.AgentWaitingTextNoRequest="Waiting for the agent request to be queued",t.Resources.AgentWaitingTextAssigned="Waiting for the agent {0} to run the job",t.Resources.AriaBranch="{0} branch",t.Resources.AnnounceBuildResult="Build {0} {1}",t.Resources.AriaBuildTimelineChevron="Show build summary details",t.Resources.AriaHistogramBuildsList="History of builds",t.Resources.AriaChangesList="List of changes",t.Resources.AriaCommit="{0} commit",t.Resources.AriaExploreArtifacts="Explore {0} artifacts",t.Resources.AriaDownloadArtifact="Download {0} artifact",t.Resources.AriaIssuesList="List of issues",t.Resources.AriaPipeline="Build {0} for {1} pipeline",t.Resources.AriaPullrequest="{0} pullrequest",t.Resources.AriaTagsList="List of tags",t.Resources.AriaTagsSection="Build tags section",t.Resources.AriaTagSuggestions="Tag suggestions",t.Resources.AriaRepository="{0} repository",t.Resources.AriaResultsAvailable="{0} results available",t.Resources.AriaShowAllChanges="Show all changes",t.Resources.AriaShowAllWorkItems="Show all work items",t.Resources.AriaWorkItemsList="List of workitems",t.Resources.Artifacts="Artifacts",t.Resources.AssociatedChanges="Associated changes",t.Resources.AssignedTo="Assigned to",t.Resources.Attempt="Attempt",t.Resources.Attempts="Attempts",t.Resources.AuthoredFormat="{0} authored",t.Resources.AuthorizedResourcesButtonText="Resources authorized",t.Resources.AuthorizeResourcesButtonText="Authorize resources",t.Resources.AuthorizeResourcesErrorMessage="An error occurred while auto-authorizing resources",t.Resources.AuthorizeResourcesSuccessMessage="Resources were successfully authorized",t.Resources.BuildsHubName="Builds",t.Resources.BuildCompletionTriggerTitle="Build completion trigger",t.Resources.BranchNotFound="Branch not found",t.Resources.BuildDefinitionIsPaused="Paused",t.Resources.BuildDefinitionPausedMessage="Build pipeline {0} is paused. Builds queued will not start until it is resumed.",t.Resources.BuildLoadingText="Loading...",t.Resources.BuildNotFound="Build not found",t.Resources.BuildsSince="Builds since ",t.Resources.BuildSummaryDurationInformationFormat="{0} {1}",t.Resources.BuildStatusIndicatorFormat="Build {0} {1} {2} {3}",t.Resources.BuildTimelinePrimaryText="Build pipeline {0}",t.Resources.ByFormat="by {0}",t.Resources.Completed="Completed",t.Resources.CancelBuild="Cancel build",t.Resources.CancelingBuild="Canceling build",t.Resources.Canceling="Canceling",t.Resources.Canceled="Canceled",t.Resources.CommitHashHeader="Change {0}",t.Resources.CommitsFormat="{0} commit(s)",t.Resources.CompletedAfter="Completed after {0}",t.Resources.ConfirmCancelBuild="Are you sure you want to cancel build '{0}'?",t.Resources.CopyLogsLocation="Copy logs location",t.Resources.DeletedFormat="{0} deleted",t.Resources.DiagAgentTitle="Agent",t.Resources.DiagSectionTitle="Agent diagnostic logs",t.Resources.DiagPhaseTitle="Job",t.Resources.Disabled="Disabled",t.Resources.DownloadAllLogs="All logs",t.Resources.DownloadAllLogsInOverflow="Download all logs",t.Resources.DownloadArtifacts="Artifacts",t.Resources.DownloadStageLogs="Stage logs",t.Resources.Enabled="Enabled",t.Resources.Errors="Error(s)",t.Resources.Failed="Failed",t.Resources.EditDefinition="Edit pipeline",t.Resources.ForFormat="for {0}",t.Resources.ForFormatPR="for {0} targeting {1}",t.Resources.From="from",t.Resources.FromQueue="from queue",t.Resources.HideMoreTags="Show fewer tags",t.Resources.InitializePhase="Prepare job",t.Resources.IssueListExpandMessage="Expand issue #{0}",t.Resources.JobStatusIndicatorFormat="Job {0} {1}",t.Resources.LoadingText="Loading...",t.Resources.LogsTabName="Logs",t.Resources.ManuallyQueued="Manually queued",t.Resources.MillisecondsFormat="{0} milliseconds",t.Resources.MergeFrom="Merge from",t.Resources.NoArtifactsFound="No artifacts found",t.Resources.NoBuildsFound="No builds found",t.Resources.NoChangesFound="No changes found",t.Resources.NoTasksRetreived="No tasks found",t.Resources.NoJobsFound="No jobs found",t.Resources.NoIssuesRetrieved="No issues retrieved",t.Resources.None="None",t.Resources.NoPermissionsToEditTags="You don’t have permission to edit tags",t.Resources.NoResultsFound="No results found",t.Resources.NotStarted="Not started",t.Resources.On="On",t.Resources.Offline="Offline",t.Resources.Online="Online",t.Resources.PendingChecks_Multiple="{1} checks require_10 your attention before this run can continue to {0}.",t.Resources.PendingChecks_Single="One check requires your attention before this run can continue to {0}.",t.Resources.Position="Position",t.Resources.Progression="Progression",t.Resources.PullRequest="Pull request",t.Resources.PullRequestTitleFormat="PR {0} : {1}",t.Resources.Queued="Queued",t.Resources.QueuedFormat="{0} queued",t.Resources.QueuedFor="Queued for",t.Resources.QueueBuild="Queue",t.Resources.QueueBuildWithDiag="Queue with diagnostics",t.Resources.RanFor="Ran for",t.Resources.RanForFormat="Ran for {0}",t.Resources.ReasonBatchedCI="Rolling build triggered",t.Resources.ReasonBuildCompletion="Build completion triggered",t.Resources.ReasonRetention="Retention policy triggered",t.Resources.ReasonGatedValidationOf="Gated checkin validation of",t.Resources.ReasonIndividualCI="Triggered",t.Resources.ReasonManual="Manually run",t.Resources.ReasonShelveset="Shelveset",t.Resources.ReasonSchedule="Scheduled",t.Resources.ReasonValidationOf="Validation of",t.Resources.RetainBuild="Retain",t.Resources.Rebuild="Rebuild",t.Resources.RunningFor="Running for",t.Resources.RepositoryNotFound="Repository not found",t.Resources.RequestedFormat="{0} requested",t.Resources.RetainedByBuild="Retained by build",t.Resources.RetainedByBuildAndRelease="Retained by build and release",t.Resources.RetainedByRelease="Retained by release",t.Resources.Retry="Retry",t.Resources.ResultsTabName="Summary",t.Resources.Running="Running",t.Resources.ScheduledTrigger="Scheduled trigger",t.Resources.SearchBuildsText="Search builds...",t.Resources.SecondsFormat="{0} seconds",t.Resources.SetupAcquiringAgentHeader="Setup - acquiring agent",t.Resources.ShowAll="Show all",t.Resources.ShowMoreTags="Show rest of the tags",t.Resources.SignalRConnected="Build live updates have been restored.",t.Resources.SignalRDisconnected="Build live updates have stopped. We’re working to restore them. Refresh the page to see any updates.",t.Resources.SignalRReconnecting="You’re not receiving build live updates. We’re working to restore them.",t.Resources.SignalRSlow="Build live updates could be delayed. We’re working to restore them.",t.Resources.SignalRUserInactive="Build live updates have stopped due to inactivity on the page. Refresh the page to see any updates.",t.Resources.Skipped="Skipped",t.Resources.StageNameFormat="{0} # {1}",t.Resources.Started="Started",t.Resources.StartedAfter="Started after {0} in queue",t.Resources.Status="Status",t.Resources.StopBuild="Stop build",t.Resources.StopRetainingBuild="Stop retaining build",t.Resources.Succeeded="Succeeded",t.Resources.SucceededWithIssues="Succeeded with issues",t.Resources.SummaryBuildHeaderFormat="{0} build for {1}",t.Resources.SummaryBuildHeaderNoDisplayNameFormat="{0} build",t.Resources.StageIssues="Stage issues",t.Resources.TaskStatusIndicatorFormat="Task {0} {1}",t.Resources.Triggered=" triggered",t.Resources.To="To",t.Resources.Unknown="Unknown",t.Resources.VariableHeader="Queue time variables",t.Resources.VariableKey="Name",t.Resources.VariableValue="Value",t.Resources.ViewBranchFormat="View branch {0} in {1}",t.Resources.ViewCommit="View commit",t.Resources.ViewDefinition="View",t.Resources.ViewLogs="View logs",t.Resources.ViewQueueVar="View queue time variables",t.Resources.ViewRepoFormat="View repository {0}",t.Resources.ViewPullrequest="View pull request",t.Resources.Warnings="Warning(s)",t.Resources.WaitingforLogs="Waiting for console output...",t.Resources.WaitingforJob="Queueing the job...",t.Resources.WorkItemsSectionHeader="Linked work items",function(e){Le=t.ActionsBuildResult={},Object.defineProperty(t,"__esModule",{value:!0});t.ActionsBuildResult.BuildResultActionCreator=class{constructor(e){this._actionHub=e.actionHub,this._callbacks=e.callbacks}fetchData(){this._callbacks.fetchData()}selectView(e,t,s){this._actionHub.selectView.invoke({view:e,routes:t,pushState:s})}};t.ActionsBuildResult.BuildResultActionHub=class{constructor(){this._selectView=new s.Action}get selectView(){return this._selectView}}}(),function(e){Ae=t.ActionsSignalR={},Object.defineProperty(t,"__esModule",{value:!0});t.ActionsSignalR.BuildResultSignalRActionCreator=class{constructor(e){this._actionHub=e.actionHub}buildUpdated(e,t){this._actionHub.buildUpdated.invoke({buildId:e,routes:t})}artifactAdded(e,t){this._actionHub.artifactAdded.invoke({buildId:e,name:t})}consoleLinesUpdated(e){this._actionHub.consoleLinesUpdated.invoke(e)}timelineRecordsUpdated(e){this._actionHub.timelineRecordsUpdated.invoke(e)}isConnected(){return this._actionHub.isConnected.invoke(void 0)}isConnectedToBuild(e){return this._actionHub.isConnectedToBuild.invoke(e)}isConnecting(){return this._actionHub.isConnecting.invoke(void 0)}isDisconnected(){return this._actionHub.isDisconnected.invoke(void 0)}isReconnected(){return this._actionHub.isReconnected.invoke(void 0)}isReconnecting(){return this._actionHub.isReconnecting.invoke(void 0)}isSlow(){return this._actionHub.isSlow.invoke(void 0)}isUserInactive(){return this._actionHub.isUserInactive.invoke(void 0)}};t.ActionsSignalR.BuildResultSignalRActionHub=class{constructor(){this._isConnected=new s.Action,this._isConnectedToBuild=new s.Action,this._isConnecting=new s.Action,this._isDisconnected=new s.Action,this._isReconnected=new s.Action,this._isReconnecting=new s.Action,this._isSlow=new s.Action,this._isUserInactive=new s.Action,this._artifactAdded=new s.Action,this._buildUpdated=new s.Action,this._consoleLinesUpdated=new s.Action,this._timelineRecordsUpdated=new s.Action}get isConnectedToBuild(){return this._isConnectedToBuild}get artifactAdded(){return this._artifactAdded}get buildUpdated(){return this._buildUpdated}get consoleLinesUpdated(){return this._consoleLinesUpdated}get timelineRecordsUpdated(){return this._timelineRecordsUpdated}get isConnected(){return this._isConnected}get isConnecting(){return this._isConnecting}get isDisconnected(){return this._isDisconnected}get isReconnected(){return this._isReconnected}get isReconnecting(){return this._isReconnecting}get isSlow(){return this._isSlow}get isUserInactive(){return this._isUserInactive}};t.ActionsSignalR.PoolHubSignalRActionCreator=class{constructor(e){this._actionHub=e.actionHub}agentUpdated(e,t,s,i){this._actionHub.agentUpdated.invoke({poolId:e,agentId:t,status:s,enabled:i})}agentRequestAssigned(e,t){this._actionHub.agentRequestAssigned.invoke({poolId:e,request:t})}agentRequestQueued(e,t){this._actionHub.agentRequestAssigned.invoke({poolId:e,request:t})}agentRequestStarted(e,t){this._actionHub.agentRequestStarted.invoke({poolId:e,request:t})}agentRequestCompleted(e,t){this._actionHub.agentRequestCompleted.invoke({poolId:e,request:t})}};t.ActionsSignalR.PoolHubSignalRActionHub=class{constructor(){this._agentUpdated=new s.Action,this._agentRequestAssigned=new s.Action,this._agentRequestQueued=new s.Action,this._agentRequestStarted=new s.Action,this._agentRequestCompleted=new s.Action}get agentUpdated(){return this._agentUpdated}get agentRequestAssigned(){return this._agentRequestAssigned}get agentRequestQueued(){return this._agentRequestQueued}get agentRequestStarted(){return this._agentRequestStarted}get agentRequestCompleted(){return this._agentRequestCompleted}dispose(){}}}(),function(e){var s;function r(e){const t=a.getDurationStats(e);let s="";return s=t.days>0?n.format("{0}:{1}:{2}:{3}",a.padZeroes(t.days),a.padZeroes(t.hours),a.padZeroes(t.minutes),a.padZeroes(t.seconds)):t.hours>0?n.format("{0}:{1}:{2}",a.padZeroes(t.hours),a.padZeroes(t.minutes),a.padZeroes(t.seconds)):t.minutes>0?n.format("{0}:{1}",a.padZeroes(t.minutes),a.padZeroes(t.seconds)):t.seconds>0?n.format(Ie.SecondsFormat,a.padZeroes(t.seconds)):n.format(Ie.MillisecondsFormat,a.padZeroes(e))}ke=t.BuildIndicator={},Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Large=0]="Large",e[e.ExtraLarge=1]="ExtraLarge"}(s=t.BuildIndicator.IndicatorSize||(t.BuildIndicator.IndicatorSize={})),t.BuildIndicator.getIndicatorData=function(e,t=s.Large){let a="";switch(t){case s.Large:a="ci-large-icon";break;case s.ExtraLarge:a="ci-extra-large-icon"}let d=i.getStatusIndicatorData(i.Status.Unknown),l={statusProps:d.statusProps,text:Ie.Unknown,className:a,tooltip:"",reason:"",originalStatusInfo:{text:"",localeDate:"",localeTime:""},finalStatusInfo:{text:"",duration:""}};if(!e)return l;switch(l.originalStatusInfo.text=Ie.Started,l.finalStatusInfo.text=Ie.RanFor,e.status){case 32:d=i.getStatusIndicatorData(i.Status.Queued),1===e.definition.queueStatus?l.text=Ie.BuildDefinitionIsPaused:l.text=Ie.NotStarted,l.originalStatusInfo.text=Ie.Queued,l.finalStatusInfo.text=Ie.QueuedFor;break;case 1:d=i.getStatusIndicatorData(i.Status.InProgress),l.text=Ie.Running,l.finalStatusInfo.text=Ie.RunningFor;break;case 4:d=i.getStatusIndicatorData(i.Status.InProgress),l.text=Ie.Canceling,l.finalStatusInfo.text=Ie.RunningFor;break;case 2:if(e.startTime){const t=Math.abs(e.finishTime.getTime()-e.startTime.getTime());l.finalStatusInfo.duration=r(t)}switch(e.result){case 2:d=i.getStatusIndicatorData(i.Status.Succeeded),l.text=Ie.Succeeded;break;case 4:d=i.getStatusIndicatorData(i.Status.Warning),l.text=Ie.SucceededWithIssues;break;case 8:d=i.getStatusIndicatorData(i.Status.Failed),l.text=Ie.Failed;break;case 32:d=i.getStatusIndicatorData(i.Status.Cancelled),l.text=Ie.Canceled}}l.statusProps=d.statusProps;const u=l.finalStatusInfo.duration?"("+n.format(Ie.RanForFormat,l.finalStatusInfo.duration)+")":"";return l.tooltip=n.format(Ie.BuildStatusIndicatorFormat,e.buildNumber,l.text.toLocaleLowerCase(),o.ago(e.finishTime?e.finishTime:e.startTime?e.startTime:new Date).toLocaleLowerCase(),u.toLocaleLowerCase()),l},t.BuildIndicator.getDurationText=r}(),ye=t.Components={},Object.defineProperty(t,"__esModule",{value:!0}),t.Components.InlineAgoElement=(e=>r.createElement("span",{className:`b-inline-ago ${e.className}`},r.createElement(d.Ago,{date:e.date}))),we=t.Constants={},Object.defineProperty(t,"__esModule",{value:!0}),(st=t.Constants.ContributionKeys||(t.Constants.ContributionKeys={})).ProviderId="ms.vss-build-web.ci-results-data-provider",st.AdditionalProviderId="ms.vss-build-web.ci-results-additional-data-provider",st.RelatedWorkItemsProviderId="ms.vss-build-web.ci-results-workitems-data-provider",st.TimelineProviderId="ms.vss-build-web.ci-results-timeline-data-provider",st.FeedProviderId="ms.vss-build-web.ci-results-feed-data-provider",st.BuildId="buildId",st.View="view",st.GetAdditionalData="getAdditionalData",st.PlanId="planId",st.TimelineId="timelineId",st.ChangeId="changeId",st.JobId="jobId",(tt=t.Constants.ViewKeys||(t.Constants.ViewKeys={})).Logs="logs",tt.Results="results",tt.Tests="ms.vss-test-web.test-result-details",tt.TestResult="ms.vss-test-web.build-test-results-tab",(et=t.Constants.NavigationKeys||(t.Constants.NavigationKeys={})).JobId="jobId",et.TaskId="taskId",et.lineStart="lineStart",et.lineEnd="lineEnd",et.colStart="colStart",et.colEnd="colEnd",(Xe=t.Constants.ProcessType||(t.Constants.ProcessType={})).Designer=1,Xe.Yaml=2,Xe.Docker=3,function(e){Be=t.Contribution={},Object.defineProperty(t,"__esModule",{value:!0}),t.Contribution.isContributionHidden=function(e,t){let s=!1;e=e||[],t=t||[];let i=!1;for(let s=0;s<e.length;s++){const a=e[s];if(t.indexOf(a&&a.toLowerCase())>-1){i=!0;break}}return i||(s=!0),s}}(),function(e){t.HeaderBreadcrumbService={},Object.defineProperty(t,"__esModule",{value:!0});class s extends l.VssService{constructor(){super(...arguments),this.items=new u.ObservableArray,this._onFPSClick=((e,t)=>{c.onClickFPS(this.pageContext,e,!0,t,{telemetrySource:"build-result-breadcrumb"})})}getBreadcrumbItems(e){return this.items}_serviceStart(e){super._serviceStart(e),this.loadItems()}loadItems(){let e=this.pageContext.getService("IVssContributionService").getData(we.ContributionKeys.ProviderId);if(e)this._updateItems(e);else{this.pageContext.getService("IVssContributionService").getDataAsync(we.ContributionKeys.ProviderId).then(e=>{e&&this._updateItems(e)})}}refresh(e){e&&this._updateItems(e)}_updateItems(e){this.items.removeAll();const t=e.build,s=this.pageContext.getService("IBuildLinkingService"),i=s.getDefinitionUrl();if(this.items.push({key:"buildHub",text:Ie.BuildsHubName,href:i,onClick:e=>{this._onFPSClick(i,e)}}),t.definition){const e=s.getDefinitionUrl(t.definition.id);this.items.push({key:"buildDefinition",text:t.definition.name,href:e,onClick:t=>{this._onFPSClick(e,t)}})}const a=s.getBuildUrl(t.id);this.items.push({key:"buildResult",text:"#"+t.buildNumber,href:a,onClick:e=>{this._onFPSClick(a,e)}})}}t.HeaderBreadcrumbService.HeaderBreadcrumbService=s,l.Services.add("build-result-header-breadcrumb-service",{serviceFactory:s})}(),function(e){var s,i;Ee=t.Performance={},Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Area="Build"}(s=t.Performance.PerformanceConstants||(t.Performance.PerformanceConstants={})),function(e){e.Logs="CI.BuildResultHub.Logs",e.Results="CI.BuildResultHub.Results",e.OthersFormat="CI.BuildResultHub.{0}"}(i=t.Performance.Scenarios||(t.Performance.Scenarios={}));t.Performance.Marker=class{constructor(e,t){this._ttiMarked={},this._tabSwitchTTIPending={},this._fRenderMarked=!1,this._pageContext=e,this._getDefaultProps=t}reset(){this._tabSwitchTTIPending={},this._ttiMarked={}}markTTI(e,t){if(t){if(!this._tabSwitchTTIPending[e])return;delete this._tabSwitchTTIPending[e],this.service.endScenario(s.Area,e,!0,void 0,this._getProps(t))}else this._ttiMarked[e]||(this._ttiMarked[e]=!0,this.service.markTimeToInteractive(s.Area,e,void 0,this._getProps(t)))}firstRender(){this._fRenderMarked||this.service.addSplitTiming("BuildResultFirstRender"),this._fRenderMarked=!0}startTabSwitch(e){let t="";switch(e){case we.ViewKeys.Logs:t=i.Logs;break;case we.ViewKeys.Results:t=i.Results}t&&(this._tabSwitchTTIPending[t]=!0,this.service.startScenario(t,!1))}get service(){return this._pageContext.getService("IVssPerformanceService")}_getProps(e){let t=Object.assign({},this._getDefaultProps());return e&&(t.isTabSwitch=e),t}}}(),function(e){Pe=t[e]={},Object.defineProperty(t,"__esModule",{value:!0});const s=/^\#*\[([^|\s\]]+).*?\](Starting: )(.*)/,i=/^\#*\[([^|\s\]]+).*?\](Finishing: )(.*)/;t[e].UnRootedLogsKey="__root";class a{static getLogData(e,t,o){let n={};return(e||[]).forEach(e=>{const r=s.exec(e);r&&r.length>3&&(a.s_taskName=r[3]);const d=i.exec(e);d&&d.length>3&&(a.s_taskName=d[3]);let l=a.s_taskName;o&&"00000000-0000-0000-0000-000000000000"!=o&&t!=o&&(l=o),n[l]||(n[l]=[]),n[l]=n[l].concat(this._getLogLines(e))}),n}static clear(){a.s_taskName=t[e].UnRootedLogsKey}static _getLogLines(e){return h.LiveLogsParser.formatLogLine(e)}}a.s_taskName=t[e].UnRootedLogsKey,t[e].LogsParser=a}("LogsParser"),function(e){De=t.SignalRHub={},Object.defineProperty(t,"__esModule",{value:!0});const s=36e5;t.SignalRHub.BuildResultSignalRHub=class extends g.SingleConnectionSignalRHub{constructor(e){super({name:p.HubNames.buildDetailHub,hostInformation:e.hostInformation,userInactivityTimeoutMs:s,proxyToRegister:p.getBuildProxyToRegister,pageContext:e.pageContext}),this._initializeClient=(e=>{e.client.buildUpdated2=((e,t)=>{this._options.actionCreator.buildUpdated(t,this._options.getRoutes(t))}),e.client.logConsoleLines=(e=>{const t=Pe.LogsParser.getLogData(e.lines,e.timelineRecordId,e.stepRecordId);Object.keys(t).length>0&&this._options.actionCreator.consoleLinesUpdated({timelineId:e.timelineId,jobId:e.timelineRecordId,recordLines:t})}),e.client.timelineRecordsUpdated=((e,t,s,i)=>{this._options.actionCreator.timelineRecordsUpdated({buildId:e,planId:t,timelineId:s,changeId:i})}),e.client.buildArtifactAdded=((e,t)=>{this._options.actionCreator.artifactAdded(e,t)})}),this._options=e,this.initializeProxyClient(p.HubNames.buildDetailHub,this._initializeClient,e.listener||new i(e.actionCreator))}listen(e,t){this._previousId!==e&&this._pendingId!==e&&(this._pendingId=e,this.start().then(()=>{const s=this.hub;s&&(this._previousId&&this._stopWatching(this._previousId),s.server.watchBuild(this._options.projectId,e).then(()=>{this._options.actionCreator.isConnectedToBuild(t||e+"")}),this._previousId=e,delete this._pendingId)}))}stopListening(e){this.hub&&(this._stopWatching(e),this._previousId=void 0)}dispose(){super.dispose(),this.hub&&this._previousId&&this._stopWatching(this._previousId)}get hub(){return this.getHub(p.HubNames.buildDetailHub)}_stopWatching(e){const t=this.hub;t&&t.server.stopWatchingBuild(this._options.projectId,e)}};t.SignalRHub.PoolSignalRHub=class extends g.SingleConnectionSignalRHub{constructor(e){super({name:m.HubNames.taskAgentPoolHub,hostInformation:e.hostInformation,userInactivityTimeoutMs:s,proxyToRegister:m.getDTProxyToRegister}),this._poolConnectedStarted={},this._initializeClient=(e=>{e.client.notifyAgentConnected=((e,t)=>{this._options.actionCreator.agentUpdated(e,t,2,!0)}),e.client.notifyAgentDisconnected=((e,t)=>{this._options.actionCreator.agentUpdated(e,t,1,!0)}),e.client.notifyAgentUpdated=((e,t)=>{this._fixAgentStatus(t),this._options.actionCreator.agentUpdated(e,t.id,t.status,t.enabled)}),e.client.notifyAgentRequestAssigned=((e,t)=>{this._options.actionCreator.agentRequestAssigned(e,this._getSerializedJobRequest(t))}),e.client.notifyAgentRequestQueued=((e,t)=>{this._options.actionCreator.agentRequestQueued(e,this._getSerializedJobRequest(t))}),e.client.notifyAgentRequestStarted=((e,t)=>{this._options.actionCreator.agentRequestStarted(e,this._getSerializedJobRequest(t))}),e.client.notifyAgentRequestCompleted=((e,t)=>{this._options.actionCreator.agentRequestCompleted(e,this._getSerializedJobRequest(t))})}),this._fixAgentStatus=(e=>{let t=2;return"string"==typeof e.status&&"offline"==e.status.toLowerCase()&&(t=1),e.status=t,e}),this._options=e,this.initializeProxyClient(m.HubNames.taskAgentPoolHub,this._initializeClient)}listen(e){this._previousId!==e&&this._pendingId!==e&&(this._pendingId=e,this._listenToPoolTimer=window.setTimeout(()=>{this.start().then(()=>{const t=this.hub;t&&(this._previousId&&this.stopListening(this._previousId),t.server.subscribe(e).then(()=>{this._poolConnectedStarted[e]=!0}),this._previousId=e,delete this._pendingId)})},600))}stopListening(e){const t=this.hub;t&&this._poolConnectedStarted[e]&&t.server.unsubscribe(e).then(()=>{this._poolConnectedStarted[e]=!1}),this._listenToPoolTimer&&clearTimeout(this._listenToPoolTimer)}get hub(){return this.getHub(m.HubNames.taskAgentPoolHub)}dispose(){super.dispose(),this.hub&&this._previousId&&this.stopListening(this._previousId)}_getSerializedJobRequest(e){return e.queueTime&&"string"==typeof e.queueTime&&(e.queueTime=new Date(e.queueTime)),e.assignTime&&"string"==typeof e.assignTime&&(e.assignTime=new Date(e.assignTime)),e.finishTime&&"string"==typeof e.finishTime&&(e.finishTime=new Date(e.finishTime)),e.matchedAgents=(e.matchedAgents||[]).map(e=>this._fixAgentStatus(e)),e}};class i{constructor(e){this._isDisconnectivityTriggered=!1,this._isUserInactivityTriggered=!1,this._actionCreator=e}isConnecting(){this._actionCreator.isConnecting()}isConnected(){this._actionCreator.isConnected()}isDisconnected(){this._isUserInactivityTriggered||this._isDisconnectivityTriggered||(this._isDisconnectivityTriggered=!0,this._actionCreator.isDisconnected())}isReconnected(){this._actionCreator.isReconnected()}isReconnecting(){this._actionCreator.isReconnecting()}isSlow(){this._actionCreator.isSlow()}isUserActive(){}isUserInactive(){this._isDisconnectivityTriggered||(this._isUserInactivityTriggered=!0,this._actionCreator.isUserInactive())}}}(),function(e){var s;xe=t.Timeline={},Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Linenumber="linenumber",e.LogFileNumber="logFileLineNumber",e.RepositoryName="repo",e.Path="sourcepath";const t="type",s="error";e.isError=function(e){return!(!e||!e[t]||e[t].toLowerCase()!==s)}}(s=t.Timeline.IssueHelper||(t.Timeline.IssueHelper={}));const i="job",a="phase",o="stage",n="task";var r;!function(e){function t(e){return(e||"").toLowerCase()}e.isJob=function(e){return t(e)===i},e.isPhase=function(e){return t(e)===a},e.isStage=function(e){return t(e)===o},e.isTask=function(e){return t(e)===n}}(r||(r={}));const d="noRoot";class l{constructor(e,t){this._warningCount=0,this._warnings={},this._warningsUniqueMap={},this._errorCount=0,this._errors={},this._errorsUniqueMap={},this._timelineId="",this._jobs={},this._phases={},this._stages={},this._tasks={},this._haveLinkedChild={},this._identifierToStageId={},this._identifierToJobId={},this._stageToPhases={},this._phaseToJobs={},this._jobToTasks={},this._taskToSubTasks={},this._timelineChangedListeners=[],this._sortRecords=((e,t)=>e.order>t.order?1:e.order<t.order?-1:0),this._options=t,this._parseTimeline(e)}updateOptions(e){this._options=e}updateTimeline(e,t,s){this._parseTimeline(e,t,s)}addTimelineChangedListener(e){this._timelineChangedListeners=this._timelineChangedListeners||[],this._timelineChangedListeners.push(e)}removeTimelineChangedListener(e){this._timelineChangedListeners=this._timelineChangedListeners||[];const t=this._timelineChangedListeners.indexOf(e);t>-1&&this._timelineChangedListeners.splice(t,1)}getErrorsCount(){return this._errorCount}getStages(){return 0==Object.keys(this._stages).length&&(this._stages[d]={name:"__default",previousAttempts:[]}),Object.keys(this._stages).map(e=>this._stages[e]).sort(this._sortRecords)}getJobs(e){let t=[];(this._stageToPhases[e||d]||[]).forEach(e=>{const s=this._phaseToJobs[e]||[],i=this._phases[e];0==s.length&&i&&t.push(Object.assign({},i,{order:this._getPhaseOrder(i.order,i)})),t=t.concat(s.map(e=>{const t=this._jobs[e];return Object.assign({},t,{name:this._getJobName(t.name,t.parentId),order:this._getJobOrder(t.order,t.parentId)})}))});let s=[];return(this._phaseToJobs[d]||[]).forEach(e=>{const t=this._jobs[e];t&&s.push(t)}),t.concat(s).sort(this._sortRecords).sort(this._sortRecords)}parseCompletedTasks(e,t){Object.keys(this._tasks).map(s=>{const i=this._tasks[s];e.indexOf(i.name)>-1&&2===i.state&&t(i.name)})}parseCompletedTasksWithIds(e,t){Object.keys(this._tasks).map(s=>{const i=this._tasks[s];e.indexOf(i.id)>-1&&2===i.state&&t(i.id)})}getPhases(){return Object.keys(this._phases).map(e=>this._phases[e]).sort(this._sortRecords)}getTasks(){return Object.keys(this._tasks).map(e=>this._tasks[e]).sort(this._sortRecords)}getJobsForPhase(e){return(this._phaseToJobs[e]||[]).map(e=>this._jobs[e]).sort(this._sortRecords)}getTasksForJob(e,t){let s=(this._jobToTasks[e]||[]).map(e=>this._tasks[e]);if(t&&0==s.length){let i=this._jobs[e];i||(i=this._phases[e]),i&&Object.keys(t).forEach(e=>{if(i.parentId===e||i.id===e){const a=t[e];s=s.concat(a.map((e,t)=>({id:e.id,name:e.name,state:i.state,order:t+1})))}})}if(Object.keys(this._taskToSubTasks).length>0){[...s].forEach(e=>{(this._taskToSubTasks[e.id]||[]).forEach((t,i)=>{const a=Object.assign({},this._tasks[t]);a&&(a.order<=e.order&&(a.order=e.order+i+1),a.name=e.name+" / "+a.name,s.push(a))})})}s=s.sort(this._sortRecords);const i=this._jobs[e],a=i?this._phases[i.parentId]:this._phases[e];if(a&&2==a.state){const e=new Date,t=this._phaseToJobs[a.id]||[];let i=a.result;if(t.length>0){const e=this._jobs[t[0]];e&&4!==e.result&&(i=0)}s.unshift(Object.assign({},a,{type:n,order:0,name:Ie.InitializePhase,startTime:e,finishTime:e,result:i}))}return s}getQueueForJob(e,t){t=t||{};let s=this._jobs[e];s||(s=this._phases[e]);let i=null;if(s){const e=Object.keys(t);for(let a=0;a<=e.length-1;a++){const o=e[a];if(s.parentId===o||s.id===o){i=t[o];break}}}return i}getErrors(){let e=[];return Object.keys(this._errors).forEach(t=>{e=e.concat(this._errors[t])}),e}getIssues(){return this.getErrors().concat(this.getWarnings())}getWarningsCount(){return this._warningCount}getWarnings(){let e=[];return Object.keys(this._warnings).forEach(t=>{e=e.concat(this._warnings[t])}),e}updateTaskInProgress(e,t){let s,i=(this._jobToTasks[t]||[]).map(e=>this._tasks[e]);i.some(t=>(t.id==e||t.name==e)&&(s=t,t.state=1,!0)),s&&i.forEach(e=>{e!=s&&1==e.state&&(e.state=2)})}shouldUpdateTimeline(e){return!e||!e.timeline||(e.timeline.changeId>(this._previousTimelineMarker||0)||e.buildId!==this._previousBuildId||e.timeline.id!==this._timelineId)}clear(){this._warningCount=0,this._errorCount=0,this._warnings={},this._warningsUniqueMap={},this._errors={},this._errorsUniqueMap={},this._jobs={},this._phases={},this._tasks={},this._stages={},this._haveLinkedChild={},this._identifierToStageId={},this._identifierToJobId={},this._phaseToJobs={},this._stageToPhases={},this._jobToTasks={},this._previousTimelineMarker=void 0,this._previousBuildId=void 0,this._lastTimelineUpdateTimer&&clearTimeout(this._lastTimelineUpdateTimer),this._emitTimelineChanged()}_parseTimeline(e,t=!1,i=!1){if(e&&e.buildId){const a=e.timeline;if(this._previousBuildId&&e.buildId!==this._previousBuildId&&(this.clear(),this._options&&this._options.buildChanged&&this._options.buildChanged(this._previousBuildId,e.buildId)),a&&(t||this.shouldUpdateTimeline(e))){this._timelineId=a.id;let t=0,o=0;(a.records||[]).forEach(e=>{if(e)if(t+=e.warningCount,o+=e.errorCount,(e.issues||[]).forEach(t=>{if(t){const i=t.data&&t.data[s.LogFileNumber]||"",a=t.message+i;2===t.type?(this._warnings[e.id]=this._warnings[e.id]||[],this._warningsUniqueMap[e.id]=this._warningsUniqueMap[e.id]||{},this._warningsUniqueMap[e.id][a]||(this._warnings[e.id].push(Object.assign({},t,{taskId:e.id,jobId:e.parentId})),this._warningsUniqueMap[e.id][a]=!0)):1===t.type&&(this._errors[e.id]=this._errors[e.id]||[],this._errorsUniqueMap[e.id]=this._errorsUniqueMap[e.id]||{},this._errorsUniqueMap[e.id][a]||(this._errors[e.id]=this._errors[e.id]||[],this._errors[e.id].push(Object.assign({},t,{taskId:e.id,jobId:e.parentId})),this._errorsUniqueMap[e.id][a]=!0))}}),r.isStage(e.type)){const t=this._identifierToStageId[e.identifier],s=this._stages[t];s&&delete this._stages[t],e.previousAttempts=this._getAttempts(e,s,a.id),this._identifierToStageId[e.identifier]=e.id,this._stages[e.id]=e}else if(r.isPhase(e.type)){const t=e.parentId+"-"+e.id;this._haveLinkedChild[t]||this._pushLink(e.parentId,this._stageToPhases,e.id),this._haveLinkedChild[t]=!0,this._phases[e.id]=e}else if(r.isJob(e.type)){const t=e.identifier&&this._identifierToJobId[e.identifier];if(t&&t!=e.id){delete this._jobs[t];const s=e.parentId+"-"+t;this._haveLinkedChild[s]&&this._deleteLink(e.parentId,this._phaseToJobs,t),this._haveLinkedChild[s]=!1}const s=e.parentId+"-"+e.id;this._haveLinkedChild[s]||this._pushLink(e.parentId,this._phaseToJobs,e.id),this._haveLinkedChild[s]=!0,this._jobs[e.id]=e,this._identifierToJobId[e.identifier]=e.id}else r.isTask(e.type)&&(this._tasks[e.id]||this._pushLink(e.parentId,this._jobToTasks,e.id),this._tasks[e.id]=e)}),this._warningCount=t,this._errorCount=o,this._previousTimelineMarker=a.changeId,this._previousBuildId=e.buildId,Object.keys(this._jobToTasks).forEach(e=>{if(this._tasks[e]){const t=this._jobToTasks[e];delete this._jobToTasks[e],this._pushLinks(e,this._taskToSubTasks,t)}});const n=Object.keys(this._jobs);if(n.length>0&&this._options){let e=0;for(let t=0;t<=n.length-1;t++){if(2!==this._jobs[n[t]].state)break;e++}if(e===n.length)this._options.allJobsSucceeded&&this._options.allJobsSucceeded(),this._lastTimelineUpdateTimer&&clearTimeout(this._lastTimelineUpdateTimer);else{const e=(new Date).getTime();this._options&&this._options.noTimelineUpdates&&(this._lastTimelineUpdateTimer&&clearTimeout(this._lastTimelineUpdateTimer),this._lastTimelineUpdateTimer=window.setTimeout(()=>{this._options&&this._options.noTimelineUpdates&&this._lastTimelineUpdate===e&&this._options.noTimelineUpdates()},l.s_timelineUpdateMissedWindowInMs)),this._lastTimelineUpdate=e}}i||this._emitTimelineChanged()}}else this.clear()}_getJobName(e,t){const s=this._phases[t];if(s){const t=this._stages[s.parentId];let i=t&&"__default"!==t.name?t.name+" ":"";return"Job"===e&&s.name.length>0?i+s.name:i+e}return e}_getAttempts(e,t,s){let i=[];if(t&&t.previousAttempts.length>e.previousAttempts.length)i=t.previousAttempts;else if((i=e.previousAttempts).length<e.attempt){const t={attempt:e.attempt,timelineId:s,recordId:s};i.push(t),i.reverse()}return i}_getPhaseOrder(e,t){if(t){let s=1e4*t.order+e;const i=this._stages[t.parentId];return i&&(s=1e5*i.order+s),s}return e}_getJobOrder(e,t){return this._getPhaseOrder(e,this._phases[t])}_pushLinks(e,t,s){let i=t[e=e||d];i||(i=[],t[e]=i),i.push(...s)}_pushLink(e,t,s){this._pushLinks(e,t,[s])}_deleteLink(e,t,s){let i=t[e],a=i.indexOf(s);a>=0&&i.splice(a,1)}_emitTimelineChanged(){(this._timelineChangedListeners||[]).forEach(e=>e())}}l.s_timelineUpdateMissedWindowInMs=6e4,t.Timeline.TimelineHelper=l}(),function(e){Ue=t.StoresBuildResultView={},Object.defineProperty(t,"__esModule",{value:!0});t.StoresBuildResultView.BuildResultViewStore=class extends R.Store{constructor(e){super(),this._data={},this._additionalDataCalled={},this._prData=null,this._buildUpdatedListeners=[],this._buildChangedListeners=[],this._prChangedListeners=[],this._permsUpdatedListeners=[],this._historicBuildsUpdatedListeners=[],this._commitLinksUpdatedListeners=[],this._witsUpdatedListeners=[],this._usedTasksUpdatedListeners=[],this._triggeredByBuildListeners=[],this._diagAttachmentsListeners=[],this._historicBuilds=[],this._diagAttachments=[],this._commitLinkInfo={},this._deferredCommitLinksForPR=!1,this._taskIdsInUse=[],this._wits=[],this._isLoading=!0,this._view=void 0,this._dataParser=(e=>{let t={build:null,definition:null,timeline:null,rawData:null,isLoading:!1,currentView:"",sourceData:{}};return e&&(t.build=e.build,t.definition=e.definition,t.timeline=e.timeline,t.rawData=e,t.currentView=e.currentView,t.sourceData=e.sourceData,t.approvals=e.approvals),t}),this._additionalDataParser=(e=>{let t={changes:[],repositoryName:""};return e&&(t.changes=e.changes||[],t.repositoryName=e.repositoryName),t}),this._relatedWorkItemsDataParser=(e=>{let t={workItems:[]};if(e){const s=e.workItems||[];t.workItems=s.map(e=>({id:e.id,name:e.title,description:e.description,url:e._links&&e._links.web&&e._links.web.href,type:e.type,currentState:e.currentState,assignedTo:e.assignedTo}))}return t}),this._onContributionDataAvailable=(e=>{if(console.log("Hub data:",e),this._view&&e.currentView!==this._view)return;this._marker.service.addSplitTiming("DataFetched-"+e.currentView),this._isLoading=!1;let t=!1;!this._data.build&&e.build?t=!0:this._data.build&&!e.build?t=!0:this._data.build&&e.build&&this._data.build.id!==e.build.id&&(t=!0),this._previousBuildData=this._data.build,this._data.build=e.build,this._data.currentView=e.currentView,this._data.definition=e.definition,this._data.timeline=e.timeline,this._data.rawData=e.rawData,this._data.sourceData={message:e.sourceData.message,id:e.sourceData.id,branch:e.build.sourceBranch,displayUri:e.sourceData.displayUri},this._data.approvals=e.approvals;const s=this.getSourceProvider();if(s&&(this._data.sourceData.displayId=s.getCommitText(this._data.sourceData.id)),this._updateSourceData(),this._data.build){let e="";this._data.build.definition&&(e=this._data.build.definition.name),document.title=this._data.build.buildNumber+" "+e}if(this._timelineHelper.updateTimeline({buildId:this._data.build?this._data.build.id:null,timeline:this._data.timeline},void 0,!0),t?(this._buildChanged(),this._breadcrumbService.refresh(e)):this._buildUpdated(),this._data.build){let e=!1;if(this._additionalDataCalled[this._data.build.id]&&(e=!0),(1===this._data.build.status||2===this._data.build.status||128===this._data.build.reason&&2===this._data.build.result)&&(this._additionalDataCalled[this._data.build.id]=!0,e=!1),!e){let e={};e[we.ContributionKeys.GetAdditionalData]="true",this._additionalDataActionCreator.fetchContributionData(we.ContributionKeys.AdditionalProviderId,e,!0);const t=this._data.definition;if(t&&t.repository&&t.properties){const e=Object.assign({buildId:this._data.build.id.toString(),repositoryType:t.repository.type,repositoryId:t.repository.id,repositoryName:t.repository.name},t.repository.properties?{serviceEndpointId:t.repository.properties.connectedServiceId}:{});this._relatedWorkItemsActionCreator.fetchContributionData(we.ContributionKeys.RelatedWorkItemsProviderId,e)}}}setTimeout(this._onTimelineUpdated,0)}),this._onAdditionalDataAvailable=(e=>{console.log("Additional Hub data:",e),this._data.changes=e.changes||[],this._data.repositoryName=e.repositoryName,!this._data.repositoryName&&this._data.build&&(this._data.repositoryName=this._data.build.repository.name||this._data.build.repository.id),this.fetchCommitLinksData(),this._buildUpdated()}),this._onRelatedWorkItemsDataAvailable=(e=>{this._wits=e.workItems||[],this._emitWitsUpdated()}),this._buildChanged=(()=>{this._historicBuilds=[],this._diagAttachments=[],this._previousBuildData=null,this._additionalDataCalled={},this.fetchPRData(),this._fetchHistoricBuilds(),this._fetchTriggeredByBuild(),this._onBuildCompleted(),this._emitBuildChanged(),this._artifactsStore.updateBuild(this._data.build?this._data.build.id:void 0)}),this._buildUpdated=(()=>{const e=this._historicBuilds[this._historicBuilds.length-1];e&&this._data.build&&e.id==this._data.build.id&&(this._historicBuilds[this._historicBuilds.length-1]=this._data.build),this._onBuildCompleted(),this._emitBuildUpdated(),this._previousBuildData&&this._data.build&&this._previousBuildData.status!==this._data.build.status&&f.announce(n.format(Ie.AnnounceBuildResult,this._data.build.buildNumber,ke.getIndicatorData(this._data.build).text))}),this._permissionsUpdated=(()=>{this._emitPermissionsUpdated()}),this._onTimelineUpdated=(()=>{this._updateTaskIdsInUse()}),this._historicBuildsUpdated=(e=>{this._historicBuilds=e||[],this._data&&this._data.build&&(this._historicBuilds.find(e=>e.id==this._data.build.id)||this._historicBuilds.push(this._data.build)),this._emitHistoricBuildsUpdated()}),this._emitPRChanged=(()=>{this._tryFetchPRCommitData(),this._prData&&(this._data.sourceData.message=this._prData.title),this.emitChanged(void 0,this._prChangedListeners),this.emitChanged()}),this._projectId=e.projectId,this._projectName=e.projectName,this._userId=e.userId,this._pageContext=e.pageContext,this._contributionActionHub=e.contributionActionHub||new b.ContributionDataActionHub,this._additionalDataActionHub=e.additionalDataActionHub||new b.ContributionDataActionHub,this._relatedWorkItemsActionHub=e.relatedWorkItemsActionHub||new b.ContributionDataActionHub,this._source=e.source||new v.BuildSource({pageContext:e.pageContext,project:this._projectId}),this._artifactsStore=e.artifactsStore,this._contributionActionCreator=new b.ContributionDataActionCreator({pageContext:e.pageContext,actionHub:this._contributionActionHub,dataParser:this._dataParser,errorHandler:_.handleError}),this._additionalDataActionCreator=new b.ContributionDataActionCreator({pageContext:e.pageContext,actionHub:this._additionalDataActionHub,dataParser:this._additionalDataParser,errorHandler:_.handleError}),this._relatedWorkItemsActionCreator=new b.ContributionDataActionCreator({pageContext:e.pageContext,actionHub:this._relatedWorkItemsActionHub,dataParser:this._relatedWorkItemsDataParser,errorHandler:_.handleError}),this._contributionActionHub.contributionDataAvailable.addListener(this._onContributionDataAvailable),this._additionalDataActionHub.contributionDataAvailable.addListener(this._onAdditionalDataAvailable),this._relatedWorkItemsActionHub.contributionDataAvailable.addListener(this._onRelatedWorkItemsDataAvailable),this._permissionsStore=e.permissionsStore?e.permissionsStore:new C.PermissionsStore({pageContext:e.pageContext}),this._security=new S.Security({projectId:this._projectId,store:this._permissionsStore}),this._timelineHelper=new xe.TimelineHelper({buildId:null,timeline:null}),this._permissionsStore.addListener(this._permissionsUpdated),this._timelineHelper.addTimelineChangedListener(this._onTimelineUpdated),this._breadcrumbService=this._pageContext.getService("build-result-header-breadcrumb-service"),this._updateTaskIdsInUse(),this._marker=e.marker}dispose(){super.dispose(),this._contributionActionHub.contributionDataAvailable.removeListener(this._onContributionDataAvailable),this._additionalDataActionHub.contributionDataAvailable.removeListener(this._onAdditionalDataAvailable),this._relatedWorkItemsActionHub.contributionDataAvailable.removeListener(this._onRelatedWorkItemsDataAvailable),this._permissionsStore.removeListener(this._permissionsUpdated),this._buildChangedListeners=[],this._buildUpdatedListeners=[],this._permsUpdatedListeners=[],this._historicBuildsUpdatedListeners=[],this._timelineHelper.removeTimelineChangedListener(this._onTimelineUpdated),this._timelineHelper.clear()}addBuildChangedListener(e){this.addCustomListener(e,this._buildChangedListeners)}removeBuildChangedListener(e){this.removeCustomListener(e,this._buildChangedListeners)}addBuildUpdatedListener(e){this.addCustomListener(e,this._buildUpdatedListeners)}removeBuildUpdatedListener(e){this.removeCustomListener(e,this._buildUpdatedListeners)}addCommitLinksUpdatedListener(e){this.addCustomListener(e,this._commitLinksUpdatedListeners)}removeCommitLinksUpdatedListener(e){this.removeCustomListener(e,this._commitLinksUpdatedListeners)}addHistoricBuildsChangedListener(e){this.addCustomListener(e,this._historicBuildsUpdatedListeners)}removeHistoricBuildsChangedListener(e){this.removeCustomListener(e,this._historicBuildsUpdatedListeners)}addWorkitemsUpdatedListener(e){this.addCustomListener(e,this._witsUpdatedListeners)}removeWorkitemsUpdatedListener(e){this.removeCustomListener(e,this._witsUpdatedListeners)}addPRChangedListener(e){this.addCustomListener(e,this._prChangedListeners)}removePRChangedListener(e){this.removeCustomListener(e,this._prChangedListeners)}addPermsUpdatedListener(e){this.addCustomListener(e,this._permsUpdatedListeners)}removePermsUpdatedListener(e){this.removeCustomListener(e,this._permsUpdatedListeners)}addUsedTasksUpdatedListener(e){this.addCustomListener(e,this._usedTasksUpdatedListeners)}removeUsedTasksUpdatedListener(e){this.removeCustomListener(e,this._usedTasksUpdatedListeners)}addTriggeredByBuildListener(e){this.addCustomListener(e,this._triggeredByBuildListeners)}removeTriggeredByBuildListener(e){this.removeCustomListener(e,this._triggeredByBuildListeners)}addDiagAttachmentsListener(e){this.addCustomListener(e,this._diagAttachmentsListeners)}removeDiagAttachmentsListener(e){this.removeCustomListener(e,this._diagAttachmentsListeners)}cancelBuild(e){this._source.getClient().updateBuild({status:4},this._projectId,e).then(e=>{this._previousBuildData=this._data.build,this._data.build=e,this._buildUpdated()}).catch(_.handleError)}queueRebuild(e){return this._source.getClient().queueBuild({},this._projectId,void 0,void 0,e.id)}queueRetry(e){return this._source.getClient().updateBuild({},this._projectId,e,!0)}getPermissions(){let e=!1,t=!1,s=!1,i=!1,a=!1;if(this._data.build){t=this._security.canCancelBuild(this._userId,this._data.build);const o=this._data.build.definition;o&&(e=this._security.canEditDefinition(o),s=this._security.canQueueBuild(o),i=this._security.canRetainBuild(o),a=this._security.canChangeBuild(o))}return{canEditDefinition:e,canCancelBuild:t,canQueueBuild:s,canRetainBuild:i,canChangeBuild:a,isAnonymousUser:this._security.isAnonymousUser(),isPublicUser:this._security.isPublicUser(),isMember:this._security.isMember()}}getPRData(){return this._prData}getCommitLinkData(e){return this._commitLinkInfo[e]}getSourceData(){return this._data.sourceData}getTimelineHelper(){return this._timelineHelper}getWorkItems(){return this._wits}getTriggeredByBuild(){return this._triggeredByBuild}isLoading(){return this._isLoading}fetchPRData(){const e=this.getBuild();if(e&&256===e.reason){const e=this.getSourceProvider();if(e){const t=this.getBuild(),s=this._getServiceEndpointId(),i=this._getPullRequestNumber(t);e.fetchPullrequestData({branchName:t.sourceBranch,projectId:t.project.id,repositoryName:t.repository.name||t.repository.id,serviceEndpointId:s,pullRequestNumber:i}).then(e=>{this._prData=e,this._emitPRChanged()}).catch(this._emitPRChanged)}}}fetchCommitLinksData(){const e=this.getBuild();e&&(256===e.reason?(this._deferredCommitLinksForPR=!0,this._tryFetchPRCommitData()):this._fetchCommitLinksData())}toggleRetainBuild(e,t){this._source.getClient().updateBuild({keepForever:!t},this._projectId,e).then(e=>{this._previousBuildData=this._data.build,this._data.build=e,this._buildUpdated()}).catch(_.handleError)}fetchData(e,t,s){t=t||{},this._view=t[we.ContributionKeys.View],this._contributionActionCreator.fetchContributionData(we.ContributionKeys.ProviderId,t,e)}getBuild(){return this._data&&this._data.build}getRepoName(){let e="";return this._data&&(e=this._data.repositoryName),e}getChanges(){return this._data&&this._data.changes||[]}getDiagAttachments(){return this._diagAttachments}getHistoricBuilds(){return this._historicBuilds||[]}getData(){return this._data}getTaskIdsInUse(){return this._taskIdsInUse}getSourceProvider(){const e=this.getBuild();return e&&e.repository?this._pageContext.getService("ISourceProviderService").getSourceProvider(e.repository.type):null}_getDefinition(){return this._data&&this._data.definition}async _fetchCommitLinksData(){const e=this.getSourceProvider(),t=this.getChanges(),s=this.getBuild();if(s&&e&&t){let e=s.sourceBranch;this._prData&&(e=this._prData.rawTargetBranch);const i=await this._getChangeLinks(e,t);i&&(i.forEach(e=>{this._commitLinkInfo[e.originalId]=e,e.originalId===this._data.sourceData.id&&(this._data.sourceData.data=e)}),this._emitCommitLinksUpdated())}}async _getChangeLinks(e,t){const s=this.getSourceProvider(),i=this.getBuild();if(i&&s){const a=await s.getProjectName(i.repository.id);return s.fetchLinks(t.map(t=>({branchName:e,repositoryName:i.repository.name||i.repository.id,repositoryUrl:this._getRepoURL(),commitId:t.id,displayUri:t.displayUri||"",links:i._links,projectName:a||void 0})))}}_getRepoURL(){const e=this._getDefinition();let t="";const s=e&&e.repository;return s&&!(t=s.url)&&s.properties&&(t=s.properties.cloneUrl),t}_fetchHistoricBuilds(){const e=this.getHistoricBuilds(),t=this.getBuild();if(t&&0==e.length){let e={definitions:[t.definition.id],maxBuildsPerDefinition:20,queryOrder:3,maxTime:t.finishTime||t.startTime||t.queueTime};if(t.repository){e.repositoryId=t.repository.id,e.repositoryType=t.repository.type;const s=this.getSourceProvider();e.branchName=s?s.getNormalizedBranch(t.sourceBranch,{id:this._projectId,name:this._projectName}):t.sourceBranch}this._source.getBuilds(e).then(e=>{e=e.reverse(),this._historicBuildsUpdated(e)})}}_fetchTriggeredByBuild(){const e=this.getBuild();e&&e.triggeredByBuild&&this._source.getBuild(e.triggeredByBuild.id).then(e=>{this._triggeredByBuild=e,this.emitChanged(void 0,this._triggeredByBuildListeners)})}async _fetchDiagAttachments(){const e=this.getBuild();if(e){const t=this._pageContext.getService("IDistributedLinkingService"),s=await this._source.getClient().getAttachments(this._projectId,e.id,"DistributedTask.Core.DiagnosticLog");s.filter(e=>n.startsWith(e.name,"diagnostics-")&&n.endsWith(e.name,".json")).forEach(async(e,i)=>{if(e._links&&e._links.self&&e._links.self.href){const a=await T.issueRequest(e._links.self.href),o=await a.json();0==i&&(this._diagAttachments=[]);const n=s.filter(e=>e.name===o.fileName),r=n&&n[0];r&&r._links&&r._links.self&&r._links.self.href&&(this._diagAttachments.push({logLink:r._links.self.href,logName:o.fileName,agentName:o.agentName,poolLink:t.getAgentPoolUrl(o.poolId,o.agentId)}),this.emitChanged(void 0,this._diagAttachmentsListeners))}})}}async _updateSourceData(){const e=await this._getChangeLinks(this._data.sourceData.branch,[this._data.sourceData]);e&&e[0]&&(this._data.sourceData.data=e[0],this._emitBuildUpdated())}_onBuildCompleted(){this._data.build&&(2!==this._data.build.status||this._previousBuildData&&2===this._previousBuildData.status||this._fetchDiagAttachments())}_updateTaskIdsInUse(){let e=[];const t=this.getTimelineHelper();t&&(t.getTasks()||[]).forEach(t=>{let s=t.task&&t.task.id;s||(s=t.id),s&&e.push(s.toLowerCase())}),this._taskIdsInUse.length!==e.length&&(this._taskIdsInUse=e,this._emitUsedTasksUpdated())}_getServiceEndpointId(){if(this._data&&this._data.definition&&this._data.definition.repository&&this._data.definition.repository.properties)return this._data.definition.repository.properties.connectedServiceId}_getPullRequestNumber(e){if(e.triggerInfo)return e.triggerInfo["pr.number"]}_emitBuildChanged(){this.emitChanged(void 0,this._buildChangedListeners),this.emitChanged(),!this._previousBuildData&&this._data.build&&f.announce(n.format(Ie.AnnounceBuildResult,this._data.build.buildNumber,ke.getIndicatorData(this._data.build).text))}_emitBuildUpdated(){this.emitChanged(void 0,this._buildUpdatedListeners),this.emitChanged()}_emitCommitLinksUpdated(){this.emitChanged(void 0,this._commitLinksUpdatedListeners),this.emitChanged()}_emitWitsUpdated(){this.emitChanged(void 0,this._witsUpdatedListeners),this.emitChanged()}_emitPermissionsUpdated(){this._data.build&&(this.emitChanged(void 0,this._permsUpdatedListeners),this.emitChanged())}_tryFetchPRCommitData(){this._deferredCommitLinksForPR&&(this._fetchCommitLinksData(),this._deferredCommitLinksForPR=!1)}_emitUsedTasksUpdated(){this.emitChanged(void 0,this._usedTasksUpdatedListeners),this.emitChanged()}_emitHistoricBuildsUpdated(){this.emitChanged(void 0,this._historicBuildsUpdatedListeners),this.emitChanged()}}}(),function(e){Ne=t.StoresLiveContext={},Object.defineProperty(t,"__esModule",{value:!0});t.StoresLiveContext.LiveContextStore=class extends R.Store{constructor(e){super(),this._artifactAddedListeners=[],this._onArtifactAdded=(e=>{this._artifactAddedListeners.forEach(t=>t(e.buildId,e.name))}),this._signalRActionHub=e.actionHub,this._signalRActionHub.artifactAdded.addListener(this._onArtifactAdded)}addArtifactAddedListener(e){this._artifactAddedListeners.push(e)}removeArtifactAddedListener(e){const t=this._artifactAddedListeners.indexOf(e);t>-1&&this._artifactAddedListeners.splice(t,1)}dispose(){this._signalRActionHub.artifactAdded.removeListener(this._onArtifactAdded),this._artifactAddedListeners=[]}}}(),function(e){He=t.TabsResultsSourcesTags={},Object.defineProperty(t,"__esModule",{value:!0});t.TabsResultsSourcesTags.TagsSource=class{constructor(e){this._sortTags=(e=>(e||[]).sort()),this._client=e.client,this._projectId=e.projectId}getTags(){return this._client.getTags(this._projectId).then(this._sortTags)}addBuildTags(e,t){return this._client.addBuildTag(this._projectId,e,t).then(this._sortTags)}deleteBuildTags(e,t){return this._client.deleteBuildTag(this._projectId,e,t).then(this._sortTags)}}}(),function(e){qe=t.TabsResultsActionsTags={},Object.defineProperty(t,"__esModule",{value:!0});t.TabsResultsActionsTags.TagsActionCreator=class{constructor(e){this._actionHub=e.actionHub||new i,this._source=e.source}getTags(){this._source.getTags().then(e=>this._actionHub.tagsSuggestionAvailable.invoke(e)).catch(_.handleError)}addBuildTag(e,t){this._source.addBuildTags(e,t).then(e=>this._actionHub.tagsAdded.invoke(e)).catch(_.handleError)}deleteBuildTag(e,t){this._source.deleteBuildTags(e,t).then(e=>this._actionHub.tagsRemoved.invoke(e)).catch(_.handleError)}};class i{constructor(){this._tagSuggestionsAvailable=new s.Action,this._tagAdded=new s.Action,this._tagRemoved=new s.Action}get tagsSuggestionAvailable(){return this._tagSuggestionsAvailable}get tagsAdded(){return this._tagAdded}get tagsRemoved(){return this._tagRemoved}}t.TabsResultsActionsTags.TagsActionHub=i}(),function(e){je=t.StoresTags={},Object.defineProperty(t,"__esModule",{value:!0});t.StoresTags.TagsStore=class extends R.Store{constructor(e){super(),this._tagSuggestions=[],this._tagsSelected=[],this._initialized=!1,this._onTagsSuggestionAvailable=(e=>{this._tagSuggestions=e,this.emitChanged()}),this._onTagsChanged=(e=>{this._tagsSelected=e.map(e=>({key:e,name:e})),this.emitChanged()}),this._onBuildChanged=(()=>{const e=this._hubStore.getBuild(),t=e?e.tags:[];this._onTagsChanged(t)}),this._projectId=e.projectId,this._tagsActionHub=new qe.TagsActionHub,this._hubStore=e.hubStore,this._tagsSource=new He.TagsSource({client:e.client,projectId:this._projectId}),this._tagsActionCreator=e.actionCreator||new qe.TagsActionCreator({actionHub:this._tagsActionHub,source:this._tagsSource}),this._tagsActionHub.tagsSuggestionAvailable.addListener(this._onTagsSuggestionAvailable),this._tagsActionHub.tagsRemoved.addListener(this._onTagsChanged),this._tagsActionHub.tagsAdded.addListener(this._onTagsChanged),this._hubStore.addBuildChangedListener(this._onBuildChanged),this._onBuildChanged()}getTagSuggestions(){return this._initialized||(this._initialized=!0,this._tagsActionCreator.getTags()),this._tagSuggestions}getSelectedTags(){return this._tagsSelected}addTag(e,t){this._tagsActionCreator.addBuildTag(e,t)}deleteTag(e,t){this._tagsActionCreator.deleteBuildTag(e,t)}dispose(){this._tagsActionHub.tagsSuggestionAvailable.removeListener(this._onTagsSuggestionAvailable),this._tagsActionHub.tagsRemoved.removeListener(this._onTagsChanged),this._tagsActionHub.tagsAdded.removeListener(this._onTagsChanged),this._hubStore.removeBuildChangedListener(this._onBuildChanged)}}}(),function(e){Fe=t.TabsLogsSourcesJobRequest={},Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e){this._client=e.client}getAgentRequests(e,t){return this._client.getAgentRequestsForPlan(e,t)}getAgentRequestsForAgents(e,t){return this._client.getAgentRequestsForAgents(e,t,0).then(e=>e.sort(s.sortRecordsDesc))}getResourceUsage(e,t){return this._client.getResourceUsage(e,t)}}s.sortRecords=((e,t)=>s._sortAsc(e.queueTime,t.queueTime)),s.sortRecordsByAssignTime=((e,t)=>s._sortAsc(e.assignTime,t.assignTime)),s.sortRecordsDesc=((e,t)=>e.queueTime>t.queueTime?-1:e.queueTime<t.queueTime?1:0),s._sortAsc=((e,t)=>e>t?1:e<t?-1:0),t.TabsLogsSourcesJobRequest.JobRequestSource=s}(),function(e){Me=t.TabsLogsActionsJobRequest={},Object.defineProperty(t,"__esModule",{value:!0});t.TabsLogsActionsJobRequest.JobRequestActionCreator=class{constructor(e){this._actionHub=e.actionHub||new i,this._source=new Fe.JobRequestSource({client:e.client})}fetchJobRequests(e,t){this._source.getAgentRequests(e,t).then(e=>this._actionHub.jobRequestsAvailable.invoke(e)).catch(_.handleError)}fetchJobRequestsForAgents(e,t){t=t||[],this._source.getAgentRequestsForAgents(e,t).then(e=>this._actionHub.jobRequestsForAgentsAvailable.invoke(e)).catch(_.handleError)}fetchJobRequestResourceUsage(e,t,s){this._source.getResourceUsage(t,s).then(t=>this._actionHub.resourceUsageAvailable.invoke({jobId:e,resourceUsage:t})).catch(_.handleError)}};class i{constructor(){this._jobRequestsAvailable=new s.Action,this._jobRequestsForAgentsAvailable=new s.Action,this._resourceUsageAvailable=new s.Action}get jobRequestsAvailable(){return this._jobRequestsAvailable}get jobRequestsForAgentsAvailable(){return this._jobRequestsForAgentsAvailable}get resourceUsageAvailable(){return this._resourceUsageAvailable}}t.TabsLogsActionsJobRequest.JobRequestActionHub=i}(),function(e){Ve=t.TabsLogsActionsTimeline={},Object.defineProperty(t,"__esModule",{value:!0});t.TabsLogsActionsTimeline.TimelineActionCreator=class{constructor(e){this._actionHub=e.actionHub||new i,this._source=new I.ContributionSource({pageContext:e.pageContext})}fetchTimeline(e){let t={};t[we.ContributionKeys.BuildId]=e.buildId.toString(),e.planId&&(t[we.ContributionKeys.PlanId]=e.planId),e.timelineId&&(t[we.ContributionKeys.TimelineId]=e.timelineId),e.changeId&&(t[we.ContributionKeys.ChangeId]=e.changeId.toString()),this._source.getDataAsync(we.ContributionKeys.TimelineProviderId,t,!0).then(t=>{if(t){const s={buildId:e.buildId,timeline:t.timeline||null};this._actionHub.timelineAvailable.invoke(s)}}).catch(_.handleError)}};class i{constructor(){this._timelineAvaiable=new s.Action}get timelineAvailable(){return this._timelineAvaiable}}t.TabsLogsActionsTimeline.TimelineActionHub=i}(),function(e){var s;Oe=t.TabsLogsJobIndicator={},Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Job=0]="Job",e[e.Task=1]="Task"}(s=t.TabsLogsJobIndicator.RecordType||(t.TabsLogsJobIndicator.RecordType={})),t.TabsLogsJobIndicator.getIndicatorData=function(e,t){let a=i.getStatusIndicatorData(i.Status.Unknown),o={text:Ie.Unknown,className:"",statusProps:a.statusProps,tooltip:"",reason:"",originalStatusInfo:{text:"",localeDate:"",localeTime:""},finalStatusInfo:{text:"",duration:""}};if(!e)return o;switch(o.originalStatusInfo.text=Ie.Started,o.finalStatusInfo.text=Ie.RanFor,e.state){case 0:a=i.getStatusIndicatorData(i.Status.Pending),o.text=Ie.NotStarted,o.originalStatusInfo.text=Ie.Queued,o.finalStatusInfo.text=Ie.QueuedFor;break;case 1:a=i.getStatusIndicatorData(i.Status.InProgress),o.text=Ie.Running,o.finalStatusInfo.text=Ie.RunningFor;break;case 2:if(e.finishTime){e.startTime||console.warn("Record has finishtime, but no start time - ",e),e.startTime=e.startTime||e.finishTime;const t=Math.abs(e.finishTime.getTime()-e.startTime.getTime());o.finalStatusInfo.duration=ke.getDurationText(t)}else o.finalStatusInfo.duration=n.format(Ie.SecondsFormat,0);switch(e.result){case 0:a=i.getStatusIndicatorData(i.Status.Succeeded),o.text=Ie.Succeeded;break;case 1:a=i.getStatusIndicatorData(i.Status.Warning),o.text=Ie.SucceededWithIssues;break;case 2:a=i.getStatusIndicatorData(i.Status.Failed),o.text=Ie.Failed;break;case 3:a=i.getStatusIndicatorData(i.Status.Cancelled),o.text=Ie.Canceled;break;case 4:a=i.getStatusIndicatorData(i.Status.Skipped),o.text=Ie.Skipped;break;case 5:a=i.getStatusIndicatorData(i.Status.Cancelled),o.text=Ie.Abandoned}}return o.statusProps=a.statusProps,t===s.Job?o.tooltip=n.format(Ie.JobStatusIndicatorFormat,e.name,o.text):t===s.Task&&(o.tooltip=n.format(Ie.TaskStatusIndicatorFormat,e.name,o.text)),o}}(),function(e){Je=t.TabsLogsAttemptsDropdown={},Object.defineProperty(t,"__esModule",{value:!0});t.TabsLogsAttemptsDropdown.AttemptsDropdown=class extends L.VssComponent{constructor(){super(...arguments),this._onAttemptClick=((e,t)=>{this.props.onAttemptClick&&e!=this.props.selectedAttempt&&this.props.onAttemptClick(e,t)})}render(){return r.createElement("div",{className:"attempts-tab-item"},r.createElement("div",{className:"attempt-selection-button-separator"}),r.createElement(A.MenuButton,{subtle:!0,hideDropdownIcon:!0,iconProps:{iconName:"ChevronDown",className:"view-attempts-menu-icon"},className:"view-attempts-button",contextualMenuProps:{menuProps:{id:"view-attempts-menu",items:this._getAttemptsDropdownItems()},anchorOrigin:{horizontal:"end",vertical:"end"}}}))}_getAttemptsDropdownItems(){const e=[],t=this.props.attempts.length;return this.props.attempts.forEach((s,i)=>{const a={id:s.timelineId,text:n.format(Ie.StageNameFormat,Ie.Attempt,s.attempt),onActivate:()=>this._onAttemptClick(t-i,s.timelineId)};e.push(a)}),e}}}(),function(e){Ke=t.TabsLogsStoresLogs={},Object.defineProperty(t,"__esModule",{value:!0});const s="ServerPhase",i=1e4,a=10,o=5,n=3;t.TabsLogsStoresLogs.LogsStore=class extends R.Store{constructor(e){super(),this._consoleLogsRecordData={},this._currentStages=[],this._currentTasksForJob={},this._queueForJob={},this._licenseDataForJob={},this._licenseDataForJobPendingCall={},this._phaseRecordQueue={},this._phaseRecordTasks={},this._recordPhaseType={},this._jobRequestUpdatedListeners=[],this._licenseDataUpdatedListeners=[],this._storeUpdatedListeners=[],this._jobIdToRequestMap={},this._jobIdToRequestsTrials={},this._jobIdToPendingJobRequestCall={},this._jobIdToPosition={},this._positionRequestedJobId="",this._jobIdToPendingState={},this._consoleEventFetchPerformed=!1,this._taskConflictTrails=0,this._feedFetched={},this._otherRequestsMap={},this._gotLiveEvent=!1,this.fetchAttempt=((e,t)=>{this._currentBuild&&this._timelineActionCreator.fetchTimeline({buildId:this._currentBuild.id,timelineId:t})}),this._getJobState=(e=>{let t=128;if(0===e.state)t=1;else if(1===e.state)t=2;else if(2===e.state)switch(e.result){case 0:t=4;break;case 1:t=8;break;case 4:t=128;break;case 2:t=16;break;case 3:t=32;break;case 5:t=16}return t}),this._getTaskState=(e=>{let t=4;if(0===e.state)t=1;else if(1===e.state)t=2;else if(2===e.state)switch(e.result){case 0:t=5;break;case 1:t=7;break;case 4:t=4;break;case 2:t=6;break;case 3:t=3;break;case 5:t=6}return t}),this._onAllJobsSucceeded=(()=>{this._currentBuild&&this._completedBuildIdFetchedForMissingEvent!==this._currentBuild.id&&2!==this._currentBuild.status&&(this._completedBuildIdFetchedForMissingEvent=this._currentBuild.id,this._completedBuildIdFetchedForMissingEventTimer=setTimeout(()=>{this._currentBuild&&2!==this._currentBuild.status&&this._hubActionCreator.fetchData()},3e4))}),this._onAgentUpdated=(e=>{this._getAllRequests().forEach(t=>{(t.matchedAgents||[]).forEach(t=>{t.id===e.agentId&&(t.status=e.status,t.enabled=e.enabled)})}),this._emitJobRequestUpdated()}),this._onJobRequestUpdated=(e=>{this._updateJobRequests([e.request])}),this._onLicenseDataUpdated=(e=>{delete this._licenseDataForJobPendingCall[e.jobId];const t=e&&e.resourceUsage&&e.resourceUsage.resourceLimit;t&&(this._licenseDataForJob[e.jobId]={totalCount:t.totalCount,usedCount:e.resourceUsage.usedCount,totalMinutes:t.totalMinutes,usedMinutes:e.resourceUsage.usedMinutes,isHosted:t.isHosted},this._emitLicenseDataUpdated())}),this._onJobRequestsFromAgents=(e=>{this._updateJobRequests(e)}),this._onJobRequestsAvailability=(e=>{this._updateJobRequests(e)}),this._onHubContributionDataAvailable=(e=>{if(e&&e.rawData){const t=e.rawData;this._phaseRecordQueue=t.phaseRecordQueue||{},this._phaseRecordTasks=t.phaseRecordTasks||{},this._recordPhaseType=t.recordPhaseType||{},this._updateJobData()}}),this._feedDataParser=(e=>{let t={lines:[],taskId:"",jobId:""};return e&&(t.lines=e.lines||[],t.taskId=e.taskId,t.jobId=e.jobId),t}),this._onFeedAvailable=(e=>{if(!this._gotLiveEvent&&e.lines.length>0){let t=[];e.lines.forEach(e=>{t=t.concat(h.LiveLogsParser.formatLogLine(e))});let s={};s[e.taskId]=t,this._updateLiveLogs(e.jobId,s)}this._gotLiveEvent=!1}),this._onBuildChanged=(()=>{this._completedBuildIdFetchedForMissingEvent=void 0,this._consoleLogsRecordData={},this._jobIdToRequestsTrials={},this._jobIdToPendingJobRequestCall={},this._jobIdToPosition={},this._jobIdToRequestMap={},this._currentStages=[],this._currentTasksForJob={},this._queueForJob={},this._licenseDataForJob={},this._licenseDataForJobPendingCall={},this._phaseRecordQueue={},this._phaseRecordTasks={},this._otherRequestsMap={},this._jobIdToPendingState={},this._consoleEventFetchPerformed=!1,this._taskConflictTrails=0,this._feedFetched={},this._onHubContributionDataAvailable(this._hubStore.getData()),this._onHubStoreChanged()}),this._updateConsoleLines=(e=>{let t=!1;this._currentTimeline&&this._currentTimeline.id===e.timelineId?(this._gotLiveEvent=!0,this._updateLiveLogs(e.jobId,e.recordLines),this._jobIdToPendingState[e.jobId]&&(t=!0)):t=!0,t&&this._currentBuild&&!this._consoleEventFetchPerformed&&(this._consoleEventFetchPerformed=!0,console.log("LogsStore: Consolelines conflicting data, fetching timeline...."),this._timelineActionCreator.fetchTimeline({buildId:this._currentBuild.id}))}),this._updateTimelineRecords=(e=>{this._timelineActionCreator.fetchTimeline({buildId:e.buildId,changeId:e.changeId,planId:e.planId,timelineId:e.timelineId})}),this._onTimelineMissed=(()=>{this._currentBuild&&(console.log("LogsStore: missed timeline updates...fetch!"),this._timelineActionCreator.fetchTimeline({buildId:this._currentBuild.id}))}),this._updateTimeline=(e=>{this._currentBuild&&this._currentBuild.id===e.buildId&&(this._currentTimeline=e.timeline,this._updateTimelineHelper(e,!0))}),this._onHubStoreChanged=(()=>{const e=this._hubStore.getData();this._currentBuild=e.build,this._currentBuild&&(this._currentTimeline=e.timeline,this._updateTimelineHelper({buildId:this._currentBuild.id,timeline:this._currentTimeline}))}),this._emitLicenseDataUpdated=(()=>{this.emitChanged(void 0,this._licenseDataUpdatedListeners)}),this._emitJobRequestUpdated=(()=>{this.emitChanged(void 0,this._jobRequestUpdatedListeners)}),this._emitStoreChanged=(()=>{this.emitChanged(void 0,this._storeUpdatedListeners)}),this._hubStore=e.hubStore;const t=this._hubStore.getData();this._currentBuild=t.build,this._currentTimeline=t.timeline,this._contributionActionHub=e.contributionActionHub,this._signalRActionHub=e.signalRActionHub,this._projectId=e.projectId,this._hubActionCreator=e.hubActionCreator,this._poolSignalRActionHub=e.poolSignalRActionHub,this._timelineActionHub=e.timelineActionHub||new Ve.TimelineActionHub,this._timelineActionCreator=new Ve.TimelineActionCreator({actionHub:this._timelineActionHub,pageContext:e.pageContext,projectId:this._projectId}),this._jobRequestActionHub=e.jobRequestActionHub,this._jobRequestActionCreator=new Me.JobRequestActionCreator({actionHub:this._jobRequestActionHub,client:e.dtClient}),this._timelineHelper=this._hubStore.getTimelineHelper(),this._timelineHelper.updateOptions({allJobsSucceeded:this._onAllJobsSucceeded,noTimelineUpdates:this._onTimelineMissed}),this._feedActionHub=new b.ContributionDataActionHub,this._feedDataCreator=new b.ContributionDataActionCreator({pageContext:e.pageContext,actionHub:this._feedActionHub,dataParser:this._feedDataParser,errorHandler:_.handleError}),this._contributionActionHub.contributionDataAvailable.addListener(this._onHubContributionDataAvailable),this._signalRActionHub.consoleLinesUpdated.addListener(this._updateConsoleLines),this._signalRActionHub.timelineRecordsUpdated.addListener(this._updateTimelineRecords),this._feedActionHub.contributionDataAvailable.addListener(this._onFeedAvailable),this._poolSignalRActionHub.agentUpdated.addListener(this._onAgentUpdated),this._poolSignalRActionHub.agentRequestAssigned.addListener(this._onJobRequestUpdated),this._poolSignalRActionHub.agentRequestQueued.addListener(this._onJobRequestUpdated),this._poolSignalRActionHub.agentRequestStarted.addListener(this._onJobRequestUpdated),this._poolSignalRActionHub.agentRequestCompleted.addListener(this._onJobRequestUpdated),this._timelineActionHub.timelineAvailable.addListener(this._updateTimeline),this._jobRequestActionHub.jobRequestsForAgentsAvailable.addListener(this._onJobRequestsFromAgents),this._jobRequestActionHub.jobRequestsAvailable.addListener(this._onJobRequestsAvailability),this._jobRequestActionHub.resourceUsageAvailable.addListener(this._onLicenseDataUpdated),this._hubStore.addBuildChangedListener(this._onBuildChanged),this._hubStore.addBuildUpdatedListener(this._onHubStoreChanged),this._updateJobData(),this._onHubContributionDataAvailable(t)}dispose(){this._contributionActionHub.contributionDataAvailable.removeListener(this._onHubContributionDataAvailable),this._signalRActionHub.consoleLinesUpdated.removeListener(this._updateConsoleLines),this._signalRActionHub.timelineRecordsUpdated.removeListener(this._updateTimelineRecords),this._poolSignalRActionHub.agentUpdated.removeListener(this._onAgentUpdated),this._poolSignalRActionHub.agentRequestAssigned.removeListener(this._onJobRequestUpdated),this._poolSignalRActionHub.agentRequestQueued.removeListener(this._onJobRequestUpdated),this._poolSignalRActionHub.agentRequestStarted.removeListener(this._onJobRequestUpdated),this._poolSignalRActionHub.agentRequestCompleted.removeListener(this._onJobRequestUpdated),this._timelineActionHub.timelineAvailable.removeListener(this._updateTimeline),this._jobRequestActionHub.jobRequestsForAgentsAvailable.removeListener(this._onJobRequestsFromAgents),this._jobRequestActionHub.jobRequestsAvailable.removeListener(this._onJobRequestsAvailability),this._jobRequestActionHub.resourceUsageAvailable.removeListener(this._onLicenseDataUpdated),this._feedActionHub.contributionDataAvailable.removeListener(this._onFeedAvailable),this._completedBuildIdFetchedForMissingEventTimer&&clearTimeout(this._completedBuildIdFetchedForMissingEventTimer),this._jobRequestsTimer&&clearTimeout(this._jobRequestsTimer),this._timelineHelper.updateOptions(void 0),this._hubStore.removeBuildChangedListener(this._onBuildChanged),this._hubStore.removeBuildUpdatedListener(this._onHubStoreChanged)}addListener(e){console.error("LogsStore doesn't support superset listener, subscribe to other specific listeners.")}addJobRequestUpdatedListener(e){this.addCustomListener(e,this._jobRequestUpdatedListeners)}removeJobRequestUpdatedListener(e){this.removeCustomListener(e,this._jobRequestUpdatedListeners)}addLicenseDataUpdatedListener(e){this.addCustomListener(e,this._licenseDataUpdatedListeners)}removeLicenseDataUpdatedListener(e){this.removeCustomListener(e,this._licenseDataUpdatedListeners)}addStoreUpdatedListener(e){this.addCustomListener(e,this._storeUpdatedListeners)}removeStoreUpdatedListener(e){this.removeCustomListener(e,this._storeUpdatedListeners)}getConsoleLogsRecordData(){return this._consoleLogsRecordData}getJobRequest(e){const t=this._jobIdToRequestMap[e.id],s=this._getRequestsFromMap(t);return s.length>0?s[0]:void 0}getQueuePosition(e){return this._positionRequestedJobId=e.id,this._jobIdToPosition[e.id]}getPoolId(e){const t=this._queueForJob[e];return t&&t.pool&&t.pool.id}getCurrentStages(){return this._currentStages}getCurrentTasksForJob(){return this._currentTasksForJob}getLicenseDataForJob(e){return this._licenseDataForJob[e]}getQueueForJob(){return this._queueForJob}clearJobRequestData(e){this._jobRequestsTimer&&clearTimeout(this._jobRequestsTimer),delete this._jobIdToPendingJobRequestCall[e],delete this._jobIdToRequestsTrials[e],this._jobIdToRequestMap[e]={},delete this._jobIdToPosition[e],this._otherRequestsMap={},this._consoleEventFetchPerformed=!1,this._taskConflictTrails=0,this._licenseDataForJob={},this._licenseDataForJobPendingCall={}}fetchJobRequest(e,t){if(0===e.state&&this._currentBuild&&this._currentBuild.id==t){const s=this._jobIdToRequestMap[e.id];this._jobIdToRequestsTrials[e.id]=this._jobIdToRequestsTrials[e.id]||1,s&&0!=Object.keys(s).length||this._jobIdToPendingJobRequestCall[e.id]||!(this._jobIdToRequestsTrials[e.id]<o)||(this._jobIdToPendingJobRequestCall[e.id]=!0,console.info("LogsStore: Trying to fetching job requests for job for build Id with info -",e,t,this._currentBuild,this._queueForJob,this._jobIdToRequestsTrials),this._jobRequestsTimer&&clearTimeout(this._jobRequestsTimer),this._jobRequestsTimer=window.setTimeout(()=>{console.info("LogsStore: Trying to fetching job requests",e.id,this._currentBuild,this._queueForJob);const t=this.getPoolId(e.id);t&&this._currentBuild&&this._currentBuild.orchestrationPlan?(console.info("LogsStore: Fetching job requests for pool",t,this._currentBuild.orchestrationPlan.planId),delete this._jobIdToPendingJobRequestCall[e.id],this._jobIdToRequestsTrials[e.id]++,this._jobRequestActionCreator.fetchJobRequests(t,this._currentBuild.orchestrationPlan.planId)):delete this._jobIdToPendingJobRequestCall[e.id]},600))}}fetchFeed(e,t){if(!this._feedFetched[t]){this._feedFetched[t]=!0;let s={};s[we.ContributionKeys.PlanId]=e,s[we.ContributionKeys.JobId]=t,this._feedDataCreator.fetchContributionData(we.ContributionKeys.FeedProviderId,s,!0)}}fetchLicenseData(e){const t=e.jobId;if(!this._licenseDataForJob[t]){this._licenseDataForJobPendingCall[t]=!0;const s=e.data?e.data.ParallelismTag:"",i=this._queueForJob[t];let a=!1;i&&i.pool&&(a=!!i.pool.isHosted),this._jobRequestActionCreator.fetchJobRequestResourceUsage(t,s,a)}}fetchJobRequestsForAgents(e){if(0===e.state){const t=this._jobIdToRequestMap[e.id];if(t){const s=this.getPoolId(e.id);if(this._currentBuild&&s){const i=this._getRequestsFromMap(t);let o=[];i.forEach(e=>{o=o.concat((e.matchedAgents||[]).map(e=>e.id))});let n=o.filter((e,t,s)=>s.indexOf(e)===t);n.length>0&&(console.info("LogsStore: Fetching job requests for job, for max "+a+" agents",e.id,n),n=n.slice(0,a),this._jobRequestActionCreator.fetchJobRequestsForAgents(s,n))}}}}initializeQueuePosition(e){this._positionRequestedJobId=e,this._setQueuePosition()}setCurrentJob(e){this._currentJobId=e}_getAllRequests(){let e=[];Object.keys(this._jobIdToRequestMap).forEach(t=>{const s=this._jobIdToRequestMap[t];e=e.concat(this._getRequestsFromMap(s))});const t=e.map(e=>e.requestId+"");return Object.keys(this._otherRequestsMap).forEach(s=>{-1==t.indexOf(s)&&e.push(this._otherRequestsMap[s])}),e.sort(Fe.JobRequestSource.sortRecordsDesc)}_getRequestsFromMap(e){e=e||{};let t=[];return Object.keys(e).forEach(s=>{t.push(e[s])}),t.sort(Fe.JobRequestSource.sortRecordsDesc)}_setQueuePosition(){const e=this._positionRequestedJobId,t=this._currentBuild&&this._currentBuild.orchestrationPlan&&this._currentBuild.orchestrationPlan.planId,s=this.getPoolId(e);if(e&&t&&s){const i=this._getAllRequests();let a=null,o=[],n=[];if(i.forEach(i=>{i.poolId===s&&(i.finishTime||(i.assignTime?n.push(i):o.push(i)),i.jobId===e&&i.planId===t&&(a=i))}),a){const t=n.sort(Fe.JobRequestSource.sortRecordsByAssignTime).concat(o.sort(Fe.JobRequestSource.sortRecords));this._jobIdToPosition[e]=t.indexOf(a)}}this._emitJobRequestUpdated()}_updateJobRequests(e){(e||[]).forEach(e=>{const t=e.jobId;this.getPoolId(t)==e.poolId&&this._getCurrentPlanId()===e.planId?(this._jobIdToRequestMap[t]=this._jobIdToRequestMap[t]||{},this._jobIdToRequestMap[t][e.requestId]=e):this._otherRequestsMap[e.requestId]=e}),this._setQueuePosition()}_getCurrentPlanId(){return this._currentBuild&&this._currentBuild.orchestrationPlan&&this._currentBuild.orchestrationPlan.planId}_updateLiveLogs(e,t){let s=Object.assign({},this._consoleLogsRecordData);s[e]||(s[e]={}),Object.keys(t).forEach(a=>{s[e][a]||(s[e][a]=[]),s[e][a].length>i&&s[e][a].splice(0,s[e][a].length-i),s[e][a]=s[e][a].concat(t[a]);const o=(this._timelineHelper.getTasksForJob(e)||[]).find(e=>e.id===a||e.name===a);o&&1!==o.state&&this._timelineHelper.updateTaskInProgress(a,e)}),this._consoleLogsRecordData=s;let a=this._currentJobId;if(!a){const e=this._currentStages;e&&e.length>0&&e[0].jobs.length>0&&(a=e[0].jobs[0].id)}a&&a!==e||this._emitStoreChanged()}_updateTimelineHelper(e,t){let s=!1;e?(t||this._timelineHelper.shouldUpdateTimeline(e))&&(s=!0,this._timelineHelper.updateTimeline(e,!0)):(this._timelineHelper.updateTimeline(null),s=!0);let i=Object.assign({},this._consoleLogsRecordData);this._currentBuild&&2===this._currentBuild.status&&(i={},s=!0),s&&(Object.keys(i).forEach(e=>{const t=i[e];this._timelineHelper.parseCompletedTasks(Object.keys(t),e=>{delete t[e]}),this._timelineHelper.parseCompletedTasksWithIds(Object.keys(t),e=>{delete t[e]})}),this._consoleLogsRecordData=i,this._updateJobData())}_updateJobData(){this._attempts=[],this._currentStages=this._timelineHelper.getStages().map(e=>{const t=this._timelineHelper.getJobs(e.id);return{stage:Object.assign({},e,{jobState:this._getJobState(e)}),jobs:t.map(e=>{const t=this._recordPhaseType;let i=1;const a=e.parentId||e.id;return t&&t[a]?t[a]==s&&(i=2):0===e.state||e.workerName||(i=2),0===e.state?this._jobIdToPendingState[e.id]=!0:delete this._jobIdToPendingState[e.id],Object.assign({},e,{jobType:i,jobState:this._getJobState(e)})})}}),this._currentTasksForJob={};let e=!1;(this._currentStages||[]).forEach(t=>{t.jobs.forEach(t=>{const s=this._timelineHelper.getTasksForJob(t.id,this._phaseRecordTasks);e||(e=this._verifyTaskStates(s,t));const i=this._timelineHelper.getQueueForJob(t.id,this._phaseRecordQueue);this._currentTasksForJob[t.id]=s.map(e=>Object.assign({},e,{taskState:this._getTaskState(e)})),this._queueForJob[t.id]=i})}),this._emitStoreChanged()}_verifyTaskStates(e,t){let s=!1;if(this._currentBuild){let i=0;const a=e.length;for(let o=0;o<=a-1;o++){const n=e[o];if(n.order>0&&1===n.state&&(i++,0===t.state&&a>1)){s=!0;break}if(i>1){s=!0;break}}s&&this._taskConflictTrails<=n&&(console.info("LogsStore: Found conflicting task/job states, fetching latest...",e),this._taskConflictTrails++,this._timelineActionCreator.fetchTimeline({buildId:this._currentBuild.id}))}return s}}}(),function(e){function s(e){switch(e){case 1:return 1;case 2:return 2}}We=t[e]={},Object.defineProperty(t,"__esModule",{value:!0}),t[e].c_singletonPoolSignalRActionHubKey="LogsTab.PoolHubSignalRActionHub";const i=25,a="?$format=zip&api-version=5.0-preview";t[e].LogsTab=class extends r.Component{constructor(o){super(o),this._updateNavState=(e=>{let t=this.props.navigationService.getCurrentState();const s=t[we.NavigationKeys.JobId]||t[we.NavigationKeys.lineStart]||t[we.NavigationKeys.lineEnd]||t[we.NavigationKeys.colStart]||t[we.NavigationKeys.colEnd]||t[we.NavigationKeys.TaskId];delete t[we.NavigationKeys.JobId],delete t[we.NavigationKeys.lineStart],delete t[we.NavigationKeys.lineEnd],delete t[we.NavigationKeys.colStart],delete t[we.NavigationKeys.colEnd],delete t[we.NavigationKeys.TaskId],this.props.navigationService.getHistoryService().replaceState(t),s&&this._updateState(),e&&this._store.setCurrentJob(e.props.itemKey)}),this._getTasksProps=((e,t)=>{const o=this.state.consoleLogsRecordData[t.id]||[];return(e||[]).map(e=>{const n=e.log&&e.log.url;let r=o[e.id]||[];r=0==r.length?o[e.name]||[]:r;const d=o[Pe.UnRootedLogsKey]||[];let l=0==r.length&&1===e.state?d:r;return l=l||[],2===e.state||0===e.state?l=[]:1===e.state&&0==l.length&&l.push({content:Ie.WaitingforLogs}),{taskId:e.id,name:e.name,state:e.taskState,rank:e.order,linkingOptions:{data:{task:e,job:t},getLink:this._onLineLinkClick},fetchLogDelegate:()=>e.log?T.issueRequest(e.log.url).then(e=>e.text()):Promise.resolve(""),startTime:e.startTime,finishTime:e.finishTime,issues:(e.issues||[]).map(e=>({issueType:s(e.type),message:e.message,data:e.data})),percentComplete:e.percentComplete,liveLogsData:{logLines:l,maxLogs:i},logUrl:n?n+a:void 0,resultCode:e.resultCode}})}),this._updateState=(()=>{const e=this._store.getCurrentStages();this.setState({consoleLogsRecordData:this._store.getConsoleLogsRecordData(),stages:e,tasksForJob:this._store.getCurrentTasksForJob(),queueForJob:this._store.getQueueForJob(),build:this.props.hubStore.getBuild(),selection:this._getSelection(e)})}),this._LeftStageItem=(e=>{if(e&&e.item){const t=e.item,s=Oe.getIndicatorData(t,Oe.RecordType.Job);return r.createElement("div",{className:"attempts-tab-item"},r.createElement(D.DefaultVerticalItemRenderer,{title:e.itemText,footerText:s.text}),!!(t.previousAttempts.length>1)&&r.createElement(Je.AttemptsDropdown,{attempts:t.previousAttempts,selectedAttempt:t.attempt,onAttemptClick:this._store.fetchAttempt}))}return null}),this._onLineLinkClick=((e,t)=>{if(this.state.build){let s={};s[we.NavigationKeys.JobId]=e.job.id,s[we.NavigationKeys.TaskId]=e.task.id,s[we.NavigationKeys.lineStart]=t.lineStart+"",t.lineEnd&&(s[we.NavigationKeys.lineEnd]=t.lineEnd+""),t.colStart&&(s[we.NavigationKeys.colStart]=t.colStart+""),t.colEnd&&(s[we.NavigationKeys.colEnd]=t.colEnd+"");const i=this.props.navigationService.getLinkingService(),a=i.getBuildUrl(this.state.build.id,we.ViewKeys.Logs,void 0,void 0,s);return i.getAbsoluteUrl(a)}return""}),this._dtClient=y.getTaskAgentClient(this.props.pageContext),this._linkingService=this.props.pageContext.getService("IBuildLinkingService"),this._jobRequestActionHub=new Me.JobRequestActionHub;let n=k.getSingletonManager().get(t[e].c_singletonPoolSignalRActionHubKey);n||(n=new Ae.PoolHubSignalRActionHub,k.getSingletonManager().add(t[e].c_singletonPoolSignalRActionHubKey,n)),this._poolSignalRActionHub=n,this._poolSignalRHub=new De.PoolSignalRHub({actionCreator:new Ae.PoolHubSignalRActionCreator({actionHub:this._poolSignalRActionHub}),hostInformation:this.props.currentContext}),this._store=new Ke.LogsStore({pageContext:o.pageContext,dtClient:this._dtClient,contributionActionHub:o.hubContributionActionHub,hubActionCreator:o.hubActionCreator,projectId:o.currentContext.projectId,signalRActionHub:o.signalRActionHub,hubStore:o.hubStore,jobRequestActionHub:this._jobRequestActionHub,poolSignalRActionHub:this._poolSignalRActionHub}),this.state={consoleLogsRecordData:this._store.getConsoleLogsRecordData(),stages:this._store.getCurrentStages(),tasksForJob:this._store.getCurrentTasksForJob(),queueForJob:this._store.getQueueForJob(),build:this.props.hubStore.getBuild()}}render(){const e=this.state.stages,t=1==e.length&&e[0];if(0==e.length||t&&0==t.jobs.length)return r.createElement("div",{className:"logs-empty-jobs"},Ie.NoJobsFound);if(t&&1==t.jobs.length&&t.stage.previousAttempts.length<2){const e=t.jobs[0],s=this.state.tasksForJob[e.id],i=this.state.queueForJob[e.id];return r.createElement(d,Object.assign({},this.props,{linkingService:this._linkingService,poolSignalRHub:this._poolSignalRHub,job:e,tasks:s,queue:i,className:"tab-area b-logs-tab-area",getTasksProps:this._getTasksProps,build:this.state.build,selection:this.state.selection&&this.state.selection.taskSelection,store:this._store,onScrollToLine:this._updateNavState}))}return r.createElement(U.VerticalTabList,{selectedKey:this.state.selection?this.state.selection.jobId:void 0,persistManualSelection:!0,isSplitViewReplaceable:!0,onItemClick:this._updateNavState,cssClass:"tab-area b-logs-tab-area"},this._getTabItems())}componentDidMount(){this._store.addStoreUpdatedListener(this._updateState)}componentWillUnmount(){Pe.LogsParser.clear(),this._store.removeStoreUpdatedListener(this._updateState),this._store.dispose()}_getTabItems(){let e=[];const t=this.state.stages,s=1==t.length&&t[0]&&t[0].stage;return t.map(i=>{if(t.length>1||s&&s.previousAttempts.length>1){const t=i.stage;let s="__default"!==t.name?t.name:Ie.Attempt;t.previousAttempts.length>1&&(s=n.format(Ie.StageNameFormat,s,t.attempt.toString())),e.push(r.createElement(x.VerticalTabItem,{key:t.id,itemKey:t.name,itemText:s,item:t,onRenderItem:this._LeftStageItem},r.createElement(o,{stage:t,build:this.state.build,stageName:s})))}i.jobs.forEach(t=>{const s=this.state.tasksForJob[t.id],i=this.state.queueForJob[t.id];e.push(r.createElement(x.VerticalTabItem,{key:t.id,itemKey:t.id,itemText:t.name,item:t,onRenderItem:l},r.createElement(d,Object.assign({},this.props,{linkingService:this._linkingService,poolSignalRHub:this._poolSignalRHub,job:t,tasks:s,queue:i,getTasksProps:this._getTasksProps,build:this.state.build,selection:this.state.selection&&this.state.selection.taskSelection,store:this._store,onScrollToLine:this._updateNavState}))))})}),e}_getSelection(e){e=e||[];let t={},s=void 0;for(const t of e)for(const e of t.jobs)if(1===e.state){s=e.id;break}const i=this.props.navigationService.getCurrentState();return i&&(s||i[we.NavigationKeys.JobId]&&(s=i[we.NavigationKeys.JobId]),i[we.NavigationKeys.TaskId]&&i[we.NavigationKeys.lineStart]&&(t.taskSelection={taskId:i[we.NavigationKeys.TaskId],selection:{lineStart:parseInt(i[we.NavigationKeys.lineStart]),lineEnd:parseInt(i[we.NavigationKeys.lineEnd]),colStart:parseInt(i[we.NavigationKeys.colStart]),colEnd:parseInt(i[we.NavigationKeys.colEnd])}})),s&&(t.jobId=s),t}};class o extends r.Component{render(){const e=this.props.stage,t=(e.issues||[]).map(e=>({issueType:s(e.type),message:e.message,data:e.data})),i=Oe.getIndicatorData(e,Oe.RecordType.Job);return r.createElement("div",{className:"b-stage-view"},r.createElement("div",{className:"stage-header flex flex-row"},r.createElement("div",{className:"text text-ellipsis flex-grow"},this.props.stageName),r.createElement("div",{className:"commands flex-noshrink"},r.createElement(H.HeaderCommandBar,{items:this._getCommands()}))),t.length>0&&r.createElement("div",{className:"issues-section"},r.createElement(P.IssuesComponent,{headerText:Ie.StageIssues,issues:t})),r.createElement("div",{className:"b-status stage-section"},r.createElement("h4",{className:"br-muted"},Ie.Status),r.createElement("div",{className:"stage-content"},r.createElement(q.Status,Object.assign({},i.statusProps,{size:"12",className:"stage-status-icon"})),r.createElement("span",null,i.text))),r.createElement("div",{className:"flex flex-row stage-section"},r.createElement("div",{className:"stage-queue stage-time"},r.createElement("h4",{className:"br-muted"},Ie.Queued),r.createElement("div",{className:"stage-content"},r.createElement(ye.InlineAgoElement,{date:this.props.build.queueTime}))),e.startTime&&r.createElement("div",{className:"stage-start stage-time"},r.createElement("h4",{className:"br-muted"},Ie.Started),r.createElement("div",{className:"stage-content"},r.createElement(ye.InlineAgoElement,{date:e.startTime}))),e.finishTime&&r.createElement("div",{className:"stage-complete stage-time"},r.createElement("h4",{className:"br-muted"},Ie.Completed),r.createElement("div",{className:"stage-content"},r.createElement(ye.InlineAgoElement,{date:e.finishTime})))))}_getCommands(){let e=[];return this.props.stage.log&&e.push({id:"header-download",important:!0,text:Ie.DownloadStageLogs,iconProps:{iconName:"Download"},onActivate:()=>{E.LogsViewUtility.downloadLog(this.props.stage.log.url)}}),e}}class d extends r.Component{constructor(e){super(e),this._clearLink=(()=>{this.props.onScrollToLine()}),this._buildChanged=(()=>{this.setState({jobRequest:void 0}),this.props.store.fetchJobRequest(this.props.job,this.props.build&&this.props.build.id)}),this._updateStateFromStore=(()=>{this.setState(this._getState())}),this.state=this._getState()}render(){const e=this.props.tasks,t=this.props.job,s=this.props.queue,i=1==t.jobType?w.AgentPhaseLogsDetailsView:B.AgentlessPhaseLogsDetailsView;return r.createElement("div",{className:N.css("b-logs-tasks-right-pane",this.props.className)},r.createElement(i,Object.assign({},this._getPhaseViewProps(t,e,s))),0==e.length&&0!==t.state&&r.createElement("div",{className:"empty-tasks"},Ie.NoTasksRetreived))}_getPhaseViewProps(e,t,i){const o=this.props.getTasksProps(t,e),n=e.log&&e.log.url;let r={name:e.name,tasks:o,id:e.id,queueTime:this.props.build&&this.props.build.queueTime,startTime:e.startTime,finishTime:e.finishTime,rank:e.order,jobType:e.jobType,jobState:e.jobState,logUrl:n?n+a:void 0};switch(e.jobType){case 1:r=Object.assign({},r,{agentName:e.workerName,queueId:i&&i.id})}let d,l=void 0;if(this.props.selection)for(let e=0;e<o.length;e++){const t=o[e];if(t&&t.taskId.toLowerCase()===this.props.selection.taskId.toLowerCase()){l=e,d=t;break}}let u=!1;return i&&i.pool?u=!!i.pool.isHosted:this.state.licenseData&&(u=this.state.licenseData.isHosted),Object.assign({item:r,tasks:o,issues:(e.issues||[]).map(e=>({issueType:s(e.type),message:e.message,data:e.data})),indexToScrollOnMount:l},this.props.selection?{selectTaskOptions:{task:d,selection:this.props.selection.selection}}:{},{jobRequest:this.state.jobRequest,isHostedPool:u},this.state.licenseData?{licenseInfo:{totalLicenseCount:this.state.licenseData.totalCount,usedLicenseCount:this.state.licenseData.usedCount,totalMinutes:this.state.licenseData.totalMinutes,usedMinutes:this.state.licenseData.usedMinutes}}:{hideLicenseInfoSection:!0},{queuePosition:this.state.queuePosition,isAnonymousUser:this.props.permissions.isAnonymousUser,hideTimestamp:!0,onPanelChanged:this._clearLink,onScrollToLine:this._clearLink})}componentDidMount(){this.props.store.addJobRequestUpdatedListener(this._updateStateFromStore),this.props.store.addStoreUpdatedListener(this._updateStateFromStore),this.props.store.addLicenseDataUpdatedListener(this._updateStateFromStore),this.props.hubStore.addBuildChangedListener(this._buildChanged),this.props.store.fetchJobRequest(this.props.job,this.props.build&&this.props.build.id),this.state.jobRequest&&this.props.store.fetchJobRequestsForAgents(this.props.job),this.props.store.initializeQueuePosition(this.props.job.id),this._fetchFeed(),this._markPerf()}componentWillUnmount(){this.props.store.removeJobRequestUpdatedListener(this._updateStateFromStore),this.props.store.removeStoreUpdatedListener(this._updateStateFromStore),this.props.store.removeLicenseDataUpdatedListener(this._updateStateFromStore),this.props.hubStore.removeBuildChangedListener(this._buildChanged),this.props.store.clearJobRequestData(this.props.job.id)}componentDidUpdate(e,t){let s=!1;!t.jobRequest&&this.state.jobRequest?s=!0:t.jobRequest&&this.state.jobRequest&&t.jobRequest.requestId!==this.state.jobRequest.requestId&&(s=!0),s&&this.state.jobRequest&&(this.props.store.fetchJobRequestsForAgents(this.props.job),this.props.store.initializeQueuePosition(this.props.job.id),this.props.store.fetchLicenseData(this.state.jobRequest)),this.state.poolId&&this.props.poolSignalRHub.listen(this.state.poolId),this.props.store.fetchJobRequest(this.props.job,this.props.build&&this.props.build.id),this._markPerf()}_getState(){return{jobRequest:this.props.store.getJobRequest(this.props.job),queuePosition:this.props.store.getQueuePosition(this.props.job),poolId:this.props.store.getPoolId(this.props.job.id),licenseData:this.props.store.getLicenseDataForJob(this.props.job.id)}}_fetchFeed(){this.props.build&&this.props.store.fetchFeed(this.props.build.orchestrationPlan.planId,this.props.job.id)}_markPerf(){this.props.job&&this.props.tasks&&this.props.perfMarker.markTTI(Ee.Scenarios.Logs,this.props.isTabSwitchNavigation)}}const l=e=>{if(e){const t=e.item,s=Oe.getIndicatorData(t,Oe.RecordType.Job);return r.createElement(D.DefaultVerticalItemRenderer,{title:t.name,statusIconProps:Object.assign({},s.statusProps,{size:"24"}),footerText:s.text})}return null}}("TabsLogsTab"),function(e){ze=t.TabsResultsActionsContribution={},Object.defineProperty(t,"__esModule",{value:!0});t.TabsResultsActionsContribution.ContributionActionCreator=class{constructor(e){this._actionHub=e.actionHub||new i,this._source=new I.ContributionSource({pageContext:e.pageContext})}getContributions(e){this._source.getContributions(e).then(t=>{if(t){let s=[];t.forEach((t,i)=>{if(t){let a={id:e[i],properties:t,name:t.name};s.push(a)}}),this._actionHub.contributionsAvailable.invoke(s)}}).catch(_.handleError)}};class i{constructor(){this._contributionsAvailable=new s.Action}get contributionsAvailable(){return this._contributionsAvailable}}t.TabsResultsActionsContribution.ContributionActionHub=i}(),function(e){Qe=t.TabsResultsCardSection={},Object.defineProperty(t,"__esModule",{value:!0});t.TabsResultsCardSection.CardSection=class extends r.PureComponent{render(){return r.Children.count(this.props.children)>0?r.createElement("div",{className:"result-card-section"},this.props.children):null}}}(),function(e){Ge=t.TabsResultsLegacySectionComponent={},Object.defineProperty(t,"__esModule",{value:!0});const s=()=>r.createElement(j.Spinner,{className:"build-legacy-section-spinner absolute",size:"small"});t.TabsResultsLegacySectionComponent.LegacySectionComponent=class extends r.Component{constructor(e){super(e),this._buildCallBacks={},this._onBuildContextChanged=((e,t)=>{e&&t&&(this._buildCallBacks[e]=t,t(this.props.build))}),this._onBuildChanged=(()=>{(Object.keys(this._buildCallBacks)||[]).forEach(e=>{(0,this._buildCallBacks[e])(this.props.build)})}),this._onViewDisplayed=(e=>{console.warn("onViewDisplayed is not supported.")}),this._onSelectTab=(e=>{this.props.hubActionCreator.selectView(e)}),this._onSetSectionVisibility=((e,t,s)=>{const i=this.state.hiddenContributionsMap;i[e]=!s,this.setState({hiddenContributionsMap:i})}),this._onTasksUsedChanged=(()=>{this._updateSectionTaskVisibility(this.state.contributions)}),this._contributionsAvailable=(e=>{this.setState({contributions:e}),this._updateSectionTaskVisibility(e)}),this._contributionActionHub=e.ContributionActionHub||new ze.ContributionActionHub,this._contributionActionCreator=new ze.ContributionActionCreator({actionHub:this._contributionActionHub,pageContext:this.props.pageContext}),this.state={contributions:[],hiddenContributionsMap:{}}}componentDidMount(){let e=this.props.pageContext.getService("IVssContributionService").getContributionChildren(this.props.contributionId,this.props.contributionType);e&&(this._contributionActionCreator.getContributions(e),this._contributionActionHub.contributionsAvailable.addListener(this._contributionsAvailable)),this.props.hubContributionActionHub.contributionDataAvailable.addListener(this._onBuildChanged),this.props.hubStore.addUsedTasksUpdatedListener(this._onTasksUsedChanged)}componentWillUnmount(){this._contributionActionHub.contributionsAvailable.removeListener(this._contributionsAvailable),this.props.hubContributionActionHub.contributionDataAvailable.removeListener(this._onBuildChanged),this.props.hubStore.removeUsedTasksUpdatedListener(this._onTasksUsedChanged)}render(){return this.state.contributions.length>0?r.createElement("div",{className:"b-legacy-contributed-section-holder"},this.state.contributions.map(e=>{const t={onBuildChanged:this._onBuildContextChanged.bind(null,e.id),onViewDisplayed:this._onViewDisplayed,selectTab:this._onSelectTab,setSectionVisibility:this._onSetSectionVisibility.bind(null,e.id)};return this.state.hiddenContributionsMap[e.id]?null:r.createElement(Qe.CardSection,{key:e.id},r.createElement("div",{className:"build-legacy-section"},r.createElement("h3",{className:"b-result-section-heading"},e.name),r.createElement(F.LegacyComponent,{modules:["Build/Scripts/LoadSecuredKnockout","VSSPreview/Providers/ContentHost"],wrappedType:"vssLegacyContributionContentHost",dependentContributionIds:["ms.vss-releaseManagement-web.release-service-data-external"],wrappedProps:{className:"build-legacy-section-content",context:t,contribution:e.id,loadingComponent:s},loadingComponent:s,expectRegisteredInstance:!0})))})):null}_updateSectionTaskVisibility(e){const t=this.state.hiddenContributionsMap;let s=!1;(e||[]).forEach(e=>{const i=e.properties;i&&i.supportsTasks&&(s=!0,t[e.id]=Be.isContributionHidden(i.supportsTasks,this.props.hubStore.getTaskIdsInUse()))}),s&&this.setState({hiddenContributionsMap:t})}}}(),function(e){Ze=t.TabsResultsMarkdownSectionComponent={},Object.defineProperty(t,"__esModule",{value:!0});const s=()=>r.createElement(j.Spinner,{className:"b-markdown-section-spinner absolute",size:"small"});class i extends r.Component{constructor(e){super(e),this._fetchAttachments=(e=>{this.props.buildClient.getAttachments(this.props.projectId,e,"DistributedTask.Core.Summary").then(e=>{let t=[],s=[];(e||[]).forEach(e=>{const i=e._links.self;i&&i.href&&(t.push(T.issueRequest(i.href).then(e=>e.arrayBuffer().then(e=>{let t=new Uint8Array(e);return t.length>=3&&239===t[0]&&187===t[1]&&191===t[2]&&(t=t.slice(3,t.length-1)),String.fromCharCode(...t)}))),s.push(e.name))}),Promise.all(t).then(e=>{this.setState({attachments:e.map((e,t)=>({name:s[t],content:e}))})})})}),this.timerManagement=new M.TimerManagement,this.state={attachments:[]}}render(){return r.createElement("div",{className:"b-markdown-section-holder"},this.state.attachments.map((e,t)=>r.createElement(Qe.CardSection,{key:e.name+t},r.createElement("div",{className:"b-markdown-section"},r.createElement("h3",{className:"b-result-section-heading"},e.name),r.createElement(F.LegacyComponent,{modules:["DistributedTaskControls/Components/MarkdownRenderer"],wrappedType:"dtMarkdownRenderer",markdown:e.content,markdownRendererOptions:i.s_markdownOptions,loadingComponent:s})))))}componentDidMount(){this._fetchAttachments=this.timerManagement.debounce(this._fetchAttachments,100),this._fetchAttachments(this.props.buildId)}componentWillReceiveProps(e){this.props.buildId!==e.buildId&&this._fetchAttachments(e.buildId)}componentWillUnmount(){this.timerManagement.dispose()}}i.s_markdownOptions={breaks:!0,html:!0,validateLink:o},t.TabsResultsMarkdownSectionComponent.MarkdownSectionComponent=i;const a=/^(vbscript|javascript|file|data):/;function o(e){var t=e.trim().toLowerCase();return!a.test(t)}t.TabsResultsMarkdownSectionComponent.validateLinkProtocol=o}(),function(e){$e=t.TabsResultsStoresResults={},Object.defineProperty(t,"__esModule",{value:!0});t.TabsResultsStoresResults.ResultsStore=class extends R.Store{constructor(e){super(),this._errorLinksUpdatedListeners=[],this._warningLinksUpdatedListeners=[],this._storeUpdatedListeners=[],this._onStoreChanged=(()=>{this._parseIssues(),this.emitChanged(void 0,this._storeUpdatedListeners)}),this._errorLinksAvailable=(e=>{this._updateIssueLinks(this._issueData.errors,e),this.emitChanged(void 0,this._errorLinksUpdatedListeners)}),this._warningLinksAvailable=(e=>{this._updateIssueLinks(this._issueData.warnings,e),this.emitChanged(void 0,this._warningLinksUpdatedListeners)}),this._hubStore=e.hubStore,this._hubStore.addBuildChangedListener(this._onStoreChanged),this._hubStore.addBuildUpdatedListener(this._onStoreChanged),this._timelineHelper=this._hubStore.getTimelineHelper(),this._navigationService=e.navigationService,this._parseIssues()}dispose(){this._hubStore.removeBuildChangedListener(this._onStoreChanged),this._hubStore.removeBuildUpdatedListener(this._onStoreChanged)}getChanges(){return this._hubStore.getChanges()}getIssues(){return this._issueData}addListener(e){console.error("ResultsStore doesn't support superset listener, subscribe to other specific listeners.")}addErrorLinksListener(e){this.addCustomListener(e,this._errorLinksUpdatedListeners)}removeErrorLinksListener(e){this.removeCustomListener(e,this._errorLinksUpdatedListeners)}addWarningLinksListener(e){this.addCustomListener(e,this._warningLinksUpdatedListeners)}removeWarningLinksListener(e){this.removeCustomListener(e,this._warningLinksUpdatedListeners)}addStoreUpdatedListener(e){this.addCustomListener(e,this._storeUpdatedListeners)}removeStoreUpdatedListener(e){this.removeCustomListener(e,this._storeUpdatedListeners)}_parseIssues(){let e=[],t=[];const s=this._hubStore.getBuild();let i=0,a=0;if(s){s.validationResults.forEach(s=>{1==s.result?(t.push({message:s.message,type:2,data:{},category:"",isLogsLink:!1}),a++):2==s.result&&(e.push({message:s.message,type:1,data:{},category:"",isLogsLink:!1}),i++)}),e=e.concat(this._timelineHelper.getErrors().map(e=>Object.assign({},e,{isLogsLink:!1}))),t=t.concat(this._timelineHelper.getWarnings().map(e=>Object.assign({},e,{isLogsLink:!1}))),i+=this._timelineHelper.getErrorsCount(),a+=this._timelineHelper.getWarningsCount();const o=this._hubStore.getSourceProvider();if(o){const i=this._setLinksAndGetLinksToFetch(o,e,s.id,s.sourceVersion);i.length>0&&o.fetchContentLinks(i).then(this._errorLinksAvailable);const a=this._setLinksAndGetLinksToFetch(o,t,s.id,s.sourceVersion);a.length>0&&o.fetchContentLinks(a).then(this._warningLinksAvailable)}}this._issueData={errors:e,warnings:t,errorCount:i,warningCount:a}}_setLinksAndGetLinksToFetch(e,t,s,i){let a=[];return e&&t.forEach((e,t)=>{const o=e.data;if(o)if(o[xe.IssueHelper.Linenumber]&&o[xe.IssueHelper.RepositoryName])a.push({id:t+"",lineNumber:o[xe.IssueHelper.Linenumber],lineTooltip:e.message,path:o[xe.IssueHelper.Path],repositoryName:o[xe.IssueHelper.RepositoryName],version:i,isError:xe.IssueHelper.isError(o)});else if(o[xe.IssueHelper.LogFileNumber]){let t={};t[we.NavigationKeys.lineStart]=o[xe.IssueHelper.LogFileNumber],e.jobId&&(t[we.NavigationKeys.JobId]=e.jobId),e.taskId&&(t[we.NavigationKeys.TaskId]=e.taskId),e.link=this._navigationService.getLinkingService().getBuildUrl(s,we.ViewKeys.Logs,void 0,void 0,t),e.isLogsLink=!0}}),a}_updateIssueLinks(e,t){(t=t||[]).forEach(t=>{const s=parseInt(t.id);e[s]&&(e[s].link=t.link)})}}}(),function(e){Ye=t.TabsResultsTab={},Object.defineProperty(t,"__esModule",{value:!0});const s=e=>r.createElement("span",{className:"icon-text-area"},r.createElement("span",null,r.createElement(Z.Icon,{iconName:e.iconName,className:N.css("icon-element",e.className)})," "),r.createElement("span",null,e.displayText)),i=e=>{const t=e.formatString||Ie.RequestedFormat;return r.createElement("span",{id:e.id},r.createElement("span",null,n.format(t,e.name)," "),e.getRequestedPostfix&&r.createElement("span",null,e.getRequestedPostfix()," "),r.createElement(ye.InlineAgoElement,{date:e.time}))},a=e=>r.createElement("h3",Object.assign({className:"b-result-heading"},e.ariaDescribedBy?{"aria-describedby":e.ariaDescribedBy}:{},e.tabIndex?{tabIndex:e.tabIndex}:{}),e.text),d="BranchCommit",l="build-summary-tab",u=10,c="build-timeline-tab";t.TabsResultsTab.ResultsTab=class extends r.Component{constructor(e){super(e),this._hostPath="",this._onStoreChanged=(()=>{this.setState({changes:this._store.getChanges(),tabData:this.props.hubStore.getData(),sourceProvider:this.props.hubStore.getSourceProvider()})}),this._store=new $e.ResultsStore({pageContext:e.pageContext,hubStore:this.props.hubStore,navigationService:this.props.navigationService}),this._projectId=e.currentContext.projectId,this._buildClient=this.props.pageContext.getRestClient("IBuildRestClient"),this._layoutManager=this.props.pageContext.getService("IVssLayoutManager"),this._linkingService=this.props.pageContext.getService("IBuildLinkingService");const t=e.pageContext.getService("IVssPageService").getData();t&&(this._hostPath=t.hostPath),this.state={changes:this._store.getChanges(),tabData:this.props.hubStore.getData(),sourceProvider:this.props.hubStore.getSourceProvider()}}componentDidMount(){this._store.addStoreUpdatedListener(this._onStoreChanged),this._markPerf()}componentDidUpdate(){this._markPerf()}componentWillUnmount(){this._store.removeStoreUpdatedListener(this._onStoreChanged),this._store.dispose()}render(){const e=this.state.tabData.build,t=this.state.tabData.definition,s=this.state.tabData.timeline,i=this.state.tabData.approvals;if(!e)return this.state.tabData.isLoading?r.createElement(j.Spinner,{label:Ie.BuildLoadingText}):null;const a=!!i&&i.length>0,o=this._getResourceAuthErrors();return r.createElement("div",{className:"b-results-tab tab-area flex flex-row"},r.createElement("div",{className:"b-summary-left flex-grow"},!!o&&r.createElement(P,{resourceAuthErrorMessages:o,pageContext:this.props.pageContext,definitionId:this.state.tabData.definition.id,sourceBranch:this.state.tabData.build.sourceBranch}),a&&!!s&&r.createElement(Qe.CardSection,null,r.createElement(E,{approvals:i,pageContext:this.props.pageContext,projectId:this._projectId,timeline:s})),r.createElement(Qe.CardSection,null,r.createElement("h2",{className:"b-result-section-heading"},Ie.Progression),r.createElement(S,{build:e,timeline:s,changes:this.state.changes,hostPath:this._hostPath,hubActionCreator:this.props.hubActionCreator,linkingService:this._linkingService,pageContext:this.props.pageContext,sourceProvider:this.state.sourceProvider,buildClient:this._buildClient,projectId:this._projectId,hubStore:this.props.hubStore,tabStore:this._store,permissions:this.props.permissions,artifactsStore:this.props.artifactsStore})),r.createElement(w,{pageContext:this.props.pageContext,projectId:this._projectId,hostPath:this._hostPath,build:e,hubStore:this.props.hubStore,definition:t,buildClient:this._buildClient,hubActionCreator:this.props.hubActionCreator,layoutManager:this._layoutManager,linkingService:this._linkingService,sourceProvider:this.state.sourceProvider,permissions:this.props.permissions}),r.createElement(m,{hubStore:this.props.hubStore}),2==e.status&&r.createElement(Ze.MarkdownSectionComponent,{buildId:e.id,buildClient:this._buildClient,projectId:this._projectId}),r.createElement(Ge.LegacySectionComponent,{contributionId:"ms.vss-build-web.build-results-summary-tab",contributionType:"ms.vss-build-web.build-results-section",pageContext:this.props.pageContext,build:e,hubContributionActionHub:this.props.hubContributionActionHub,hubActionCreator:this.props.hubActionCreator,hubStore:this.props.hubStore})),r.createElement(h,{build:e,hubStore:this.props.hubStore,linkingService:this.props.navigationService.getLinkingService()}))}_markPerf(){this.state.tabData.build&&this.props.perfMarker.markTTI(Ee.Scenarios.Results,this.props.isTabSwitchNavigation)}_getResourceAuthErrors(){return this._store.getIssues().errors.map(e=>e.message).filter(e=>e.indexOf("https://aka.ms/yamlauthz")>0).join("\n")}};class h extends r.Component{constructor(e){super(e),this._update=(()=>{this.setState(this._getState())}),this._buildToHistogramItem=(e=>{let t="";if(e.result)switch(e.result){case 2:t=O.HistogramStates.Success;break;case 8:case 32:t=O.HistogramStates.Failure;break;case 4:t=O.HistogramStates.Warning}1===e.status&&(t=O.HistogramStates.Running);let s=Date.now(),i=e.startTime?e.startTime.getTime():e.queueTime?e.queueTime.getTime():s,a=e.finishTime?e.finishTime.getTime():s;const o=ke.getIndicatorData(e);return{id:e.id,href:this.props.linkingService.getBuildUrl(e.id),tooltip:o.tooltip,state:t,value:a-i,noHoverStyles:!e.finishTime}}),this.state=this._getState()}componentDidMount(){this.props.hubStore.addHistoricBuildsChangedListener(this._update)}componentWillUnmount(){this.props.hubStore.removeHistoricBuildsChangedListener(this._update)}render(){const e=this.props.build;return e?r.createElement("div",{className:"b-summary-right"},r.createElement("div",{className:"b-queued"},r.createElement("h4",{className:"br-muted"},Ie.Queued),r.createElement(ye.InlineAgoElement,{className:"has-caps",date:e.queueTime})),e.startTime&&r.createElement("div",{className:"b-started margin-top"},r.createElement("h4",{className:"br-muted"},n.format(Ie.StartedAfter,o.duration(e.queueTime,e.startTime))),r.createElement(ye.InlineAgoElement,{className:"has-caps",date:e.startTime})),e.finishTime&&r.createElement("div",{className:"b-finished margin-top"},r.createElement("h4",{className:"br-muted"},n.format(Ie.CompletedAfter,o.duration(e.startTime,e.finishTime))),r.createElement(ye.InlineAgoElement,{className:"has-caps",date:e.finishTime})),e.startTime&&!e.finishTime&&r.createElement("div",{className:"b-running b-inline-ago margin-top"},r.createElement("h4",{className:"br-muted"},Ie.Running),r.createElement(ee.Duration,{startDate:e.startTime})),this.state.oldestTime&&r.createElement("div",{className:"margin-top"},r.createElement("h4",{className:"br-muted"},Ie.BuildsSince,r.createElement("span",{className:"b-lowercase"},o.ago(this.state.oldestTime,1))),r.createElement("div",{className:"b-histogram"},r.createElement(O.TelemetryContext.Provider,{value:l},2!==e.status&&r.createElement(p,{items:this.state.histogramItems,ariaLabelForList:Ie.AriaHistogramBuildsList,width:8,height:40,selectRightMost:!0}),2===e.status&&r.createElement(O.Histogram,{items:this.state.histogramItems,ariaLabelForList:Ie.AriaHistogramBuildsList,width:8,height:40,selectRightMost:!0}))))):null}_getState(){const e=this.props.hubStore.getHistoricBuilds();return{histogramItems:e.map(this._buildToHistogramItem),oldestTime:e&&e[0]&&e[0].queueTime}}}class p extends L.VssComponent{render(){return r.createElement(O.Histogram,Object.assign({},this.props))}componentDidMount(){this.setInterval(()=>{this.forceUpdate()},1e3)}}class m extends r.Component{constructor(e){super(e),this._onDiagAttachments=(()=>{this.setState(this._getState())}),this.state=this._getState()}render(){return this.state.attachments.length>0?r.createElement(Qe.CardSection,null,r.createElement("div",{className:"b-diag-section"},r.createElement("h3",{className:"b-result-section-heading"},Ie.DiagSectionTitle),r.createElement("table",null,r.createElement("tr",null,r.createElement("th",null,Ie.DiagPhaseTitle),r.createElement("th",null,Ie.DiagAgentTitle)),this.state.attachments.map(e=>r.createElement("tr",{key:e.logName},r.createElement("td",{className:"attachment-col"},r.createElement($.Link,{href:e.logLink},e.logName)),r.createElement("td",{className:"attachment-col"},r.createElement($.Link,{href:e.poolLink},e.agentName))))))):null}componentDidMount(){this.props.hubStore.addDiagAttachmentsListener(this._onDiagAttachments)}componentWillUnmount(){this.props.hubStore.removeDiagAttachmentsListener(this._onDiagAttachments)}_getState(){return{attachments:this.props.hubStore.getDiagAttachments()}}}const g=z.Timeline,b=z.TimelineSnapshot,_=new Date(1700,1,1);class S extends r.Component{constructor(e){super(e),this._updateState=(()=>{this.setState({providers:this.props.artifactsStore.getArtifactProviders()})}),this._initializeBuildTimelineSnapshot=((e,t)=>{t(e.queueTime)}),this._initializeBuildDeletedTimelineSnapshot=((e,t)=>{t(e.deletedDate)}),this._initializeArtifactTimelineSnapshot=((e,t)=>{t(e.finishTime||e.startTime||e.queueTime)}),this._initializeAsBeforeQueueTimeSnapshot=((e,t)=>{let s=new Date(e.queueTime);s.setMilliseconds(e.queueTime.getMilliseconds()-1),t(s)}),this._initializeChangesTimelineSnapshot=((e,t)=>{t(_)}),this._getManuallyQueuedPrimaryElement=(e=>r.createElement(a,{ariaDescribedBy:"build-mq-desc",tabIndex:0,text:Ie.ManuallyQueued})),this._getBuildDeletedPrimaryElement=(e=>r.createElement(a,{ariaDescribedBy:"build-deleted-desc",tabIndex:0,text:e})),this.state={providers:this.props.artifactsStore.getArtifactProviders()}}render(){const e=this.props.build;let t={name:d,type:0};const s=1===e.reason,o=256===e.reason,n=512===e.reason,l=8===e.reason,u=128===e.reason,c=64===e.reason,h=ke.getIndicatorData(e,ke.IndicatorSize.Large);let p=d;return this.props.sourceProvider&&(p=this.props.sourceProvider.getCommitIconName()),s||l?t.name=p:u?t.name="Shield":c?t.name="BranchShelveset":2!==e.reason&&4!==e.reason||(t.name="LightningBolt"),r.createElement(g,{resource:e,className:"b-summary-timeline flex",projectId:this.props.projectId,regionForSnapshots:"buildSummaryTimeline",showAllContributedItemsAtOnce:!0},this.state.providers.length>0&&r.createElement(b,{snapshotKey:"buildArtifactsTimelineSnapshot",className:"build-artifacts-snapshot",iconProps:{name:"ZipFolder"},statusIconProps:this.state.providers.length,initializeSnapshot:this._initializeArtifactTimelineSnapshot},r.createElement(V.ArtifactSnapshotContent,{store:this.props.artifactsStore})),e.deleted&&r.createElement(b,{snapshotKey:"BuildDeletion",iconProps:{name:"Delete",type:0},initializeSnapshot:this._initializeBuildDeletedTimelineSnapshot},r.createElement(k,{id:"build-deleted",context:"BuildDeletion",pageContext:this.props.pageContext,personaProps:{id:e.deletedBy.id,imageUrl:J.getAvatarUrl(e.deletedBy),displayName:e.deletedBy.displayName},getPrimaryElement:this._getBuildDeletedPrimaryElement,className:"individual-timeline-area",noHoverBehaviorStyle:!0,data:e.deletedReason},r.createElement(i,{name:e.deletedBy.displayName,time:e.deletedDate,formatString:Ie.DeletedFormat,id:"build-deleted-desc"}))),r.createElement(b,{snapshotKey:"Build",iconProps:{name:"Build",type:0},initializeSnapshot:this._initializeBuildTimelineSnapshot,statusIconProps:{statusProps:h.statusProps,className:h.className}},r.createElement(R,{build:e,timeline:this.props.timeline,hubActionCreator:this.props.hubActionCreator,linkingService:this.props.linkingService,sourceProvider:this.props.sourceProvider,indicatorData:h,buildClient:this.props.buildClient,projectId:this.props.projectId,hubStore:this.props.hubStore,tabStore:this.props.tabStore,pageContext:this.props.pageContext,permissions:this.props.permissions})),s&&r.createElement(b,{snapshotKey:"ManuallyQueued",iconProps:{name:"BuildQueueNew",type:0},initializeSnapshot:this._initializeAsBeforeQueueTimeSnapshot},r.createElement(k,{id:e.requestedFor?e.requestedFor.id:"",pageContext:this.props.pageContext,context:"ManuallyQueued",className:"individual-timeline-area",personaProps:{id:e.requestedFor?e.requestedFor.id:"",imageUrl:J.getAvatarUrl(e.requestedFor),displayName:e.requestedFor?e.requestedFor.displayName:""},getPrimaryElement:this._getManuallyQueuedPrimaryElement,noHoverBehaviorStyle:!0},r.createElement(i,{name:e.requestedFor?e.requestedFor.displayName:"",time:e.queueTime,id:"build-mq-desc"}))),l&&r.createElement(b,{snapshotKey:"ScheduledBuild",iconProps:{name:"LightningBolt",type:0},initializeSnapshot:this._initializeAsBeforeQueueTimeSnapshot},r.createElement("div",{className:"scheduletrigger-timeline timeline-padding-adjustment"},r.createElement(a,{text:Ie.ScheduledTrigger}),r.createElement("span",{className:"br-muted"},r.createElement(i,{name:e.requestedFor?e.requestedFor.displayName:"",time:e.queueTime})))),o&&r.createElement(b,{snapshotKey:"PullRequest",iconProps:{name:"BranchPullRequest",type:0},initializeSnapshot:this._initializeAsBeforeQueueTimeSnapshot},r.createElement(v,{pageContext:this.props.pageContext,build:this.props.build,sourceProvider:this.props.sourceProvider,hubStore:this.props.hubStore})),n&&r.createElement(b,{snapshotKey:"BuildCompletition",iconProps:{name:"LightningBolt",type:0},initializeSnapshot:this._initializeAsBeforeQueueTimeSnapshot},r.createElement(C,{pageContext:this.props.pageContext,build:this.props.build,hubStore:this.props.hubStore})),e.repository&&r.createElement(b,{snapshotKey:"Changes",iconProps:t,initializeSnapshot:this._initializeChangesTimelineSnapshot,statusIconProps:this.props.changes.length},r.createElement(A,{repositoryType:e.repository.type,repositoryName:e.repository.name,changes:this.props.changes,hostPath:this.props.hostPath,pageContext:this.props.pageContext,sourceProvider:this.props.sourceProvider,hubStore:this.props.hubStore})))}componentDidMount(){this.props.artifactsStore.addListener(this._updateState)}componentWillUnmount(){this.props.artifactsStore.removeListener(this._updateState)}}class v extends r.Component{constructor(e){super(e),this._getPRRequestedPostfixElement=(()=>{if(this.props.sourceProvider&&this.state.data&&this.state.data.sourceBranch&&this.state.data.targetBranch){let e=this.state.data.sourceBranch,t=this.state.data.targetBranch;const i=this.props.sourceProvider.getBranchIconName(e),a=this.props.sourceProvider.getBranchIconName(t);return this.state.data.sourceRepositoryOwner&&this.state.data.targetRepositoryOwner&&this.state.data.sourceRepositoryOwner!==this.state.data.targetRepositoryOwner&&(e=`${this.state.data.sourceRepositoryOwner}:${e}`,t=`${this.state.data.targetRepositoryOwner}:${t}`),r.createElement("span",null,r.createElement("span",{className:"b-lowercase"},Ie.To," "),r.createElement("span",{className:"b-lowercase"},Ie.MergeFrom," "),r.createElement(s,{iconName:i,displayText:e}),r.createElement("span",null," "),r.createElement("span",{className:"b-lowercase"},Ie.To," "),r.createElement(s,{iconName:a,displayText:t}))}return null}),this._getPRPrimaryElement=(()=>this.state.data?r.createElement(X.FPSLinkComponent,Object.assign({href:this.state.data.url,telemetrySource:c},{"aria-describedby":"build-pr-desc"}),this.state.data.title):r.createElement("span",null,Ie.PullRequest)),this._onPullRequestAvailable=(()=>{this.setState({data:this.props.hubStore.getPRData()})}),this.state={data:this.props.hubStore.getPRData()}}render(){const e=this.props.build.requestedFor?this.props.build.requestedFor.displayName:"";return r.createElement(k,{id:this.props.build.requestedFor.id,pageContext:this.props.pageContext,context:"PullRequest",personaProps:{id:this.props.build.requestedFor.id,imageUrl:J.getAvatarUrl(this.props.build.requestedFor),displayName:e},getPrimaryElement:this._getPRPrimaryElement},r.createElement(i,{name:e,time:this.props.build.queueTime,getRequestedPostfix:this._getPRRequestedPostfixElement,id:"build-pr-desc"}))}componentDidMount(){this.props.hubStore.addPRChangedListener(this._onPullRequestAvailable)}componentWillUnmount(){this.props.hubStore.removePRChangedListener(this._onPullRequestAvailable)}}class C extends r.Component{constructor(e){super(e),this._onTriggeredByBuild=(()=>{this.setState(this._getState())}),this._getPrimaryElement=(()=>{const e=this.state.triggeredByBuild,t=this._navigationService.getLinkingService().getBuildUrl(e.id);return r.createElement(X.FPSLinkComponent,Object.assign({href:t,telemetrySource:c},{"aria-describedby":"build-comptrigger-desc"}),e.buildNumber)}),this._navigationService=this.props.pageContext.getService("IBuildNavigationService"),this.state=this._getState()}render(){const e=this.state.triggeredByBuild,t=e&&e.requestedFor?e.requestedFor.displayName:"",s=e&&e.requestedFor?e.requestedFor.id:"";return r.createElement("div",{className:"b-completion-timeline-area timeline-padding-adjustment ci-hover-behavior"},r.createElement(a,{text:Ie.BuildCompletionTriggerTitle}),e&&r.createElement("span",null,r.createElement("span",{className:"br-muted"},r.createElement(X.FPSLinkComponent,{href:this.state.definitionLink,telemetrySource:c},e.definition.name)),r.createElement(k,{id:s,pageContext:this.props.pageContext,context:"BuildCompletionTrigger",className:"b-completion-trigger-details",personaProps:{id:s,imageUrl:J.getAvatarUrl(e.requestedFor),displayName:t},getPrimaryElement:this._getPrimaryElement},r.createElement(i,{name:t,time:e.queueTime,id:"build-comptrigger-desc"}))))}componentDidMount(){this.props.hubStore.addTriggeredByBuildListener(this._onTriggeredByBuild)}componentWillUnmount(){this.props.hubStore.removeTriggeredByBuildListener(this._onTriggeredByBuild)}_getState(){const e=this.props.hubStore.getTriggeredByBuild();let t="";return e&&(t=this._navigationService.getLinkingService().getDefinitionEditUrl(e.definition.id)),{triggeredByBuild:e,definitionLink:t}}}class R extends r.Component{constructor(e){super(e),this._onHeaderTextClick=(e=>{e.metaKey||e.ctrlKey||(e.preventDefault(),this.props.hubActionCreator.selectView(we.ViewKeys.Logs))}),this._updateState=(()=>{const e=this.props.tabStore.getIssues();this.setState({errors:e.errors,warnings:e.warnings})}),this._onErrorsClick=(e=>{I(e,this.state.errors[0].link,this.props.hubActionCreator)}),this._onWarningsClick=(e=>{I(e,this.state.warnings[0].link,this.props.hubActionCreator)});const t=e.tabStore.getIssues();this.state={errors:t.errors,errorCount:t.errorCount,warnings:t.warnings,warningCount:t.warningCount}}render(){const e=this.state.errorCount,t=this.state.warningCount,s=e+t;this.props.build;let i=r.createElement("span",null,e," ",r.createElement("span",{className:"text b-lowercase errors-text"},Ie.Errors));const a=e>0&&this.state.errors[0].link;e>0&&a&&(i=r.createElement($.Link,{href:a,onClick:this._onErrorsClick},i));let o=r.createElement("span",null,t," ",r.createElement("span",{className:"text b-lowercase warnings-text"},Ie.Warnings));const d=t>0&&this.state.warnings[0].link;return t>0&&d&&(o=r.createElement($.Link,{href:d,onClick:this._onWarningsClick},o)),r.createElement("div",{className:"b-details-timeline-area flex flex-column"},r.createElement("div",{className:"details-timeline-area-top flex flex-row"},r.createElement(Q.DetailsSection,{className:"details-timeline-left b-details-timeline",sectionKey:"build-timeline",chevronProps:{hide:0==s,ariaLabel:Ie.AriaBuildTimelineChevron},isExpandedByDefault:s>0},r.createElement(Q.DetailsSectionHeader,{renderAsHeading:!0},r.createElement($.Link,Object.assign({className:"text",href:this.props.linkingService.getBuildUrl(this.props.build.id,we.ViewKeys.Logs),onClick:this._onHeaderTextClick,tooltipProps:{id:"build-view-logs-tp",showOnFocus:!0,text:Ie.ViewLogs}},{"aria-describedby":"build-viewlogs-tp"}),r.createElement("span",null,n.format(Ie.BuildTimelinePrimaryText,this.props.indicatorData.text.toLocaleLowerCase())))),r.createElement(Q.DetailsSectionSecondaryHeader,null,r.createElement("span",null,r.createElement("span",{className:"text-area errors-text-area"},i),r.createElement("span",null," / "),r.createElement("span",{className:N.css("text-area","warnings-text-area",t>0&&"has-warnings")},o))),r.createElement(Q.DetailsSectionContent,null,r.createElement("div",{className:"b-timeline-details-content"},r.createElement("ul",{className:"issues-list","aria-label":Ie.AriaIssuesList},this.state.errors.concat(this.state.warnings).map((e,t)=>r.createElement(T,{issue:e,key:t,repositoryType:this.props.build.repository.type,sourceProvider:this.props.sourceProvider,hubActionCreator:this.props.hubActionCreator,issueNumber:t+1}))))))))}componentDidMount(){this.props.hubStore.addBuildChangedListener(this._updateState),this.props.tabStore.addErrorLinksListener(this._updateState),this.props.tabStore.addStoreUpdatedListener(this._updateState),this.props.tabStore.addWarningLinksListener(this._updateState)}componentWillUnmount(){this.props.hubStore.removeBuildChangedListener(this._updateState),this.props.tabStore.removeErrorLinksListener(this._updateState),this.props.tabStore.removeStoreUpdatedListener(this._updateState),this.props.tabStore.removeWarningLinksListener(this._updateState)}}class f extends r.Component{constructor(e){super(e),this._resizeUpdatePending=!1,this._onExpand=(()=>{this.setState({expandContent:!0,isOverflow:!1})}),this._update=(()=>{this._resizeUpdatePending=!0,this.forceUpdate()}),this.timerManagement=new M.TimerManagement,this._update=this.timerManagement.debounce(this._update,600),this.state={isOverflow:!1,expandContent:!1}}render(){return r.createElement("span",{className:"b-result-truncate-lines flex-row"},r.createElement("span",{ref:e=>this._element=e,className:N.css("result-truncate-lines-content",this.state.expandContent&&"expanded")},this.props.children),r.createElement("span",null,this.state.isOverflow?r.createElement(G.Button,{subtle:!0,className:"truncate-expand-button",iconProps:{iconName:"ChevronDown"},onClick:this._onExpand,ariaLabel:this.props.expandButtonTooltip,tooltipProps:{showOnFocus:!0,text:this.props.expandButtonTooltip}}):null))}componentDidMount(){window.addEventListener("resize",this._update),this._checkOverflow()}componentDidUpdate(){this._resizeUpdatePending&&(this._resizeUpdatePending=!1,this._checkOverflow())}_checkOverflow(){if(this._element){const e=this._element.scrollHeight-this._element.clientHeight>10;this.state.isOverflow!==e&&this.setState({isOverflow:e})}}componentWillUnmount(){window.removeEventListener("resize",this._update),this.timerManagement.dispose()}}class T extends r.Component{constructor(){super(...arguments),this._onLogsLinkClick=(e=>{I(e,this.props.issue.link,this.props.hubActionCreator)})}render(){let e=null;return e=1===this.props.issue.type?r.createElement(Z.Icon,{className:"issue-icon ci-error-icon",iconName:"Cancel"}):r.createElement(Z.Icon,{className:"issue-icon ci-warning-icon",iconName:"Warning"}),this.props.issue.message?r.createElement("li",{className:"issue-list-item flex-row ci-hover-behavior"},e,this.props.issue.link&&r.createElement("div",{className:"issue-content-holder"},r.createElement(f,{expandButtonTooltip:n.format(Ie.IssueListExpandMessage,this.props.issueNumber)},r.createElement($.Link,Object.assign({href:this.props.issue.link,className:"issue-content"},this.props.issue.isLogsLink?{onClick:this._onLogsLinkClick}:{}),this.props.issue.message))),!this.props.issue.link&&r.createElement("div",{className:"issue-content-holder"},r.createElement(f,{expandButtonTooltip:n.format(Ie.IssueListExpandMessage,this.props.issueNumber)},r.createElement("span",{className:"issue-content"},this.props.issue.message)))):null}}function I(e,t,s){if(!e.metaKey&&!e.ctrlKey){e.preventDefault();const i=new se.Uri(t);let a={};(i.queryParameters||[]).forEach(e=>{a[e.name]=e.value||""}),s.selectView(we.ViewKeys.Logs,a,!0)}}class A extends r.PureComponent{constructor(){super(...arguments),this._getPrimaryElement=(e=>r.createElement("span",null,r.createElement(y,{change:e,repositoryName:this.props.repositoryName,sourceProvider:this.props.sourceProvider,textToDisplay:e.message,hubStore:this.props.hubStore,ariaDescribedBy:"build-commit-desc"})))}render(){const e="build-changes-timeline",t=this.props.changes;let s=this.props.changes.slice();const i=s.splice(0,u),o=s;return r.createElement("div",{className:"changes-timeline-area timeline-padding-adjustment"},r.createElement(a,{text:Ie.AssociatedChanges}),r.createElement("span",{className:"br-muted"},n.format(Ie.CommitsFormat,t.length)),r.createElement("ul",{className:"changes-timeline",id:e,"aria-label":Ie.AriaChangesList},i.map(t=>this._getChangeElement(t,e)),o.length>0&&r.createElement(B,{ariaLabel:Ie.AriaShowAllChanges},o.map(t=>this._getChangeElement(t,e))),0==t.length&&r.createElement("li",null,r.createElement("span",{className:"no-changes-text"},Ie.NoChangesFound))))}_getChangeElement(e,t){const i=e.author;let a="",o="";i&&(a=J.getAvatarUrl(i),(o=i.id)||(o=i.uniqueName)),!a&&i&&(a=te.getIdentityImageUrl(this.props.pageContext,i));let l=e.id,u=d;this.props.sourceProvider&&(l=this.props.sourceProvider.getCommitText(e.id),u=this.props.sourceProvider.getCommitIconName());const c=i?i.displayName:"";return r.createElement("li",{key:e.id,className:"commit-details-row","aria-describedby":t},r.createElement(k,{id:e.id,context:"CommitChanges",personaProps:{id:o,imageUrl:a,displayName:c},pageContext:this.props.pageContext,getPrimaryElement:this._getPrimaryElement,className:"ci-hover-behavior",authorClassName:"commit-author-col",data:e,authorInformationClassName:"commit-information-col"},r.createElement("span",{id:"build-commit-desc"},r.createElement("span",null,n.format(Ie.AuthoredFormat,c)," "),r.createElement(s,{iconName:u,displayText:l}),r.createElement("span",null," "),e.timestamp&&r.createElement(ye.InlineAgoElement,{date:e.timestamp}))))}}class k extends r.PureComponent{render(){const e=this.props.sizeClassName?this.props.sizeClassName:"medium";let t=this.props.personaProps.imageUrl;return!t&&this.props.personaProps.id&&(t=te.getIdentityImageUrl(this.props.pageContext,this.props.personaProps.id)),r.createElement("div",{className:N.css("persona-information",this.props.className,!this.props.noHoverBehaviorStyle&&"ci-hover-behavior")},r.createElement("div",{className:N.css("details-column",this.props.authorClassName)},r.createElement("span",null,r.createElement(K.BuildPersona,{size:e,displayName:this.props.personaProps.displayName,imageUrl:t}))),r.createElement("div",{className:N.css("details-column information-column",this.props.authorInformationClassName)},r.createElement("div",{className:"primary"},r.createElement("div",{className:"message"},this.props.getPrimaryElement(this.props.data)),r.createElement("span",null)),r.createElement("div",{className:"secondary"},this.props.children)))}}class y extends r.PureComponent{constructor(e){super(e),this._updateState=(()=>{const e=this.props.hubStore.getCommitLinkData(this.props.change.id);e&&this.setState({commitLink:e.commitLink})});const t=this.props.hubStore.getCommitLinkData(this.props.change.id);this.state={commitLink:t?t.commitLink:""}}render(){let e=this.props.textToDisplay;return!e&&this.props.sourceProvider&&(e=this.props.sourceProvider.getCommitText(this.props.change.id)),this.state.commitLink?r.createElement("span",null,r.createElement(X.FPSLinkComponent,Object.assign({href:this.state.commitLink,telemetrySource:c},{"aria-describedby":this.props.ariaDescribedBy}),e)," "):r.createElement("span",null,e," ")}componentDidMount(){this.props.hubStore.addCommitLinksUpdatedListener(this._updateState)}componentWillUnmount(){this.props.hubStore.removeCommitLinksUpdatedListener(this._updateState)}}class w extends r.Component{constructor(e){super(e),this._getPrimaryElement=(e=>r.createElement("div",{className:"workitem-header-text"},r.createElement(X.FPSLinkComponent,Object.assign({href:e.url,telemetrySource:c},{"aria-describedby":"build-wit-desc"}),e.name))),this._updateWorkitems=(()=>{this.setState({workItems:this.props.hubStore.getWorkItems()})}),this.state={workItems:this.props.hubStore.getWorkItems()}}componentDidMount(){this.props.hubStore.addWorkitemsUpdatedListener(this._updateWorkitems)}componentWillUnmount(){this.props.hubStore.removeWorkitemsUpdatedListener(this._updateWorkitems)}render(){if(this.state.workItems.length>0){let e=this.state.workItems.slice();const t=e.splice(0,u),s=e;return r.createElement(Qe.CardSection,null,r.createElement("div",{className:"b-wit-section build-result-section"},r.createElement("h3",{className:"b-result-section-heading"},Ie.WorkItemsSectionHeader),r.createElement("div",{className:"build-wit-content"},r.createElement("ul",{"aria-label":Ie.AriaWorkItemsList},t.map(e=>this._getWorkItemElement(e)),s.length>0&&r.createElement(B,{ariaLabel:Ie.AriaShowAllWorkItems},s.length>0&&s.map(e=>this._getWorkItemElement(e)))))))}return null}_getWorkItemElement(e){const t=e.assignedTo?e.assignedTo.displayName:Ie.None,s=e.assignedTo?J.getAvatarUrl(e.assignedTo):"",i=e.assignedTo?e.assignedTo.id:"";return r.createElement("li",{key:e.id},r.createElement(k,{id:e.assignedTo&&e.assignedTo.id||e.id,context:"WorkItems",pageContext:this.props.pageContext,personaProps:{id:i,imageUrl:s,displayName:t},getPrimaryElement:this._getPrimaryElement,data:e,className:"build-witsection-item ci-hover-behavior"},r.createElement("div",{className:"wit-footer-text",id:"build-wit-desc"},r.createElement("span",null,e.type," ",e.id),r.createElement("span",{"aria-hidden":!0,className:"b-dot-separator"}),r.createElement("span",null,Ie.AssignedTo),r.createElement("span",null," "),r.createElement("span",null,t))))}}class B extends r.Component{constructor(e){super(e),this._expandView=(()=>{this.setState({expandView:!0})}),this.state={expandView:!1}}render(){return this.state.expandView?this.props.children:r.createElement("li",null,r.createElement(G.Button,{iconProps:{iconName:"ChevronDown"},onClick:this._expandView,ariaLabel:this.props.ariaLabel},Ie.ShowAll))}}class E extends r.Component{constructor(){super(...arguments),this._onApprovalClicked=(()=>{if(this.props.approvals&&this.props.approvals.length>0){const e=this.props.pageContext.getRestClient(W.ApprovalClientName),t=[];this.props.approvals.forEach(e=>{2===e.status&&e.steps.forEach(s=>{2===s.status&&t.push({approvalId:e.id,status:4,comment:"approved via UI"})})}),t.length>0&&e.updateApprovals(t,this.props.projectId)}})}render(){const e=this.props.approvals[0],t=this.props.approvals.filter(t=>t.stageName===e.stageName),s=1===t.length?n.format(Ie.PendingChecks_Single,e.stageName):n.format(Ie.PendingChecks_Multiple,e.stageName,t.length);return r.createElement("div",{className:"flex-row"},r.createElement("div",{className:"flex-cell flex-grow"},r.createElement(Z.Icon,{iconName:"Info",className:"icon-margin checks-card-icon"})," ",s),r.createElement("div",{className:"flex-cell"},r.createElement(G.Button,{onClick:this._onApprovalClicked},"Approve")))}}class P extends r.Component{constructor(e){super(e),this._authorizeResources=(()=>{this.setState({authorizingResources:!0}),this._pipelineResourcesService.autoAuthorizeResources(this.props.definitionId,this.props.sourceBranch).then(()=>{this._addToast(Ie.AuthorizeResourcesSuccessMessage),this.setState({resourcesAuthorized:!0})},e=>{console.warn("Error while auto-authorizing resources: "+e&&e.message),this._addToast(Ie.AuthorizeResourcesErrorMessage),this.setState({authorizingResources:!1})})}),this._pipelineResourcesService=this.props.pageContext.getService("IPipelineResourcesService"),this._messageService=this.props.pageContext.getService("IGlobalMessagesService"),this.state={authorizingResources:!1,resourcesAuthorized:!1}}render(){const e=[{primary:!0,text:this.state.resourcesAuthorized?Ie.AuthorizedResourcesButtonText:Ie.AuthorizeResourcesButtonText,onClick:this._authorizeResources,disabled:this.state.authorizingResources||this.state.resourcesAuthorized}];return r.createElement(Y.MessageCard,{className:"flex-grow actionable-error-card",severity:"Error",buttonProps:e},this.props.resourceAuthErrorMessages)}_addToast(e){this._messageService.addToast({message:e,duration:5e3,forceOverrideExisting:!0})}}}(),function(e){t.View={},Object.defineProperty(t,"__esModule",{value:!0});const i="br-cancel",a="br-download-logs",o="br-artifacts",l="br-edit",u="br-queue",h="br-queue-with-diag",p="br-q-var",m="br-retain",g="br-rebuild",S="br-retry",v="br-tag",C="br-sep",R=0,f=1;var T;!function(e){e.Container="Container".toLowerCase(),e.FilePath="FilePath".toLowerCase()}(T||(T={}));const I=()=>r.createElement(j.Spinner,{size:"large",className:"b-result-loading-area"}),A="fpsLoading",y="build-result-header",w="refs/heads/",B=()=>r.createElement("span",{"aria-hidden":!0,className:"b-space-separator"}),E=new s.Action;class P extends Se.VssHubViewState{constructor(e,t){super(e,t),this.fpsLoading=!1}getUpdateBehavior(e){let t=super.getUpdateBehavior(e);return this.fpsLoading&&e.eventName===Ce.HubViewStateEventNames.pivotChanging&&(t=1),t}}class D extends L.VssComponent{constructor(e,t){super(e,t),this._projectInfo={},this._hostInfo={},this._extensionBuildCallBacks={},this._providerCallBacks={},this._extensionInitializedBuild={},this._ttiMarked=!1,this._signalRConnectedTimes=0,this._viewUrls={},this._getActionExtensionContext=((e,t)=>Object.assign({},t?{onBuildChanged:this._onProviderBuildContextChanged.bind(null,e.key)}:{onBuildChanged:this._onExtensionBuildContextChanged.bind(null,e.key)},{getLiveContext:this._getLiveContext})),this._getHeader=(()=>r.createElement(x,{hubStore:this._store,projectId:this._projectInfo.id,pageContext:this.context.pageContext,permissions:this.state.permissions,linkingService:this._navigationService.getLinkingService()})),this._getCompletedActionExtensionContext=(e=>this.state.currentData.build),this._getDefaultProps=(()=>{const e=this.state.currentData.build;return Object.assign({},this._navigationService.getCurrentState(),e?Object.assign({buildId:e.id},e._links):{})}),this._getLegacyExtensionContext=((e,t)=>Object.assign({onViewDisplayed:()=>{},selectTab:()=>{},setSectionVisibility:()=>{}},t?{onBuildChanged:this._onProviderBuildContextChanged.bind(null,e)}:{onBuildChanged:this._onExtensionBuildContextChanged.bind(null,e)},{getLiveContext:this._getLiveContext,onExtensionRenderComplete:this._onExtensionRenderComplete})),this._mutateCommand=(e=>{const t=this.state.currentData.build;if(t&&"ms.vss-releaseManagement-web.create-release-action"===e.id)switch(e.isPrimary=!1,t.result){case 2:e.important=!0;break;default:e.disabled=!0,e.important=!1,e.iconProps=void 0}return e}),this._getLiveContext=(()=>this._liveContextStore),this._onExtensionRenderComplete=((e,t)=>{this._performanceService&&this._performanceService.endScenario(e,t,!1)}),this._getPivotBarItem=(e=>{const t=e.id||e.itemKey||"";return t&&!e.url&&(this._viewUrls[t]||(this._viewUrls[t]=this._hubViewState.createObservableUrl({view:t})),e.url=this._viewUrls[t]),{id:e.itemKey||e.id,name:e.text,render:e.render,order:e.order,url:e.url,onBeforeTabChange:e.onBeforePivotChange}}),this._getMutatedPivotItem=((e,t)=>{let s=!1;const i=e.pivotContribution,a=this._store.getTaskIdsInUse()||[];return i&&i.supportsTasks&&(s=Be.isContributionHidden(i.supportsTasks,a)),s?null:t}),this._getRoutes=(e=>{let t={};return t[we.ContributionKeys.BuildId]=e+"",t[we.ContributionKeys.View]=this._getCurrentView(),t}),this._onBuildChanged=(()=>{let e=this._store.getBuild();e&&(setTimeout(()=>{const t=e;this._signalRHub.listen(t.id,t.buildNumber)},0),this._updateExtensions(e))}),this._onFetchData=(()=>{this.state.currentData.build&&this._store.fetchData(!0,this._getRoutes(this.state.currentData.build.id))}),this._onFpsLoading=(e=>{this._hubViewState.fpsLoading=!0,this._perfMarker.reset(),this.setState({selectedView:"",fpsLoading:!0})}),this._onExtensionBuildContextChanged=((e,t)=>{this._extensionBuildCallBacks[e]=t,this._callextensionCallback(e,this.state.currentData.build)}),this._onProviderBuildContextChanged=((e,t)=>{this._providerCallBacks[e]=t,this.state.currentData.build&&this._providerCallBacks[e](this.state.currentData.build)}),this._onTabViewChanged=(e=>{this._hubViewState.selectedPivot.value=e}),this._onTabChanged=(e=>{this.state.selectedView!==e&&(this._startPerfScenarioForContribution(e),this._onPivotDataChanged({view:e}),this._perfMarker.startTabSwitch(e))}),this._onPivotDataChanged=(e=>{if(this.state.fpsLoading)return;const t=e.view,s=e.routes;-1==(Object.keys(this._extensionBuildCallBacks)||[]).indexOf(t)&&this._clearContributedCallbacks();let i=this._navigationService.getCurrentState(),a=!0;if(i){const o=i[le.RouteParameters.View];o||t!==we.ViewKeys.Logs||(a=!1),o!==t&&(delete i[we.NavigationKeys.JobId],delete i[we.NavigationKeys.lineStart],delete i[we.NavigationKeys.lineEnd],delete i[we.NavigationKeys.colStart],delete i[we.NavigationKeys.colEnd],delete i[we.NavigationKeys.TaskId]),s&&Object.keys(s).forEach(e=>{i[e]=s[e]}),e.pushState?this._navigationService.getHistoryService().pushState(i):this._navigationService.getHistoryService().replaceState(i)}t!==this._hubViewState.selectedPivot.value&&(this._hubViewState.selectedPivot.value=t),this.setState({selectedView:t,isTabSwitchNavigation:a})}),this._onNavigationChanged=(e=>{if(e.newState&&e.oldState){const t=e.oldState.state[le.RouteParameters.BuildId],s=e.newState.state[le.RouteParameters.BuildId],i=parseInt(s);t===s||isNaN(i)||(this.setState({currentData:D.s_emptyData}),this._clearContributedCallbacks(),this._fetchBuild(i))}}),this._onArtifactAdded=((e,t)=>{this._artifactsStore.addArtifact(e,t)}),this._onStoreUpdated=(()=>{const e=this._store.getData();e.build&&this._updateExtensions(e.build),this.setState({currentData:e,permissions:this._store.getPermissions()})}),this._onUsedTasksUpdated=(()=>{this.setState({pivotProviders:this._getPivotProviders()})}),this._onBuildUpdatedFromSignalR=(e=>{this._store.fetchData(!0,e.routes)}),this._onTimelineUpdatedFromSignalR=(()=>{const e=this.state.currentData.build;e&&32===e.status&&(console.info("Timeline records are pumping data, but build status is not updated yet! fetch!"),this._onFetchData())}),this._onQueueBuildSuccess=(e=>{const t=this._navigationService.getCurrentState()[we.ContributionKeys.View];this.setState({selectedView:t||we.ViewKeys.Logs,currentData:D.s_emptyData});let s={};s[le.RouteParameters.BuildId]=e.id+"",this._navigationService.pushState(s),this._fetchBuild(e.id,void 0)}),this._isSignalRReconnecting=(()=>{this._setSignalRGlobalMessage(Ie.SignalRReconnecting,f)}),this._isSignalRReconnected=(()=>{this._globalMessageService.closeBanner(),this.state.currentData.build&&2!==this.state.currentData.build.status&&this._onFetchData()}),this._isSignalRDisconnected=(()=>{this._setSignalRGlobalMessage(Ie.SignalRDisconnected,f)}),this._isSignalRConnected=(()=>{this._signalRConnectedTimes>0&&this._setSignalRGlobalMessage(Ie.SignalRConnected),this._signalRConnectedTimes++}),this._isSignalRSlow=(()=>{this._setSignalRGlobalMessage(Ie.SignalRSlow)}),this._isSignalRUserInactive=(()=>{this._setSignalRGlobalMessage(Ie.SignalRUserInactive,f),this._signalRHub.stop(!0)}),this._legacyPivotItemProviderOptions={pageContext:t.pageContext,tabGroupIds:["ms.vss-build-web.build-results-view"],tabType:"ms.vss-build-web.build-results-tab",getContext:this._getLegacyExtensionContext,loadingComponent:I,getMutatedPivotBarItem:this._getMutatedPivotItem},this._actionHub=e&&e.actionHub||new Le.BuildResultActionHub,this._contributionActionHub=e&&e.contributionActionHub||new b.ContributionDataActionHub,this._navigationActionHub=e&&e.navigationActionHub||new ne.NavigationActionHub,this._buildResultSignalRActionHub=new Ae.BuildResultSignalRActionHub,this._buildResultSignalRActionCreator=new Ae.BuildResultSignalRActionCreator({actionHub:this._buildResultSignalRActionHub});const s=t.pageContext.getService("ITfsPageService").getData();s&&s.project&&(this._projectInfo.id=s.project.id,this._projectInfo.name=s.project.name),this._artifactsStore=e.artifactsStore||new ie.ArtifactsStore({pageContext:t.pageContext,projectId:this._projectInfo.id}),this._actionCreator=new Le.BuildResultActionCreator({pageContext:t.pageContext,actionHub:this._actionHub,callbacks:{fetchData:this._onFetchData}}),this._initializeServices();const i=t.pageContext.getService("IVssPageService").getData();i&&(this._hostInfo.hostId=i.hostId,this._hostInfo.isHosted=i.isHosted,this._hostInfo.hostPath=i.hostPath,this._hostInfo.userId=i.user.id),this._liveContextStore=e.liveContextStore||new Ne.LiveContextStore({actionHub:this._buildResultSignalRActionHub}),this._perfMarker=new Ee.Marker(t.pageContext,this._getDefaultProps),this._store=new Ue.BuildResultViewStore({pageContext:t.pageContext,projectId:this._projectInfo.id,projectName:this._projectInfo.name,userId:this._hostInfo.userId,contributionActionHub:this._contributionActionHub,artifactsStore:this._artifactsStore,marker:this._perfMarker});const a=this._getCurrentView();this._hubViewState=new P(t.pageContext,{defaultPivot:a}),this.state={currentData:this._store.getData(),permissions:this._store.getPermissions(),selectedView:a,fpsLoading:!1,cancelClicked:!1,isTabSwitchNavigation:!1,pivotProviders:this._getPivotProviders()},this._hubViewState.selectedPivot.subscribe(this._onTabChanged),this._viewUrls[we.ViewKeys.Logs]=this._hubViewState.createObservableUrl({view:we.ViewKeys.Logs}),this._viewUrls[we.ViewKeys.Results]=this._hubViewState.createObservableUrl({view:we.ViewKeys.Results})}render(){this._perfMarker.firstRender();const e=this.state.currentData.build;if(this.state.fpsLoading||this.state.currentData.isLoading)return r.createElement(I,null);if(e){const t=e&&2===e.status&&!this.state.currentData.timeline,s=this._hubViewState.selectedPivot;return r.createElement("div",{className:"flex-column flex-grow scroll-hidden"},e&&e.definition&&1===e.definition.queueStatus&&r.createElement(ue.MessageBar,{severity:"Info"},n.format(Ie.BuildDefinitionPausedMessage,e.definition.name)),r.createElement(_e.Page,{className:"b-results-view flex flex-column flex-grow",selectedTabId:s,tabProviders:this.state.pivotProviders},r.createElement(be.Header,{className:"b-header",title:this._getHeader(),commandBarItems:this._getHubCommands(),commandBarClassName:"b-header-commandbar",titleClassName:"text-ellipsis"}),r.createElement(Re.TabBar,{className:"b-tab-bar",onSelectedTabChanged:this._onTabViewChanged},!t&&r.createElement(Re.Tab,{id:we.ViewKeys.Logs,name:Ie.LogsTabName}),r.createElement(Re.Tab,{id:we.ViewKeys.Results,name:Ie.ResultsTabName})),r.createElement(Re.TabContent,null,s.value==we.ViewKeys.Logs&&r.createElement(We.LogsTab,{currentContext:{hostId:this._hostInfo.hostId,hostPath:this._hostInfo.hostPath,isHosted:this._hostInfo.isHosted,projectId:this._projectInfo.id},pageContext:this.context.pageContext,hubStore:this._store,hubContributionActionHub:this._contributionActionHub,hubActionHub:this._actionHub,hubActionCreator:this._actionCreator,signalRActionHub:this._buildResultSignalRActionHub,isTabSwitchNavigation:this.state.isTabSwitchNavigation,permissions:this.state.permissions,perfMarker:this._perfMarker,navigationService:this._navigationService,artifactsStore:this._artifactsStore}),s.value==we.ViewKeys.Results&&r.createElement(Ye.ResultsTab,{currentContext:{hostId:this._hostInfo.hostId,hostPath:this._hostInfo.hostPath,isHosted:this._hostInfo.isHosted,projectId:this._projectInfo.id},pageContext:this.context.pageContext,hubStore:this._store,hubContributionActionHub:this._contributionActionHub,hubActionHub:this._actionHub,hubActionCreator:this._actionCreator,signalRActionHub:this._buildResultSignalRActionHub,isTabSwitchNavigation:this.state.isTabSwitchNavigation,permissions:this.state.permissions,perfMarker:this._perfMarker,navigationService:this._navigationService,artifactsStore:this._artifactsStore}))))}return r.createElement(ue.MessageBar,{severity:"Error",className:"b-not-found-mb"},Ie.BuildNotFound)}componentDidMount(){super.componentDidMount(),this._store.addBuildUpdatedListener(this._onStoreUpdated),this._store.addPermsUpdatedListener(this._onStoreUpdated),this._store.addBuildChangedListener(this._onBuildChanged),this._store.addBuildChangedListener(this._onStoreUpdated),this._store.addUsedTasksUpdatedListener(this._onUsedTasksUpdated),this._liveContextStore.addArtifactAddedListener(this._onArtifactAdded),this._store.fetchData(void 0,void 0,!0),this._navigationActionHub.navigationChanged.addListener(this._onNavigationChanged),this._navigationService=this.context.pageContext.getService("IBuildNavigationService"),this._navigationService.subscribeToNavigationChanges(this._navigationActionHub),this._buildResultSignalRActionHub.buildUpdated.addListener(this._onBuildUpdatedFromSignalR),this._buildResultSignalRActionHub.timelineRecordsUpdated.addListener(this._onTimelineUpdatedFromSignalR),this._buildResultSignalRActionHub.isReconnecting.addListener(this._isSignalRReconnecting),this._buildResultSignalRActionHub.isReconnected.addListener(this._isSignalRReconnected),this._buildResultSignalRActionHub.isConnected.addListener(this._isSignalRConnected),this._buildResultSignalRActionHub.isDisconnected.addListener(this._isSignalRDisconnected),this._buildResultSignalRActionHub.isSlow.addListener(this._isSignalRSlow),this._buildResultSignalRActionHub.isUserInactive.addListener(this._isSignalRUserInactive),this._signalRHub=this.props.signalRHub||new De.BuildResultSignalRHub({actionCreator:this._buildResultSignalRActionCreator,hostInformation:{hostId:this._hostInfo.hostId,isHosted:this._hostInfo.isHosted,hostPath:this._hostInfo.hostPath,projectId:this._projectInfo.id},projectId:this._projectInfo.id,getRoutes:this._getRoutes,pageContext:this.context.pageContext}),this._actionHub.selectView.addListener(this._onPivotDataChanged),document.body.addEventListener(A,this._onFpsLoading),_.registerErrorHandler(e=>{e&&this._globalMessageService.addBanner({message:e.message,level:2})})}componentDidUpdate(e,t){super.componentDidUpdate(e,t);const s=this.state.currentData.build;if(s&&(this.state.currentData.timeline||this.state.selectedView!=we.ViewKeys.Logs||this._onTabViewChanged(we.ViewKeys.Results),!this._ttiMarked)){this._ttiMarked=!0,this.context.pageContext.getService("IVssTelemetryService").publishEvent(Ee.PerformanceConstants.Area,"BuildResult_PageLoad",this._getDefaultProps())}if(s&&t&&!this.state.fpsLoading&&t.selectedView!=this.state.selectedView){const e=this._navigationService.getCurrentState(),t=parseInt(e&&e[we.ContributionKeys.BuildId]);this._fetchBuild(t,!0)}}componentWillUnmount(){super.componentWillUnmount(),this._hubViewState.selectedPivot.unsubscribe(this._onTabChanged),this._hubViewState.dispose(),this._store.removeBuildUpdatedListener(this._onStoreUpdated),this._store.removePermsUpdatedListener(this._onStoreUpdated),this._store.removeBuildChangedListener(this._onBuildChanged),this._store.removeBuildChangedListener(this._onStoreUpdated),this._store.removeUsedTasksUpdatedListener(this._onUsedTasksUpdated),this._store.dispose(),this._liveContextStore.removeArtifactAddedListener(this._onArtifactAdded),this._buildResultSignalRActionHub.buildUpdated.removeListener(this._onBuildUpdatedFromSignalR),this._buildResultSignalRActionHub.timelineRecordsUpdated.removeListener(this._onTimelineUpdatedFromSignalR),this._buildResultSignalRActionHub.isReconnecting.removeListener(this._isSignalRReconnecting),this._buildResultSignalRActionHub.isReconnected.removeListener(this._isSignalRReconnected),this._buildResultSignalRActionHub.isConnected.removeListener(this._isSignalRConnected),this._buildResultSignalRActionHub.isDisconnected.removeListener(this._isSignalRDisconnected),this._buildResultSignalRActionHub.isSlow.removeListener(this._isSignalRSlow),this._buildResultSignalRActionHub.isUserInactive.removeListener(this._isSignalRUserInactive),this._signalRHub.dispose(),this._actionHub.selectView.removeListener(this._onPivotDataChanged),k.getSingletonManager().remove(We.c_singletonPoolSignalRActionHubKey),document.body.removeEventListener(A,this._onFpsLoading),_.registerErrorHandler(e=>{}),Object.keys(this._viewUrls).forEach(e=>{this._viewUrls[e].dispose()}),de.clearTreeStateOnUnmount(this.context.pageContext)}_callextensionCallback(e,t){if(t&&this._extensionBuildCallBacks[e]){const s=this._extensionInitializedBuild[e],i=!s||s.id!==t.id,a=!s||s.status!==t.status;(i||a)&&(this._extensionBuildCallBacks[e](t),this._extensionInitializedBuild[e]=t)}}_clearContributedCallbacks(){this._extensionBuildCallBacks={},this._extensionInitializedBuild={}}_getCurrentView(){let e=this.state?this.state.selectedView:"";if(!e){e=this._navigationService.getCurrentState()[we.ContributionKeys.View]}return e=e||we.ViewKeys.Logs}_getHubCommands(){let e=[];const t=this.state.permissions;let s=!1,d=void 0,b=void 0,_=void 0,R=void 0,f=void 0,I=void 0,L=void 0,A=void 0,k=void 0,y=void 0;const B=this.state.currentData.build;if(B){const e=this.state.currentData.definition,v=me.isFeatureFlagEnabled(this.context.pageContext,"Build2.Retry"),C=e&&e.process&&e.process.type===we.ProcessType.Yaml;let E="";if(C){if(n.startsWith(B.sourceBranch,w))E=B.sourceBranch;else{const e=this._store.getPRData();e&&n.startsWith(e.rawSourceBranch,w)&&(E=e.rawSourceBranch)}E=E&&E.substring(w.length)}const P=this._navigationService.getLinkingService(),D=C&&E?P.getYamlPipelineEditUrl(e.id,E):P.getDefinitionEditUrl(B.definition.id),x=this._artifactsStore.getArtifactProviders(),U=this._artifactsStore.canExploreArtifacts();if(x.length>0){let e=[];x.forEach(t=>{const s=t.getArtifact();let i={id:s.id+"",text:s.name,iconProps:{iconName:t.getDisplayOptions().iconName}};U&&t.supportsExploring()?(i.onActivate=(()=>t.onExplore()),e.push(i)):t.supportsDownload()&&(i.onActivate=(()=>t.onDownload()),e.push(i))}),e.length>0&&(d={id:o,text:Ie.Artifacts,iconProps:{iconName:"ZipFolder"},subMenuProps:{id:"artifacts-menu",items:e}})}const N=t.canEditDefinition,H=!t.isAnonymousUser;(N||H)&&(b={id:l,text:N?Ie.EditDefinition:Ie.ViewDefinition,iconProps:{iconName:N?"Edit":"EntryView"},href:D,onActivate:(e,t)=>c.onClickFPS(this.context.pageContext,D,!0,t,{telemetrySource:"build-result-commands"})});const q=B.status;if(2===q){s=!0;const e=B.logs&&B.logs.type.toLowerCase()===T.Container;B.logs&&(k={id:a,text:e?Ie.DownloadAllLogs:Ie.CopyLogsLocation,iconProps:{iconName:e?"Download":"Copy"},onActivate:()=>{if(e)ne.openLinkSecurely(B.logs.url+"?$format=zip");else if(document.queryCommandSupported("copy")){const e=document.createElement("textarea");e.value=B.logs.url,document.body.appendChild(e),e.focus(),e.select(),document.execCommand("copy"),document.body.removeChild(e)}else console.error("Browser doesn't allow to copy URL "+B.logs.url)}})}if(t.canQueueBuild){const e={iconName:"BuildQueueNew"},t=this.state.currentData.definition,s={definition:B.definition,repository:B.repository,pageContext:this.context.pageContext,project:this._projectInfo.id,source:"buildresult",onSuccess:this._onQueueBuildSuccess,variables:t?t.variables:{},processType:t?t.process.type:null,queue:B.queue,defaultSourceBranch:B.repository.type.toLowerCase()===Te.RepositoryTypes.TfsVersionControl?"":B.sourceBranch};_={id:u,text:Ie.QueueBuild,iconProps:e,onActivate:()=>{this.context.pageContext.getService("IVssLayoutManager").renderCallout(e=>r.createElement(oe.CommandComponent,Object.assign({commandType:"ciQueueBuildComponent",onDismiss:e},s),null))}},R={id:h,text:Ie.QueueBuildWithDiag,iconProps:e,onActivate:()=>{s.variables=s.variables||{},s.variables["system.debug"]={allowOverride:!0,isSecret:!1,value:"true"},s.variables["agent.diagnostic"]={allowOverride:!0,isSecret:!1,value:"true"},this.context.pageContext.getService("IVssLayoutManager").renderCallout(e=>r.createElement(oe.CommandComponent,Object.assign({commandType:"ciQueueBuildComponent",onDismiss:e},s),null))}}}if(t.canCancelBuild&&(1===q||32===q)){let e="";e=this.state.cancelClicked?Ie.CancelingBuild:Ie.CancelBuild,f={id:i,text:e,disabled:this.state.cancelClicked,onActivate:()=>{const e=n.format(Ie.ConfirmCancelBuild,B.buildNumber);confirm(e)&&(this.setState({cancelClicked:!0}),this._store.cancelBuild(B.id))}}}t.canQueueBuild&&2===B.status&&2!==B.result&&4!==B.result&&v&&(A={id:S,text:Ie.Retry,iconProps:{iconName:"Refresh"},onActivate:()=>{this._store.queueRetry(B.id).then(this._onQueueBuildSuccess)}});let j="",F="";B.keepForever?(j=Ie.StopRetainingBuild,F="Unlock"):(j=Ie.RetainBuild,F="Lock"),t.canRetainBuild&&!B.deleted&&(I={id:m,text:j,iconProps:{iconName:F},onActivate:()=>{this._store.toggleRetainBuild(B.id,B.keepForever)}}),t.canQueueBuild&&256===B.reason&&2===B.status&&B.repository&&B.repository.type!==Te.RepositoryTypes.TfsGit&&(L={id:g,text:Ie.Rebuild,iconProps:{iconName:"Refresh"},onActivate:()=>{this._store.queueRebuild(B).then(this._onQueueBuildSuccess)}}),B.parameters&&(y={id:p,text:Ie.ViewQueueVar,onActivate:()=>{const e=JSON.parse(B.parameters);this.context.pageContext.getService("IVssLayoutManager").renderCallout(t=>r.createElement(ve.Panel,{showSeparator:!0,onDismiss:t,className:"b-panel",titleProps:{text:Ie.VariableHeader}},r.createElement("table",{className:"b-queue-var"},r.createElement("tbody",null,r.createElement("tr",null,r.createElement("th",null,Ie.VariableKey),r.createElement("th",null,Ie.VariableValue)),Object.keys(e).map(t=>r.createElement("tr",{key:t},r.createElement("td",null,t),r.createElement("td",null,e[t]?e[t]:"********")))))))}})}let P=[{contributionId:"ms.vss-build-web.build-result-actions-menu",getContributionContext:this._getActionExtensionContext}];s&&P.push({contributionId:"ms.vss-build-web.build-result-completed-actions-menu",getContributionContext:this._getCompletedActionExtensionContext}),f&&e.push(f),A&&e.push(A),k&&e.push(k),d&&e.push(d),e.push({id:C+"1",itemType:1}),L&&e.push(L),_&&e.push(_),R&&e.push(R),b&&e.push(b),y&&e.push(y);let D={id:v,text:Ie.AddTags,disabled:!t.canChangeBuild,onActivate:()=>{E.invoke(void 0)}};if(e.push(D),I&&(e.push({id:C+"2",itemType:1}),e.push(I)),B)switch(B.result){case 2:d&&(d.isPrimary=!0,d.important=!0),k&&(d?(k.important=!1,k.text=Ie.DownloadAllLogsInOverflow,k.iconProps=void 0):k.important=!0),e.forEach(e=>{e!==d&&e!==k&&(e.iconProps=void 0,e.important=!1)});break;case 8:case 32:case 4:k&&(k.important=!0),_&&(_.important=!0),e.forEach(e=>{e!==_&&e!==k&&(e.iconProps=void 0,e.important=!1)}),!_||4!=B.result&&32!=B.result||(_.isPrimary=!0);break;default:f&&(f.important=!0),e.forEach(e=>{e!==f&&(e.iconProps=void 0,e.important=!1)})}return new re.ObservableHeaderCommandArray(this.context.pageContext,e,P,re.ItemOrdering.ContributedFirst,void 0,this._mutateCommand)}_initializeServices(){this._navigationService=this.context.pageContext.getService("IBuildNavigationService"),this._globalMessageService=this.context.pageContext.getService("IGlobalMessagesService"),this._performanceService=this.context.pageContext.getService("IVssPerformanceService")}_fetchBuild(e,t,s,i){const a=i?{}:this._getRoutes(e);this._store.fetchData(!s,a,t),this.state.cancelClicked&&this.setState({cancelClicked:!1})}_getPivotProviders(){return new ge.ObservableArrayWrappingItemProvider(new ge.MutatedItemProvider(new pe.ContributedPivotBarItemProvider(this._legacyPivotItemProviderOptions),this._getPivotBarItem)).getItems()}_updateExtensions(e){const t=this._getCurrentView(),s=Object.keys(this._extensionBuildCallBacks);for(let i=0;i<=s.length-1;i++){const a=s[i];if(t===a){this._callextensionCallback(a,e);break}}Object.keys(this._providerCallBacks).forEach(t=>{this._providerCallBacks[t](e)})}_setSignalRGlobalMessage(e,t=R){const s=this.state.currentData.build;!s||2!==s.status?this._globalMessageService.addBanner({message:e,level:t},!0):this._globalMessageService.closeBanner()}_startPerfScenarioForContribution(e){e!==we.ViewKeys.Tests&&e!==we.ViewKeys.TestResult||this._performanceService.startScenario(e,!1,void 0,{isTabChangeScenario:!0})}}D.s_emptyData={build:null,definition:null,timeline:null,rawData:null,changes:[],isLoading:!0,repositoryName:"",currentView:"",sourceData:{},approvals:null};class x extends r.Component{constructor(e){super(e),this._updateState=(()=>{this.setState(this._getState())}),this.state=this._getState()}render(){const e=this.state.build;if(!e)return this.state.isLoading?r.createElement(I,null):null;const t=ke.getIndicatorData(e,ke.IndicatorSize.ExtraLarge);let s="BranchCommit",i="BranchCommit",a=e&&e.sourceBranch,o="";this.state.pullRequestData&&(a=this.state.pullRequestData.targetBranch),this.state.sourceProvider&&(a=a&&this.state.sourceProvider.getBranchText(a),i=this.state.sourceProvider.getCommitIconName(),s=this.state.sourceProvider.getRepoIconName()),e.keepForever&&e.retainedByRelease?o=Ie.RetainedByBuildAndRelease:e.keepForever?o=Ie.RetainedByBuild:e.retainedByRelease&&(o=Ie.RetainedByRelease);const d=this.state.sourceData,l=d&&d.data;let u=n.format("{0} {1}",e.definition.name,e.buildNumber),c=null;d&&(d.message?u=d.message:d.displayId&&(u=n.format(Ie.CommitHashHeader,d.displayId)),c=r.createElement("span",null,r.createElement(fe.VssIcon,{iconName:i,className:"b-result-align-sub"}),r.createElement(B,null),d.displayId));const h=r.createElement("span",null,r.createElement(fe.VssIcon,{iconName:"OpenSource",className:"b-result-align-sub"}),r.createElement(B,null),a),p=r.createElement("span",null,r.createElement(fe.VssIcon,{iconName:s,className:"b-result-align-sub"}),r.createElement(B,null),this.state.repoName);let m=this.state.pullRequestData&&r.createElement("span",{className:"b-inline ci-hover-behavior"},r.createElement(he.Tooltip,{anchorOrigin:{horizontal:"center",vertical:"end"},id:"build-pr-tp",text:Ie.ViewPullrequest,tooltipOrigin:{horizontal:"center",vertical:"start"}},r.createElement("span",null,r.createElement(X.FPSLinkComponent,Object.assign({href:this.state.pullRequestData.url,telemetrySource:y},{"aria-describedby":"build-pr-tp","aria-label":n.format(Ie.AriaPullrequest,this.state.pullRequestData.title)}),r.createElement(fe.VssIcon,{iconName:"BranchPullRequest",className:"b-result-align-sub"})," ",this.state.pullRequestData.id)))),g=null;if(d&&!this.state.pullRequestData){const e=d.data||{};g=r.createElement("span",null,r.createElement("span",null,r.createElement("span",{className:"b-inline ci-hover-behavior"},e.commitLink&&r.createElement(he.Tooltip,{anchorOrigin:{horizontal:"center",vertical:"end"},id:"build-commit-tp",text:Ie.ViewCommit,tooltipOrigin:{horizontal:"center",vertical:"start"}},r.createElement("span",null,r.createElement(X.FPSLinkComponent,Object.assign({className:"commit-link",href:e.commitLink,telemetrySource:y},{"aria-describedby":"build-commit-tp","aria-label":n.format(Ie.AriaCommit,d.message)}),c))),!e.commitLink&&r.createElement("span",null,r.createElement("span",null,c)))))}return 64!==e.reason&&128!==e.reason||(m=g,g=null),r.createElement("div",{className:"b-results-header scroll-hidden"},r.createElement("div",{className:"b-row-1 flex flex-row flex-center"},r.createElement("div",{className:"bh-status flex-row"},r.createElement(q.Status,Object.assign({},t.statusProps,{size:"24"}))),r.createElement("div",{className:"title-m text-ellipsis"},r.createElement("span",{className:"bh-number"},"#",e.buildNumber,": "),u)),r.createElement("div",{className:"b-row-2"},this._getReason(m),this.state.repoName&&r.createElement("span",null,r.createElement(B,null),r.createElement("span",{className:"b-inline"},r.createElement("span",{className:"repo-information ci-hover-behavior"},l&&l.repositoryLink&&r.createElement(he.Tooltip,{anchorOrigin:{horizontal:"center",vertical:"end"},id:"build-repo-tp",text:n.format(Ie.ViewRepoFormat,this.state.repoName),tooltipOrigin:{horizontal:"center",vertical:"start"}},r.createElement("span",null,r.createElement(X.FPSLinkComponent,Object.assign({href:l.repositoryLink,telemetrySource:y},{"aria-describedby":"build-repo-tp","aria-label":n.format(Ie.AriaRepository,this.state.repoName)}),p))),!(l&&l.repositoryLink)&&r.createElement("span",null,p)))),r.createElement(B,null),r.createElement("span",null,r.createElement("span",{className:"branch-information ci-hover-behavior"},l&&l.branchLink&&r.createElement(he.Tooltip,{anchorOrigin:{horizontal:"center",vertical:"end"},id:"build-branch-tp",text:n.format(Ie.ViewBranchFormat,a,this.state.repoName),tooltipOrigin:{horizontal:"center",vertical:"start"}},r.createElement("span",null,r.createElement(X.FPSLinkComponent,Object.assign({href:l.branchLink,telemetrySource:y},{"aria-describedby":"build-branch-tp","aria-label":n.format(Ie.AriaBranch,a)}),h))),!(l&&l.branchLink)&&r.createElement("span",null,h))),g&&r.createElement(B,null),g,r.createElement(B,null),o&&r.createElement("span",null,r.createElement("span",{className:"retain-information"},r.createElement("span",null,r.createElement(fe.VssIcon,{iconName:"Lock",className:"retain-lock-icon"})," ",r.createElement("span",null,o))))),r.createElement("div",{className:"b-row-3"},r.createElement(H,{pageContext:this.props.pageContext,projectId:this.props.projectId,permissions:this.props.permissions,hubStore:this.props.hubStore,linkingService:this.props.linkingService})))}_getReason(e){const t=this.state.build;if(t){const s=t.requestedFor&&t.requestedFor.displayName,i=s&&r.createElement("span",null," ",n.format(Ie.ForFormat,s));switch(t.reason){case 4:return r.createElement("span",null,r.createElement("span",null,Ie.ReasonBatchedCI),this._getAgo(),i);case 2:return r.createElement("span",null,r.createElement("span",null,Ie.ReasonIndividualCI),this._getAgo(),i);case 256:return r.createElement("span",null,r.createElement("span",null,Ie.ReasonValidationOf)," ",e,Ie.Triggered,this._getAgo(),s&&r.createElement("span",null," ",n.format(Ie.ForFormatPR,s)));case 8:return r.createElement("span",null,r.createElement("span",null,Ie.ReasonSchedule),this._getAgo());case 128:return r.createElement("span",null,r.createElement("span",null,Ie.ReasonGatedValidationOf)," ",e,Ie.Triggered,this._getAgo(),i);case 64:return r.createElement("span",null,r.createElement("span",null,Ie.ReasonValidationOf)," ",e,Ie.Triggered,this._getAgo(),i);case 512:return r.createElement("span",null,r.createElement("span",null,Ie.ReasonBuildCompletion),this._getAgo(),i);case 943:return r.createElement("span",null,r.createElement("span",null,Ie.ReasonRetention),this._getAgo(),i);default:return r.createElement("span",null,r.createElement("span",null,Ie.ReasonManual),this._getAgo(),s&&r.createElement("span",null," ",n.format(Ie.ByFormat,s)))}}return null}_getAgo(){const e=this.state.build;return e?r.createElement("span",{className:"b-lowercase"}," ",r.createElement("span",null,r.createElement(d.Ago,{date:e.queueTime||e.finishTime,format:1}))):null}componentDidMount(){this.props.hubStore.addBuildChangedListener(this._updateState),this.props.hubStore.addBuildUpdatedListener(this._updateState),this.props.hubStore.addPRChangedListener(this._updateState),this.props.hubStore.addCommitLinksUpdatedListener(this._updateState)}componentWillUnmount(){this.props.hubStore.removeBuildChangedListener(this._updateState),this.props.hubStore.removeBuildUpdatedListener(this._updateState),this.props.hubStore.removePRChangedListener(this._updateState),this.props.hubStore.removeCommitLinksUpdatedListener(this._updateState)}componentWillReceiveProps(e){this._updateState()}_getState(){return{build:this.props.hubStore.getBuild(),repoName:this.props.hubStore.getRepoName(),isLoading:this.props.hubStore.isLoading(),sourceData:this.props.hubStore.getSourceData(),sourceProvider:this.props.hubStore.getSourceProvider(),pullRequestData:this.props.hubStore.getPRData()}}}class U extends r.Component{render(){return r.createElement("div",{className:"build-result-tags-section flex flex-row flex-center"},this.props.children)}componentDidCatch(e,t){console.log(e,t)}}class H extends r.Component{constructor(e){super(e),this._isActive=!1,this._actionPending=!1,this._isBlurDebounced=!1,this._onActive=(()=>{this._isActive=!0}),this._onInActive=(()=>{this.state.alwaysEdit?this._tagPicker&&this._tagPicker.focusInput():(this._isActive=!1,this._invokeBlur())}),this._onRenderItem=(e=>e.key===H.s_showMoreTagKey?r.createElement(G.Button,{subtle:!0,iconProps:{iconName:this.state.showingMore?"ChevronUp":"ChevronDown"},onClick:this._toggleShowingTags,className:H.s_showMoreTagKey,onMouseOver:this._onButtonHover,tooltipProps:{showOnFocus:!0,text:this.state.showingMore?Ie.HideMoreTags:Ie.ShowMoreTags}}):r.createElement(ce.TagItem,Object.assign({},e),e.item.name)),this._onButtonHover=(e=>{e.stopPropagation(),this.setState({addTagsTooltipHidden:!0})}),this._onContainerHover=(()=>{this.setState({addTagsTooltipHidden:!1})}),this._toggleShowingTags=(e=>{e.stopPropagation(),e.preventDefault();const t=!this.state.showingMore;this.setState({showingMore:t,tagsData:this._getTagsData(t,this.state.editMode)})}),this._onInputChange=(e=>(this._actionPending=!!e,e)),this._onAddTag=(e=>e&&this.state.build?(this._store.addTag(this.state.build.id,e.name),e):(this._actionPending=!1,{})),this._onFocus=(e=>{const t=e.target;this.state.tagsData.hasMore&&t&&t.className.indexOf(H.s_showMoreTagKey)>-1||this.props.permissions.canChangeBuild&&(this._isActive=!0,this.setState({editMode:!0,addTagsTooltipHidden:!0,tagsData:this._getTagsData(this.state.showingMore,!0)}),this._invokeBlur())}),this._onBlur=(()=>{this._isActive||this._actionPending||this.setState({editMode:!1,tagsData:this._getTagsData(this.state.showingMore,!1)})}),this._onChange=(e=>{e=e||[];const t=this.state.tagsData.all;if(this.state.build&&e.length==t.length-1){const s=(ae.subtract(t,e)||[])[0];s&&this._store.deleteTag(this.state.build.id,s.name)}this._actionPending=!1,this.setState({tagsData:this._getTagsData(this.state.showingMore,this.state.editMode,e)})}),this._onResolvedSuggestions=((e,t)=>{const s=(t=t||[]).map(e=>e.key);let i=ae.subtract(this.state.suggestedTags,s).filter(t=>n.startsWith(t,e)).map(e=>({key:e,name:e}));return 0==i.length&&-1==s.map(e=>e.toLocaleLowerCase()).indexOf(e.toLocaleLowerCase())&&i.push({key:e,name:e}),i}),this._onStoreChanged=(()=>{this.setState({suggestedTags:this._store.getTagSuggestions(),tagsData:this._getTagsData(this.state.showingMore,this.state.editMode),build:this.props.hubStore.getBuild()})}),this._onShowEdit=(()=>{this._onActive(),this.setState({editMode:!0,alwaysEdit:!0})}),this.timerManagement=new M.TimerManagement,this._buildClient=e.pageContext.getRestClient("IBuildRestClient");const t=e.hubStore.getBuild();this._store=e.store||new je.TagsStore({client:this._buildClient,projectId:e.projectId,hubStore:e.hubStore}),this.state={suggestedTags:this._store.getTagSuggestions(),tagsData:this._getTagsData(!1,!1),editMode:!1,alwaysEdit:!1,build:t,showingMore:!1,addTagsTooltipHidden:!1}}render(){let e=this.state.tagsData.actual;return this.state.tagsData.injectShowMore&&(e=e.slice()).push({key:H.s_showMoreTagKey,name:""}),this.state.editMode||0!=this.state.tagsData.all.length?r.createElement("div",Object.assign({className:N.css("build-result-tags-section-holder",this.state.editMode&&"edit-mode",!this.state.editMode&&"read-mode"),"aria-label":Ie.AriaTagsSection},this.state.editMode?{onFocus:this._onActive,onBlur:this._onInActive}:{onFocus:this._onFocus,onMouseOver:this._onContainerHover,tabIndex:0}),r.createElement(U,null,r.createElement(ce.TagPicker,Object.assign({className:N.css("build-tag-picker",!this.state.editMode&&"read-mode"),selectedItems:e,onResolveSuggestions:this._onResolvedSuggestions,inputProps:{placeholder:Ie.AddTag},onChange:this._onChange},this.state.tagsData.hasMore?{onRenderItem:this._onRenderItem}:{},{onInputChange:this._onInputChange,pickerSuggestionsProps:{noResultsFoundText:Ie.NoResultsFound,suggestionsAvailableAlertText:n.format(Ie.AriaResultsAvailable,Ie.AriaTagSuggestions)},onItemSelected:this._onAddTag},this.state.editMode?{}:{itemLimit:0,disabled:!0},{ref:e=>this._tagPicker=e})))):null}componentDidMount(){this._store.addListener(this._onStoreChanged),E.addListener(this._onShowEdit)}componentWillUnmount(){this._store.removeListener(this._onStoreChanged),E.removeListener(this._onShowEdit),this._store.dispose(),this.timerManagement.dispose()}componentDidUpdate(e,t){this._tagPicker&&this.state.editMode&&(this.state.editMode!==t.editMode||this.state.tagsData.all.length!==t.tagsData.all.length)&&this._tagPicker.focusInput()}_invokeBlur(){this._isBlurDebounced||(this._isBlurDebounced=!0,this._onBlur=this.timerManagement.debounce(this._onBlur,600)),this._onBlur()}_getTagsData(e,t,s){const i=s||this._store.getSelectedTags();let a=i.slice(),o=a.splice(0,H.s_maxTagsCount);const n=a.length>0;let r=o;return(e||t)&&(r=i),{actual:r,additional:a,all:i,hasMore:n,injectShowMore:n&&!t}}}H.s_maxTagsCount=5,H.s_showMoreTagKey="SummaryViewTagsPicker.ShowMore",L.Components.add("build-buildresult",D)}()},["Resources","Actions/BuildResult","Actions/SignalR","BuildIndicator","Components","Constants","Contribution","HeaderBreadcrumbService","Performance","LogsParser","SignalRHub","Timeline","Stores/BuildResultView","Stores/LiveContext","Tabs/Results/Sources/Tags","Tabs/Results/Actions/Tags","Stores/Tags","Tabs/Logs/Sources/JobRequest","Tabs/Logs/Actions/JobRequest","Tabs/Logs/Actions/Timeline","Tabs/Logs/JobIndicator","Tabs/Logs/AttemptsDropdown","Tabs/Logs/Stores/Logs","Tabs/Logs/Tab","Tabs/Results/Actions/Contribution","Tabs/Results/CardSection","Tabs/Results/LegacySectionComponent","Tabs/Results/MarkdownSectionComponent","Tabs/Results/Stores/Results","Tabs/Results/Tab","View"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-build-web.buildresult"}}));